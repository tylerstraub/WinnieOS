(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const R="winnieos.display.reference",k={width:1280,height:800};let s=null;function T(e){if(e==null)return null;const t=String(e).trim();if(!t)return null;const n=t.match(/^([0-9.]+)px$/i);if(!n)return null;const i=Number(n[1]);return Number.isFinite(i)?i:null}function v(e,t,n){const i=Math.round(Number(e));return Number.isFinite(i)?Math.min(n,Math.max(t,i)):null}function I(e){return!!e&&Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>=320&&e.height>=240&&e.width<=7680&&e.height<=4320}function V(){const e=document.documentElement,t=window.getComputedStyle(e),n=T(t.getPropertyValue("--ref-width")),i=T(t.getPropertyValue("--ref-height"));return Number.isFinite(n)&&Number.isFinite(i)&&n>0&&i>0?{width:Math.round(n),height:Math.round(i)}:null}function U(){try{const e=window.localStorage.getItem(R);if(!e)return null;const t=JSON.parse(e);if(!t||typeof t!="object")return null;const n=v(t.width,320,7680),i=v(t.height,240,4320),r={width:n,height:i};return I(r)?r:null}catch{return null}}function j(e){try{window.localStorage.setItem(R,JSON.stringify(e))}catch{}}function B(){try{window.localStorage.removeItem(R)}catch{}}function b(e){const t=document.documentElement;t.style.setProperty("--ref-width",e.width+"px"),t.style.setProperty("--ref-height",e.height+"px"),t.style.setProperty("--ref-aspect-ratio",String(e.width/e.height)),t.dataset.refWidth=String(e.width),t.dataset.refHeight=String(e.height)}function O(e){try{const t=new CustomEvent("winnieos:displaychange",{detail:{reference:{width:e.width,height:e.height}}});document.dispatchEvent(t)}catch{}}function F(){s||(s=U()||V()||k,b(s))}const c={init:function(){F(),O(s)},getReferenceSize:function(){return F(),{width:s.width,height:s.height}},setReferenceSize:function(e){F();const t=v(e&&e.width,320,7680),n=v(e&&e.height,240,4320),i={width:t,height:n};return I(i)?(s=i,b(s),(!e||e.persist!==!1)&&j(s),O(s),!0):!1},resetReferenceSize:function(){s=V()||k,B(),b(s),O(s)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Display=c);let m=null,d=null,w=!1,a=null;function y(){return m||(m=document.getElementById("winnieos-canvas")),m}function W(){if(c&&typeof c.getReferenceSize=="function"){const i=c.getReferenceSize();if(i&&Number.isFinite(i.width)&&Number.isFinite(i.height)&&i.width>0&&i.height>0)return{width:i.width,height:i.height}}const e=window.getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--ref-width")),n=parseFloat(e.getPropertyValue("--ref-height"));return Number.isFinite(t)&&Number.isFinite(n)&&t>0&&n>0?{width:Math.round(t),height:Math.round(n)}:{width:1280,height:800}}function x(){const e=window.visualViewport;return e&&typeof e.width=="number"&&typeof e.height=="number"?{width:e.width,height:e.height,offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}:{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0}}function G(){const e=y();if(!e)return;const t=W(),n=t.width,i=t.height,r=x(),o=r.width,u=r.height,E=Math.min(o/n,u/i),H=n*E,$=i*E,D=Math.round(r.offsetLeft+(o-H)/2),M=Math.round(r.offsetTop+(u-$)/2);e.style.position="fixed",e.style.width=n+"px",e.style.height=i+"px",e.style.left=D+"px",e.style.top=M+"px",e.style.margin="0",e.style.padding="0",e.style.transformOrigin="top left";const L=String(K(E));e.style.transform=`scale(${L})`,e.dataset.scale=L,e.dataset.vw=String(Math.round(o)),e.dataset.vh=String(Math.round(u)),e.dataset.left=String(D),e.dataset.top=String(M),document.documentElement.style.setProperty("--viewport-scale",L)}function l(){d||(d=window.requestAnimationFrame(function(){d=null,G()}))}function K(e){return Math.round(e*1e5)/1e5}const P={init:function(){w||y()&&(w=!0,l(),window.addEventListener("resize",l),document.addEventListener("winnieos:displaychange",l),window.visualViewport&&(a=window.visualViewport,a.addEventListener("resize",l),a.addEventListener("scroll",l)))},getScale:function(){const e=y();return e?parseFloat(e.dataset.scale||"1"):1},getReferenceSize:function(){return W()},getMetrics:function(){const e=W(),t=x(),n=y(),i=n?parseFloat(n.dataset.scale||"1"):K(Math.min(t.width/e.width,t.height/e.height));return{reference:{width:e.width,height:e.height},viewport:{width:t.width,height:t.height,offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0},scale:i}},refresh:function(){l()},_resetForTests:function(){if(w&&(window.removeEventListener("resize",l),document.removeEventListener("winnieos:displaychange",l),a&&(a.removeEventListener("resize",l),a.removeEventListener("scroll",l))),d&&typeof window.cancelAnimationFrame=="function")try{window.cancelAnimationFrame(d)}catch{}w=!1,d=null,m=null,a=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Viewport=P);let p=!1,f=null;function C(e){return e.preventDefault(),!1}function z(e){if(e.key==="F5"||e.ctrlKey&&(e.key==="r"||e.key==="R")||e.altKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight")||e.key==="Backspace"&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&!e.target.isContentEditable||e.ctrlKey&&(e.key==="w"||e.key==="W"))return e.preventDefault(),!1}function A(e){if(e.button===1)return e.preventDefault(),!1}function J(e){return e.preventDefault(),!1}const N={init:function(){p||(p=!0,document.addEventListener("contextmenu",C),document.addEventListener("keydown",z),document.addEventListener("mousedown",A),f=J,document.addEventListener("dragstart",f))},_resetForTests:function(){p&&(document.removeEventListener("contextmenu",C),document.removeEventListener("keydown",z),document.removeEventListener("mousedown",A),f&&document.removeEventListener("dragstart",f)),p=!1,f=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Kiosk=N);let g=null,h=null;async function Y(e,t){const n=typeof AbortController<"u"?new AbortController:null,i=n?setTimeout(()=>n.abort(),t):null;try{const r=await fetch(e,{cache:"no-store",signal:n?n.signal:void 0});return r.ok?await r.json():null}catch{return null}finally{i&&clearTimeout(i)}}const S={load:async function(){return g||h||(h=(async()=>(g=await Y("/winnieos-config.json",750)||null,h=null,g))(),h)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Config=S);const q="winnieos.display.reference";function X(){try{return!!window.localStorage.getItem(q)}catch{return!1}}function Q(e){const t=e&&e.display&&e.display.reference;if(!t||!Number.isFinite(t.width)||!Number.isFinite(t.height)||t.width<=0||t.height<=0||X())return;if(c&&typeof c.setReferenceSize=="function"){c.setReferenceSize({width:t.width,height:t.height,persist:!1});return}const n=document.documentElement;n.style.setProperty("--ref-width",`${Math.round(t.width)}px`),n.style.setProperty("--ref-height",`${Math.round(t.height)}px`),n.style.setProperty("--ref-aspect-ratio",String(t.width/t.height))}function _(){const e=S&&typeof S.load=="function"?S.load():Promise.resolve(null);c?c.init():console.warn("WinnieOS: Display module failed to load; falling back to CSS reference tokens"),P?P.init():console.error("WinnieOS: Viewport module failed to load"),N?N.init():console.error("WinnieOS: Kiosk module failed to load"),e.then(Q).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_();const Z={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=Z);const ee={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Components=ee);
