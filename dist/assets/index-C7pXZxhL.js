(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const ne="winnieos.";function V(){try{if(typeof window>"u"||!window.localStorage)return!1;const e="__storage_test__";return window.localStorage.setItem(e,"test"),window.localStorage.removeItem(e),!0}catch{return!1}}function ce(e){if(!e||typeof e!="string")throw new Error("Storage key must be a non-empty string");return e.startsWith(ne)?e:ne+e}const R={get:function(e,t=null){if(!V())return t;try{const n=ce(e),o=window.localStorage.getItem(n);if(o===null)return t;try{return JSON.parse(o)}catch{return o}}catch(n){if(n.message&&n.message.includes("Storage key must be"))throw n;return t}},set:function(e,t){if(!V())return!1;try{const n=ce(e),o=JSON.stringify(t);return window.localStorage.setItem(n,o),!0}catch(n){if(n.message&&n.message.includes("Storage key must be"))throw n;return!1}},remove:function(e){if(!V())return!1;try{const t=ce(e);return window.localStorage.removeItem(t),!0}catch(t){if(t.message&&t.message.includes("Storage key must be"))throw t;return!1}},has:function(e){if(!V())return!1;try{const t=ce(e);return window.localStorage.getItem(t)!==null}catch(t){if(t.message&&t.message.includes("Storage key must be"))throw t;return!1}},clear:function(){if(!V())return!1;try{const e=[];for(let t=0;t<window.localStorage.length;t++){const n=window.localStorage.key(t);n&&n.startsWith(ne)&&e.push(n)}return e.forEach(t=>window.localStorage.removeItem(t)),!0}catch{return!1}},keys:function(){if(!V())return[];try{const e=[];for(let t=0;t<window.localStorage.length;t++){const n=window.localStorage.key(t);n&&n.startsWith(ne)&&e.push(n.substring(ne.length))}return e}catch{return[]}}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils.Storage=R);const We="display.reference",Ve={width:1280,height:800};let T=null;function xe(e){if(e==null)return null;const t=String(e).trim();if(!t)return null;const n=t.match(/^([0-9.]+)px$/i);if(!n)return null;const o=Number(n[1]);return Number.isFinite(o)?o:null}function ye(e,t,n){const o=Math.round(Number(e));return Number.isFinite(o)?Math.min(n,Math.max(t,o)):null}function Ge(e){return!!e&&Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>=320&&e.height>=240&&e.width<=7680&&e.height<=4320}function Ye(){const e=document.documentElement,t=window.getComputedStyle(e),n=xe(t.getPropertyValue("--ref-width")),o=xe(t.getPropertyValue("--ref-height"));return Number.isFinite(n)&&Number.isFinite(o)&&n>0&&o>0?{width:Math.round(n),height:Math.round(o)}:null}function pt(){const e=R.get(We);if(!e||typeof e!="object")return null;const t=ye(e.width,320,7680),n=ye(e.height,240,4320),o={width:t,height:n};return Ge(o)?o:null}function ft(e){R.set(We,e)}function mt(){R.remove(We)}function Me(e){const t=document.documentElement;t.style.setProperty("--ref-width",e.width+"px"),t.style.setProperty("--ref-height",e.height+"px"),t.style.setProperty("--ref-aspect-ratio",String(e.width/e.height)),t.dataset.refWidth=String(e.width),t.dataset.refHeight=String(e.height)}function Se(e){try{const t=new CustomEvent("winnieos:displaychange",{detail:{reference:{width:e.width,height:e.height}}});document.dispatchEvent(t)}catch{}}function _e(){T||(T=pt()||Ye()||Ve,Me(T))}const D={init:function(){_e(),Se(T)},getReferenceSize:function(){return _e(),{width:T.width,height:T.height}},setReferenceSize:function(e){_e();const t=ye(e&&e.width,320,7680),n=ye(e&&e.height,240,4320),o={width:t,height:n};return Ge(o)?(T=o,Me(T),(!e||e.persist!==!1)&&ft(T),Se(T),!0):!1},resetReferenceSize:function(){T=Ye()||Ve,mt(),Me(T),Se(T)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Display=D);let me=null,Y=null,le=!1,K=null;function he(){return me||(me=document.getElementById("winnieos-canvas")),me}function Ce(){if(D&&typeof D.getReferenceSize=="function"){const o=D.getReferenceSize();if(o&&Number.isFinite(o.width)&&Number.isFinite(o.height)&&o.width>0&&o.height>0)return{width:o.width,height:o.height}}const e=window.getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--ref-width")),n=parseFloat(e.getPropertyValue("--ref-height"));return Number.isFinite(t)&&Number.isFinite(n)&&t>0&&n>0?{width:Math.round(t),height:Math.round(n)}:{width:1280,height:800}}function Xe(){const e=window.visualViewport;return e&&typeof e.width=="number"&&typeof e.height=="number"?{width:e.width,height:e.height,offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}:{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0}}function ht(){const e=he();if(!e)return;const t=Ce(),n=t.width,o=t.height,r=Xe(),i=r.width,c=r.height,l=Math.min(i/n,c/o),s=n*l,b=o*l,w=Math.round(r.offsetLeft+(i-s)/2),p=Math.round(r.offsetTop+(c-b)/2);e.style.position="fixed",e.style.width=n+"px",e.style.height=o+"px",e.style.left=w+"px",e.style.top=p+"px",e.style.margin="0",e.style.padding="0",e.style.transformOrigin="top left";const S=String(Je(l));e.style.transform=`scale(${S})`,e.dataset.scale=S,e.dataset.vw=String(Math.round(i)),e.dataset.vh=String(Math.round(c)),e.dataset.left=String(w),e.dataset.top=String(p),document.documentElement.style.setProperty("--viewport-scale",S)}function W(){Y||(Y=window.requestAnimationFrame(function(){Y=null,ht()}))}function Je(e){return Math.round(e*1e5)/1e5}const Te={init:function(){le||he()&&(le=!0,W(),window.addEventListener("resize",W),document.addEventListener("winnieos:displaychange",W),window.visualViewport&&(K=window.visualViewport,K.addEventListener("resize",W),K.addEventListener("scroll",W)))},getScale:function(){const e=he();return e?parseFloat(e.dataset.scale||"1"):1},getReferenceSize:function(){return Ce()},getMetrics:function(){const e=Ce(),t=Xe(),n=he(),o=n?parseFloat(n.dataset.scale||"1"):Je(Math.min(t.width/e.width,t.height/e.height));return{reference:{width:e.width,height:e.height},viewport:{width:t.width,height:t.height,offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0},scale:o}},refresh:function(){W()},_resetForTests:function(){if(le&&(window.removeEventListener("resize",W),document.removeEventListener("winnieos:displaychange",W),K&&(K.removeEventListener("resize",W),K.removeEventListener("scroll",W))),Y&&typeof window.cancelAnimationFrame=="function")try{window.cancelAnimationFrame(Y)}catch{}le=!1,Y=null,me=null,K=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Viewport=Te);let ue=!1,ee=null;function Fe(e){return e.preventDefault(),!1}function Ie(e){if(e.key==="F5"||e.ctrlKey&&(e.key==="r"||e.key==="R")||e.altKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight")||e.key==="Backspace"&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&!e.target.isContentEditable||e.ctrlKey&&(e.key==="w"||e.key==="W"))return e.preventDefault(),!1}function De(e){if(e.button===1)return e.preventDefault(),!1}function wt(e){return e.preventDefault(),!1}const Ne={init:function(){ue||(ue=!0,document.addEventListener("contextmenu",Fe),document.addEventListener("keydown",Ie),document.addEventListener("mousedown",De),ee=wt,document.addEventListener("dragstart",ee))},_resetForTests:function(){ue&&(document.removeEventListener("contextmenu",Fe),document.removeEventListener("keydown",Ie),document.removeEventListener("mousedown",De),ee&&document.removeEventListener("dragstart",ee)),ue=!1,ee=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Kiosk=Ne);let te=null,G=null;function gt(e){return new Promise(t=>setTimeout(t,e))}async function yt(e,t){const n=typeof AbortController<"u"?new AbortController:null,o=n?setTimeout(()=>n.abort(),t):null;try{const r=await fetch(e,{cache:"no-store",signal:n?n.signal:void 0});return r.ok?await r.json():null}catch{return null}finally{o&&clearTimeout(o)}}const $={load:async function(){return te||G||(G=(async()=>{const e=[{timeoutMs:1500,sleepMs:250},{timeoutMs:1500,sleepMs:250},{timeoutMs:2e3,sleepMs:500},{timeoutMs:2500,sleepMs:750}];let t=null;for(let n=0;n<e.length;n++){const o=e[n];if(t=await yt("/winnieos-config.json",o.timeoutMs),t&&typeof t=="object")break;o.sleepMs&&await gt(o.sleepMs)}return te=t&&typeof t=="object"?t:null,G=null,te})(),G)},clearCache:function(){te=null,G=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Config=$);const Ze="preferences.backgroundColor",vt="#667eea",bt="#764ba2";function Qe(e,t,n){const o=r=>{const i=Math.round(Math.max(0,Math.min(255,r))).toString(16);return i.length===1?"0"+i:i};return`#${o(e)}${o(t)}${o(n)}`}function et(e){if(!e||typeof e!="string")return{r:0,g:0,b:0};let t=e.replace("#","").trim();if(t.length===3&&(t=t.split("").map(i=>i+i).join("")),t.length!==6||!/^[0-9a-fA-F]{6}$/.test(t))return{r:0,g:0,b:0};const n=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);return!Number.isFinite(n)||!Number.isFinite(o)||!Number.isFinite(r)?{r:0,g:0,b:0}:{r:n,g:o,b:r}}function tt(e){const t=et(e),n=t.r/255,o=t.g/255,r=t.b/255,i=Math.max(n,o,r),c=Math.min(n,o,r),l=i-c;let s=0;l!==0&&(i===n?s=(o-r)/l%6:i===o?s=(r-n)/l+2:s=(n-o)/l+4),s=Math.round(s*60),s<0&&(s+=360),s=(s+30)%360;const b=(i+c)/2,w=l===0?0:l/(1-Math.abs(2*b-1)),p=(1-Math.abs(2*b-1))*w,S=p*(1-Math.abs(s/60%2-1)),A=b-p/2;let C=0,g=0,M=0;return s<60?(C=p,g=S,M=0):s<120?(C=S,g=p,M=0):s<180?(C=0,g=p,M=S):s<240?(C=0,g=S,M=p):s<300?(C=S,g=0,M=p):(C=p,g=0,M=S),Qe(Math.round((C+A)*255),Math.round((g+A)*255),Math.round((M+A)*255))}function Le(e,t=null){if(!e||typeof e!="string")return;const n=t||tt(e),o=document.body,r=document.getElementById("winnieos-canvas");o&&o.style.setProperty("background",e),r&&r.style.setProperty("background",`linear-gradient(135deg, ${e} 0%, ${n} 100%)`)}function nt(){return R.get(Ze,null)}function St(e){return!e||typeof e!="string"?!1:R.set(Ze,e)}function _t(){const e=nt();e?Le(e):Le(vt,bt)}const F={apply:Le,getSaved:nt,save:St,load:_t,rgbToHex:Qe,hexToRgb:et,generateSecondary:tt};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils.Background=F);const Et="display.reference";function Ot(){return R.has(Et)}function Mt(e){const t=e&&e.display&&e.display.reference;if(!t||!Number.isFinite(t.width)||!Number.isFinite(t.height)||t.width<=0||t.height<=0||Ot())return;if(D&&typeof D.setReferenceSize=="function"){D.setReferenceSize({width:t.width,height:t.height,persist:!1});return}const n=document.documentElement;n.style.setProperty("--ref-width",`${Math.round(t.width)}px`),n.style.setProperty("--ref-height",`${Math.round(t.height)}px`),n.style.setProperty("--ref-aspect-ratio",String(t.width/t.height))}function Re(){const e=$&&typeof $.load=="function"?$.load():Promise.resolve(null);D?D.init():console.warn("WinnieOS: Display module failed to load; falling back to CSS reference tokens"),Te?Te.init():console.error("WinnieOS: Viewport module failed to load"),Ne?Ne.init():console.error("WinnieOS: Kiosk module failed to load"),F&&typeof F.load=="function"&&F.load(),e.then(Mt).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Re):Re();const Ct={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=Ct);const Tt={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Components=Tt);const Nt={id:"animals",title:"Animals",iconEmoji:"ðŸ¦",sortOrder:25,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Animals</div>
            <div class="wos-app-placeholder-text">Animal sounds and matching will live here.</div>
        `)},unmount:function(){}},Lt=Object.freeze(Object.defineProperty({__proto__:null,default:Nt},Symbol.toStringTag,{value:"Module"})),At={id:"blocks",title:"Blocks",iconEmoji:"ðŸ§±",sortOrder:15,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Blocks</div>
            <div class="wos-app-placeholder-text">A building blocks game will live here.</div>
        `)},unmount:function(){}},jt=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"})),kt={id:"bubbles",title:"Bubbles",iconEmoji:"ðŸ«§",sortOrder:20,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Bubbles</div>
            <div class="wos-app-placeholder-text">Pop pop pop!</div>
        `)},unmount:function(){}},Pt=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"})),Wt={id:"colors",title:"Colors",iconEmoji:"ðŸŒˆ",sortOrder:30,mount:function({root:e}){if(!e)return;e.className="wos-colors-app",e.innerHTML="";const t=document.createElement("div");t.className="wos-colors-container";const n=document.createElement("div");n.className="wos-colors-picker",n.setAttribute("role","application"),n.setAttribute("aria-label","Color picker");const o=document.createElement("canvas");o.className="wos-colors-canvas";const r=.35,i=.95;let c=0;const l=a=>Math.max(0,Math.min(1,a)),s=(a,m,h)=>{a=a%360,a<0&&(a+=360);const u=h*m,y=u*(1-Math.abs(a/60%2-1)),v=h-u;let f=0,_=0,O=0;return a<60?(f=u,_=y,O=0):a<120?(f=y,_=u,O=0):a<180?(f=0,_=u,O=y):a<240?(f=0,_=y,O=u):a<300?(f=y,_=0,O=u):(f=u,_=0,O=y),{r:Math.round((f+v)*255),g:Math.round((_+v)*255),b:Math.round((O+v)*255)}},b=(a,m,h)=>{a=a/255,m=m/255,h=h/255;const u=Math.max(a,m,h),y=Math.min(a,m,h),v=u-y;let f=0;v!==0&&(u===a?f=(m-h)/v%6:u===m?f=(h-a)/v+2:f=(a-m)/v+4),f=Math.round(f*60),f<0&&(f+=360);const _=u===0?0:v/u;return{h:f,s:_,v:u}},w=()=>{const a=n.getBoundingClientRect(),m=Math.max(1,a.width),h=Math.max(1,a.height),u=m/2,y=h/2,v=Math.min(u,y);return{rect:a,width:m,height:h,cx:u,cy:y,radius:v}},p=a=>r+(1-r)*l(a),S=a=>l((a-r)/(1-r)),A=(a,m)=>{const{rect:h,width:u,height:y,cx:v,cy:f,radius:_}=w(),O=a-h.left,z=m-h.top,j=O-v,k=z-f,P=Math.sqrt(j*j+k*k),B=Math.min(_,P),q=Math.atan2(k,j),Z=P<1?c:(q*180/Math.PI+360)%360,ae=_<=0?0:B/_;return{width:u,height:y,cx:v,cy:f,radius:_,dx:j,dy:k,distance:P,distClamped:B,angle:q,hue:Z,t:ae}},C=({hue:a,t:m})=>{const h=p(m),u=s(a,h,i);return F.rgbToHex(u.r,u.g,u.b)},g=document.createElement("div");g.className="wos-colors-indicator",g.setAttribute("aria-hidden","true");const M=({cx:a,cy:m,radius:h,angle:u,distClamped:y,width:v,height:f})=>{const _=a+Math.cos(u)*y,O=m+Math.sin(u)*y;g.style.left=`${_/v*100}%`,g.style.top=`${O/f*100}%`},X=()=>{const a=F.getSaved(),{width:m,height:h,cx:u,cy:y,radius:v}=w();if(!a||v<=0){g.style.left="50%",g.style.top="50%";return}const f=F.hexToRgb(a),_=b(f.r,f.g,f.b);c=_.h;const O=S(_.s),z=_.h*Math.PI/180,j=O*v,k=u+Math.cos(z)*j,P=y+Math.sin(z)*j;g.style.left=`${k/m*100}%`,g.style.top=`${P/h*100}%`},J=()=>{const a=n.getBoundingClientRect(),m=window.devicePixelRatio||1,h=Math.max(1,Math.floor(a.width)),u=Math.max(1,Math.floor(a.height)),y=Math.max(1,Math.floor(h*m)),v=Math.max(1,Math.floor(u*m));o.width=y,o.height=v;const f=o.getContext("2d");if(!f)return;const _=f.createImageData(y,v),O=_.data,z=y/2,j=v/2,k=Math.min(z,j);for(let P=0;P<v;P++)for(let B=0;B<y;B++){const q=B-z,Z=P-j,ae=Math.sqrt(q*q+Z*Z),Q=(P*y+B)*4;if(ae>k){O[Q+3]=0;continue}const lt=(Math.atan2(Z,q)*180/Math.PI+360)%360,ut=k<=0?0:ae/k,dt=p(ut),be=s(lt,dt,i);O[Q]=be.r,O[Q+1]=be.g,O[Q+2]=be.b,O[Q+3]=255}f.putImageData(_,0,0)};n.appendChild(o),n.appendChild(g),t.appendChild(n),e.appendChild(t),requestAnimationFrame(()=>{J(),X()});const E=new ResizeObserver(()=>{J(),X()});E.observe(n);let d=null;const ie=(a,m)=>{const h=A(a,m);c=h.hue,M(h);const u=C(h);g.classList.add("wos-colors-indicator-active"),setTimeout(()=>{g.classList.remove("wos-colors-indicator-active")},180),F.apply(u),F.save(u)},x=a=>{if(d===null){d=a.pointerId;try{n.setPointerCapture(d)}catch{}a.preventDefault(),ie(a.clientX,a.clientY)}},re=a=>{d===null||a.pointerId!==d||(a.preventDefault(),ie(a.clientX,a.clientY))},se=a=>{if(!(d===null||a.pointerId!==d)){a.preventDefault();try{n.releasePointerCapture(d)}catch{}d=null}};return n.addEventListener("pointerdown",x),n.addEventListener("pointermove",re),n.addEventListener("pointerup",se),n.addEventListener("pointercancel",se),function(){try{E.disconnect()}catch{}n.removeEventListener("pointerdown",x),n.removeEventListener("pointermove",re),n.removeEventListener("pointerup",se),n.removeEventListener("pointercancel",se)}},unmount:function(){}},xt=Object.freeze(Object.defineProperty({__proto__:null,default:Wt},Symbol.toStringTag,{value:"Module"})),Ft={id:"dance",title:"Dance",iconEmoji:"ðŸ’ƒ",sortOrder:55,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Dance</div>
            <div class="wos-app-placeholder-text">A dance party will live here.</div>
        `)},unmount:function(){}},It=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"})),Dt={id:"garden",title:"Garden",iconEmoji:"ðŸŒ»",sortOrder:60,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Garden</div>
            <div class="wos-app-placeholder-text">Plant and grow little flowers.</div>
        `)},unmount:function(){}},Rt=Object.freeze(Object.defineProperty({__proto__:null,default:Dt},Symbol.toStringTag,{value:"Module"})),Ht={id:"memory",title:"Memory",iconEmoji:"ðŸ§ ",sortOrder:45,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Memory</div>
            <div class="wos-app-placeholder-text">A simple matching game will live here.</div>
        `)},unmount:function(){}},$t=Object.freeze(Object.defineProperty({__proto__:null,default:Ht},Symbol.toStringTag,{value:"Module"})),zt={id:"music",title:"Music",iconEmoji:"ðŸŽµ",sortOrder:30,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Music</div>
            <div class="wos-app-placeholder-text">This will become a simple music player with big buttons.</div>
        `)},unmount:function(){}},Bt=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),ot="apps.notepad.v1",Ae=[{id:"black",hex:"#111111"},{id:"red",hex:"#E11D48"},{id:"orange",hex:"#F97316"},{id:"yellow",hex:"#F59E0B"},{id:"green",hex:"#16A34A"},{id:"blue",hex:"#2563EB"},{id:"purple",hex:"#7C3AED"},{id:"pink",hex:"#EC4899"}],Kt=["ðŸ˜€","ðŸ˜","ðŸ˜„","ðŸ˜†","ðŸ˜Š","ðŸ˜","ðŸ¥³","ðŸ˜œ","ðŸµ","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ¶","ðŸ±","ðŸ­","ðŸ°","ðŸ¦","ðŸ·","ðŸ½","ðŸ®","ðŸ¸","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¦Š","ðŸ¯","ðŸ™","ðŸ¦„","ðŸž","ðŸ¦‹","ðŸ","ðŸ¢","ðŸ“","ðŸŒ","ðŸŽ","ðŸ‡","ðŸ‰","ðŸ’","ðŸª","ðŸ¦","â­","ðŸŒˆ","â˜€ï¸","ðŸŒ™","â¤ï¸","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","âœ¨","ðŸŽˆ","ðŸŽ‰","ðŸŽµ"];function Ut(e,t){let n=null;return function(...o){n&&clearTimeout(n),n=setTimeout(()=>e(...o),t)}}function it(e){const t=String(e||"").trim();return t?/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t)?t.toLowerCase():/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*(0|1|0?\.\d+))?\s*\)$/i.test(t)?t:null:null}function He(e){const t=document.createElement("template");t.innerHTML=String(e||"");const n=o=>{const r=Array.from(o.childNodes||[]);for(const i of r)if(i.nodeType===Node.ELEMENT_NODE){const c=i.tagName.toLowerCase();if(c!=="br")if(c==="div"||c==="span"){const l=Array.from(i.attributes||[]);for(const s of l)i.removeAttribute(s.name);if(c==="span"){const s=i.style&&i.style.color?i.style.color:"",b=it(s);b&&i.setAttribute("style",`color:${b}`)}n(i)}else{const l=i.textContent||"";i.replaceWith(document.createTextNode(l))}}else i.nodeType===Node.COMMENT_NODE&&i.remove()};try{n(t.content)}catch{}return t.innerHTML}function rt(e,t){try{if(e==="foreColor")try{document.execCommand("styleWithCSS",!1,!0)}catch{}return document.execCommand(e,!1,t)}catch{return!1}}function de(e,t){const n=it(t)||t,o=rt("foreColor",n);return!o&&e&&e.style&&(e.style.color=n),o}function $e(e){if(rt("insertText",e))return!0;const t=window.getSelection&&window.getSelection();if(!t||t.rangeCount===0)return!1;const n=t.getRangeAt(0);n.deleteContents();const o=document.createTextNode(e);return n.insertNode(o),n.setStartAfter(o),n.setEndAfter(o),t.removeAllRanges(),t.addRange(n),!0}function qt(){const e=R.get(ot,null);return!e||typeof e!="object"?null:{html:typeof e.html=="string"?e.html:"",color:typeof e.color=="string"?e.color:Ae[0].hex}}function ze(e,t){if(!e||typeof e.querySelectorAll!="function")return;e.querySelectorAll("[data-wos-notepad-swatch]").forEach(o=>{(o.getAttribute("data-wos-notepad-swatch")||"").toLowerCase()===String(t||"").toLowerCase()?o.classList.add("wos-notepad-swatch--active"):o.classList.remove("wos-notepad-swatch--active")})}const Vt={id:"notepad",title:"Notepad",iconEmoji:"ðŸ“",sortOrder:5,mount:function({root:e}){if(!e)return;e.className="wos-notepad-app",e.innerHTML="";const t=qt();let n=t&&t.color||Ae[0].hex;const o=document.createElement("div");o.className="wos-notepad-wrap";const r=document.createElement("div");r.className="wos-notepad-paper";const i=document.createElement("div");i.className="wos-notepad-editor",i.setAttribute("contenteditable","true"),i.setAttribute("role","textbox"),i.setAttribute("aria-multiline","true"),i.setAttribute("aria-label","Notepad"),i.spellcheck=!1,i.innerHTML=t&&t.html?He(t.html):"",r.appendChild(i);const c=document.createElement("div");c.className="wos-notepad-emoji-strip",c.setAttribute("aria-label","Emojis");const l=document.createElement("div");l.className="wos-notepad-emoji-strip-inner",Kt.forEach(E=>{const d=document.createElement("button");d.type="button",d.className="wos-notepad-emoji",d.setAttribute("aria-label","Emoji"),d.textContent=E,d.addEventListener("click",()=>{i.focus({preventScroll:!0}),$e(E),A()}),l.appendChild(d)}),c.appendChild(l);const s=document.createElement("div");s.className="wos-notepad-controls";const b=document.createElement("div");b.className="wos-notepad-swatches wos-notepad-card",Ae.forEach(E=>{const d=document.createElement("button");d.type="button",d.className="wos-notepad-swatch",d.setAttribute("aria-label",`Text color ${E.id}`),d.setAttribute("data-wos-notepad-swatch",E.hex),d.style.background=E.hex,d.addEventListener("click",()=>{n=E.hex,ze(s,n),i.focus({preventScroll:!0}),de(i,n)}),b.appendChild(d)});const w=document.createElement("div");w.className="wos-notepad-trash wos-notepad-card";const p=document.createElement("button");p.type="button",p.className="wos-notepad-action",p.setAttribute("aria-label","Clear page"),p.textContent="ðŸ—‘ï¸",w.appendChild(p),s.appendChild(b),s.appendChild(w);const S=()=>{R.set(ot,{html:He(i.innerHTML),color:n})},A=Ut(S,450),C=E=>{try{E.preventDefault();const d=E.clipboardData&&E.clipboardData.getData("text/plain")||"";if(!d)return;i.focus({preventScroll:!0}),$e(d),A()}catch{}},g=()=>{A()},M=()=>{},X=()=>{i.innerHTML="",S(),i.focus({preventScroll:!0}),de(i,n)};o.appendChild(c),o.appendChild(r),o.appendChild(s),e.appendChild(o),ze(s,n),requestAnimationFrame(()=>{i.focus({preventScroll:!0}),de(i,n);try{l.scrollLeft=0}catch{}});const J=E=>{const d=E.key,ie=d&&d.length===1&&!E.ctrlKey&&!E.metaKey&&!E.altKey,x=document.activeElement,re=x&&(x.tagName==="BUTTON"||x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.hasAttribute("contenteditable"));ie&&!re&&x!==i&&i&&i.isConnected&&(i.focus({preventScroll:!0}),de(i,n))};return i.addEventListener("input",g),i.addEventListener("paste",C),r.addEventListener("pointerdown",M),p.addEventListener("click",X),document.addEventListener("keydown",J,!0),function(){try{S()}catch{}i.removeEventListener("input",g),i.removeEventListener("paste",C),r.removeEventListener("pointerdown",M),p.removeEventListener("click",X),document.removeEventListener("keydown",J,!0)}},unmount:function(){}},Gt=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),Yt={id:"numbers",title:"Numbers",iconEmoji:"ðŸ”¢",sortOrder:35,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Numbers</div>
            <div class="wos-app-placeholder-text">Count and tap!</div>
        `)},unmount:function(){}},Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"})),Jt={id:"paint",title:"Paint",iconEmoji:"ðŸŽ¨",sortOrder:10,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Paint</div>
            <div class="wos-app-placeholder-text">A simple drawing app will live here.</div>
        `)},unmount:function(){}},Zt=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"})),Qt={id:"piano",title:"Piano",iconEmoji:"ðŸŽ¹",sortOrder:50,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Piano</div>
            <div class="wos-app-placeholder-text">Tap keys to make music.</div>
        `)},unmount:function(){}},en=Object.freeze(Object.defineProperty({__proto__:null,default:Qt},Symbol.toStringTag,{value:"Module"})),tn={id:"shapes",title:"Shapes",iconEmoji:"ðŸ”º",sortOrder:40,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Shapes</div>
            <div class="wos-app-placeholder-text">Match the shapes.</div>
        `)},unmount:function(){}},nn=Object.freeze(Object.defineProperty({__proto__:null,default:tn},Symbol.toStringTag,{value:"Module"})),on={id:"story",title:"Story Time",iconEmoji:"ðŸ“–",sortOrder:20,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Story Time</div>
            <div class="wos-app-placeholder-text">Soon weâ€™ll read and play through stories here.</div>
        `)},unmount:function(){}},rn=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"}));function sn(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"&&e.id.trim()?e.id.trim():null,n=typeof e.title=="string"&&e.title.trim()?e.title.trim():null,o=typeof e.mount=="function"?e.mount:null,r=typeof e.unmount=="function"?e.unmount:null;return!t||!n||!o?null:{id:t,title:n,iconSrc:typeof e.iconSrc=="string"?e.iconSrc:null,iconEmoji:typeof e.iconEmoji=="string"?e.iconEmoji:null,sortOrder:Number.isFinite(e.sortOrder)?e.sortOrder:0,mount:o,unmount:r}}const Be=Object.assign({"./animals/app.js":Lt,"./blocks/app.js":jt,"./bubbles/app.js":Pt,"./colors/app.js":xt,"./dance/app.js":It,"./garden/app.js":Rt,"./memory/app.js":$t,"./music/app.js":Bt,"./notepad/app.js":Gt,"./numbers/app.js":Xt,"./paint/app.js":Zt,"./piano/app.js":en,"./shapes/app.js":nn,"./story/app.js":rn}),oe=new Map;Object.keys(Be).forEach(e=>{const t=Be[e],n=t&&(t.default||t.app)||null,o=sn(n);if(!o){console.warn(`WinnieOS.Apps: invalid app module at ${e}`);return}if(oe.has(o.id)){console.warn(`WinnieOS.Apps: duplicate app id "${o.id}" (skipping ${e})`);return}oe.set(o.id,o)});let L=null;async function Ke(){if(L!==null)return L;try{const e=await $.load();if(e&&e.apps&&Array.isArray(e.apps.enabled)){const t=e.apps.enabled.map(n=>String(n).trim()).filter(Boolean);L=new Set(t)}else e===null?L=new Set(["colors"]):L=new Set(oe.keys())}catch(e){console.warn("WinnieOS.Apps: failed to load config, defaulting to colors only",e),L=new Set(["colors"])}return L}function je(){return Array.from(oe.values()).sort((e,t)=>e.sortOrder!==t.sortOrder?e.sortOrder-t.sortOrder:e.title.localeCompare(t.title))}function an(e){return e?je().filter(t=>e.has(t.id)):je()}const st={list:function(){return L!==null?an(L):(Ke().catch(()=>{}),je())},get:function(e){const t=oe.get(String(e||""))||null;return!t||L!==null&&!L.has(t.id)?null:t},refreshConfig:async function(){L=null,$.clearCache&&typeof $.clearCache=="function"&&$.clearCache(),await Ke()}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Apps=st);let Ee=!1,ve={screen:"startup"};const we=new Set;function cn(e,t){return!e||!t||e.screen!==t.screen?!1:e.screen==="app"?e.appId===t.appId:!0}function at(){we.forEach(e=>{try{e(U.getState())}catch{}})}function pe(e){const t=e&&typeof e=="object"?e:{screen:"desktop"},n=t.screen==="app"?{screen:"app",appId:String(t.appId||"")}:{screen:t.screen==="startup"?"startup":"desktop"};cn(ve,n)||(ve=n,at())}const U={init:function(e){Ee||(Ee=!0,e&&e.initialState&&pe(e.initialState),at())},getState:function(){return{...ve}},subscribe:function(e){return typeof e!="function"?function(){}:(we.add(e),function(){we.delete(e)})},start:function(){pe({screen:"startup"})},goHome:function(){pe({screen:"desktop"})},openApp:function(e){pe({screen:"app",appId:e})},_resetForTests:function(){Ee=!1,ve={screen:"startup"},we.clear()}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Navigation=U);const ln="/assets/images/winnieOS_logo_temp.png",un=(function(){let e=null,t=!1;const n=new Map;function o(){n.forEach((c,l)=>{try{clearTimeout(l)}catch{}try{c()}catch{}}),n.clear()}function r(c){return new Promise(l=>{const s=setTimeout(()=>{n.delete(s),l()},c);n.set(s,l)})}async function i(c){const l=e?e.querySelector("[data-wos-startup-status]"):null,s=w=>{l&&(l.textContent=w)},b=[{label:"Waking up WinnieOS",run:()=>r(450)},{label:"Checking apps",run:()=>r(450)},{label:"Almost ready",run:()=>r(450)}];for(const w of b){if(t)return;s(w.label);try{await w.run()}catch{}}if(!t)try{c.goHome()}catch{}}return{mount:function(c){const l=c&&c.root,s=c&&c.nav;l&&(t=!1,e=document.createElement("div"),e.className="wos-startup",e.innerHTML=`
                <div class="wos-startup-logo-layer">
                    <img class="wos-startup-logo" src="${ln}" alt="WinnieOS" />
                </div>
                <div class="wos-startup-text-layer">
                    <div class="wos-startup-status">
                        <span data-wos-startup-status>Starting up</span>
                        <span class="wos-startup-dots" aria-hidden="true">
                            <span>.</span><span>.</span><span>.</span>
                        </span>
                    </div>
                </div>
            `,l.replaceChildren(e),s&&i(s))},unmount:function(){if(t=!0,o(),e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null}}})(),dn=(function(){let e=null,t=null;function n(r,i){const c=document.createElement("button");if(c.className="wos-app-tile",c.type="button",c.setAttribute("aria-label",r.title),c.addEventListener("click",()=>i.openApp(r.id)),r.iconSrc){const s=document.createElement("img");s.className="wos-app-icon",s.alt="",s.src=r.iconSrc,c.appendChild(s)}else{const s=document.createElement("div");s.className="wos-app-emoji",s.textContent=r.iconEmoji||"â­",c.appendChild(s)}const l=document.createElement("div");return l.className="wos-app-title",l.textContent=r.title,c.appendChild(l),c}function o(r,i,c){if(t)try{t()}catch{}const l=c.list();e=document.createElement("div"),e.className="wos-desktop";const s=document.createElement("div");s.className="wos-desktop-inner";const b=document.createElement("div");b.className="wos-app-grid",l.forEach(S=>{b.appendChild(n(S,i))}),s.appendChild(b),e.appendChild(s),r.replaceChildren(e);const w=()=>{if(!e)return;const S=getComputedStyle(e),A=parseFloat(S.paddingTop)||0,C=parseFloat(S.paddingBottom)||0,g=Math.max(0,e.clientHeight-A-C),M=b.getBoundingClientRect().height;M>0&&M<g?e.classList.add("wos-desktop--centered"):e.classList.remove("wos-desktop--centered")},p=requestAnimationFrame(w);window.addEventListener("resize",w),t=()=>{try{cancelAnimationFrame(p)}catch{}window.removeEventListener("resize",w)}}return{mount:async function(r){const i=r&&r.root,c=r&&r.nav,l=r&&r.apps;if(!(!i||!c||!l)){if(l.refreshConfig&&typeof l.refreshConfig=="function")try{await l.refreshConfig()}catch(s){console.warn("DesktopScreen: Failed to load config, using safe defaults",s)}o(i,c,l)}},unmount:function(){if(t)try{t()}catch{}if(t=null,e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null}}})(),pn=(function(){let e=null,t=null,n=null,o=null;function r(){if(typeof o=="function")try{o()}catch{}if(n&&typeof n.unmount=="function")try{n.unmount()}catch{}o=null,n=null}return{mount:function(i){const c=i&&i.root,l=i&&i.nav,s=i&&i.apps,b=i&&i.appId;if(!c||!s)return;e=document.createElement("div"),e.className="wos-app-host",t=document.createElement("div"),t.className="wos-app-root",e.appendChild(t),c.replaceChildren(e);const w=s.get(b);if(!w){t.className="wos-app-placeholder",t.innerHTML=`
                    <div class="wos-app-placeholder-title">Oops!</div>
                    <div class="wos-app-placeholder-text">That app isnâ€™t here yet.</div>
                `;return}n=w;try{const p=w.mount({root:t,nav:l});o=typeof p=="function"?p:null}catch{t.className="wos-app-placeholder",t.innerHTML=`
                    <div class="wos-app-placeholder-title">Uh oh!</div>
                    <div class="wos-app-placeholder-text">This app had a little problem starting.</div>
                `,n=null,o=null}},unmount:function(){if(r(),e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null,t=null}}})(),ke={startup:un,desktop:dn,app:pn};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Screens=ke);let Oe=!1,fe=null,N=null,H=null,I=null,Pe=null;function fn(){return document.getElementById("winnieos-canvas")}function mn(){const e=fn();if(!e)return!1;const t=e.querySelector(".wos-html-fallback");if(t&&t.parentNode)try{t.parentNode.removeChild(t)}catch{}N=e.querySelector("#wos-shell"),N||(N=document.createElement("div"),N.id="wos-shell",e.appendChild(N));let n=N.querySelector("#wos-topbar");n||(n=document.createElement("div"),n.id="wos-topbar",N.appendChild(n));let o=N.querySelector("#wos-home-btn");return o||(o=document.createElement("button"),o.id="wos-home-btn",o.type="button",o.setAttribute("aria-label","Home"),o.innerHTML=`
            <svg class="wos-home-icon" aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                <path fill="currentColor" d="M12 3.2 3 10.4v10.4h6.2v-6.2h5.6v6.2H21V10.4L12 3.2Zm7 15.6h-2.6v-6.2H7.6v6.2H5V11.4l7-5.6 7 5.6v7.4Z"/>
            </svg>
        `,o.addEventListener("click",()=>U.goHome()),n.appendChild(o)),H=N.querySelector("#wos-content"),H||(H=document.createElement("div"),H.id="wos-content",N.appendChild(H)),!0}function ct(){if(I&&typeof I.unmount=="function")try{I.unmount()}catch{}I=null}async function Ue(e){if(!H||!N)return;const t=e&&e.screen?e.screen:"desktop";N.dataset.screen=t;const n=ke[t]||ke.desktop,o=t==="app"?`app:${String(e&&e.appId||"")}`:t;if(!(I===n&&Pe===o)&&(ct(),I=n,Pe=o,I&&typeof I.mount=="function"))try{const r=I.mount({root:H,nav:U,apps:st,appId:e&&e.appId});r&&typeof r.then=="function"&&await r}catch(r){console.error("Shell: Error mounting screen",r)}}const ge={init:function(){Oe||mn()&&(Oe=!0,U.init({initialState:{screen:"startup"}}),fe=U.subscribe(Ue),Ue(U.getState()))},_resetForTests:function(){if(fe)try{fe()}catch{}fe=null,ct(),Oe=!1,N=null,H=null,Pe=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Shell=ge);function qe(){!ge||typeof ge.init!="function"||ge.init()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",qe):qe();
