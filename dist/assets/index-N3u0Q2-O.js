(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const G="winnieos.display.reference",ne={width:1280,height:800};let c=null;function J(e){if(e==null)return null;const t=String(e).trim();if(!t)return null;const n=t.match(/^([0-9.]+)px$/i);if(!n)return null;const i=Number(n[1]);return Number.isFinite(i)?i:null}function A(e,t,n){const i=Math.round(Number(e));return Number.isFinite(i)?Math.min(n,Math.max(t,i)):null}function ie(e){return!!e&&Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>=320&&e.height>=240&&e.width<=7680&&e.height<=4320}function oe(){const e=document.documentElement,t=window.getComputedStyle(e),n=J(t.getPropertyValue("--ref-width")),i=J(t.getPropertyValue("--ref-height"));return Number.isFinite(n)&&Number.isFinite(i)&&n>0&&i>0?{width:Math.round(n),height:Math.round(i)}:null}function ue(){try{const e=window.localStorage.getItem(G);if(!e)return null;const t=JSON.parse(e);if(!t||typeof t!="object")return null;const n=A(t.width,320,7680),i=A(t.height,240,4320),o={width:n,height:i};return ie(o)?o:null}catch{return null}}function de(e){try{window.localStorage.setItem(G,JSON.stringify(e))}catch{}}function pe(){try{window.localStorage.removeItem(G)}catch{}}function $(e){const t=document.documentElement;t.style.setProperty("--ref-width",e.width+"px"),t.style.setProperty("--ref-height",e.height+"px"),t.style.setProperty("--ref-aspect-ratio",String(e.width/e.height)),t.dataset.refWidth=String(e.width),t.dataset.refHeight=String(e.height)}function I(e){try{const t=new CustomEvent("winnieos:displaychange",{detail:{reference:{width:e.width,height:e.height}}});document.dispatchEvent(t)}catch{}}function z(){c||(c=ue()||oe()||ne,$(c))}const h={init:function(){z(),I(c)},getReferenceSize:function(){return z(),{width:c.width,height:c.height}},setReferenceSize:function(e){z();const t=A(e&&e.width,320,7680),n=A(e&&e.height,240,4320),i={width:t,height:n};return ie(i)?(c=i,$(c),(!e||e.persist!==!1)&&de(c),I(c),!0):!1},resetReferenceSize:function(){c=oe()||ne,pe(),$(c),I(c)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Display=h);let W=null,S=null,O=!1,y=null;function T(){return W||(W=document.getElementById("winnieos-canvas")),W}function V(){if(h&&typeof h.getReferenceSize=="function"){const i=h.getReferenceSize();if(i&&Number.isFinite(i.width)&&Number.isFinite(i.height)&&i.width>0&&i.height>0)return{width:i.width,height:i.height}}const e=window.getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--ref-width")),n=parseFloat(e.getPropertyValue("--ref-height"));return Number.isFinite(t)&&Number.isFinite(n)&&t>0&&n>0?{width:Math.round(t),height:Math.round(n)}:{width:1280,height:800}}function re(){const e=window.visualViewport;return e&&typeof e.width=="number"&&typeof e.height=="number"?{width:e.width,height:e.height,offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}:{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0}}function fe(){const e=T();if(!e)return;const t=V(),n=t.width,i=t.height,o=re(),r=o.width,s=o.height,l=Math.min(r/n,s/i),a=n*l,m=i*l,d=Math.round(o.offsetLeft+(r-a)/2),g=Math.round(o.offsetTop+(s-m)/2);e.style.position="fixed",e.style.width=n+"px",e.style.height=i+"px",e.style.left=d+"px",e.style.top=g+"px",e.style.margin="0",e.style.padding="0",e.style.transformOrigin="top left";const D=String(se(l));e.style.transform=`scale(${D})`,e.dataset.scale=D,e.dataset.vw=String(Math.round(r)),e.dataset.vh=String(Math.round(s)),e.dataset.left=String(d),e.dataset.top=String(g),document.documentElement.style.setProperty("--viewport-scale",D)}function p(){S||(S=window.requestAnimationFrame(function(){S=null,fe()}))}function se(e){return Math.round(e*1e5)/1e5}const K={init:function(){O||T()&&(O=!0,p(),window.addEventListener("resize",p),document.addEventListener("winnieos:displaychange",p),window.visualViewport&&(y=window.visualViewport,y.addEventListener("resize",p),y.addEventListener("scroll",p)))},getScale:function(){const e=T();return e?parseFloat(e.dataset.scale||"1"):1},getReferenceSize:function(){return V()},getMetrics:function(){const e=V(),t=re(),n=T(),i=n?parseFloat(n.dataset.scale||"1"):se(Math.min(t.width/e.width,t.height/e.height));return{reference:{width:e.width,height:e.height},viewport:{width:t.width,height:t.height,offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0},scale:i}},refresh:function(){p()},_resetForTests:function(){if(O&&(window.removeEventListener("resize",p),document.removeEventListener("winnieos:displaychange",p),y&&(y.removeEventListener("resize",p),y.removeEventListener("scroll",p))),S&&typeof window.cancelAnimationFrame=="function")try{window.cancelAnimationFrame(S)}catch{}O=!1,S=null,W=null,y=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Viewport=K);let _=!1,E=null;function Y(e){return e.preventDefault(),!1}function x(e){if(e.key==="F5"||e.ctrlKey&&(e.key==="r"||e.key==="R")||e.altKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight")||e.key==="Backspace"&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&!e.target.isContentEditable||e.ctrlKey&&(e.key==="w"||e.key==="W"))return e.preventDefault(),!1}function X(e){if(e.button===1)return e.preventDefault(),!1}function he(e){return e.preventDefault(),!1}const q={init:function(){_||(_=!0,document.addEventListener("contextmenu",Y),document.addEventListener("keydown",x),document.addEventListener("mousedown",X),E=he,document.addEventListener("dragstart",E))},_resetForTests:function(){_&&(document.removeEventListener("contextmenu",Y),document.removeEventListener("keydown",x),document.removeEventListener("mousedown",X),E&&document.removeEventListener("dragstart",E)),_=!1,E=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Kiosk=q);let N=null,b=null;async function we(e,t){const n=typeof AbortController<"u"?new AbortController:null,i=n?setTimeout(()=>n.abort(),t):null;try{const o=await fetch(e,{cache:"no-store",signal:n?n.signal:void 0});return o.ok?await o.json():null}catch{return null}finally{i&&clearTimeout(i)}}const M={load:async function(){return N||b||(b=(async()=>(N=await we("/winnieos-config.json",750)||null,b=null,N))(),b)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Config=M);const me="winnieos.display.reference";function ge(){try{return!!window.localStorage.getItem(me)}catch{return!1}}function ye(e){const t=e&&e.display&&e.display.reference;if(!t||!Number.isFinite(t.width)||!Number.isFinite(t.height)||t.width<=0||t.height<=0||ge())return;if(h&&typeof h.setReferenceSize=="function"){h.setReferenceSize({width:t.width,height:t.height,persist:!1});return}const n=document.documentElement;n.style.setProperty("--ref-width",`${Math.round(t.width)}px`),n.style.setProperty("--ref-height",`${Math.round(t.height)}px`),n.style.setProperty("--ref-aspect-ratio",String(t.width/t.height))}function Q(){const e=M&&typeof M.load=="function"?M.load():Promise.resolve(null);h?h.init():console.warn("WinnieOS: Display module failed to load; falling back to CSS reference tokens"),K?K.init():console.error("WinnieOS: Viewport module failed to load"),q?q.init():console.error("WinnieOS: Kiosk module failed to load"),e.then(ye).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Q):Q();const ve={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=ve);const Se={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Components=Se);const Ee={id:"music",title:"Music",iconEmoji:"üéµ",sortOrder:30,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Music</div>
            <div class="wos-app-placeholder-text">This will become a simple music player with big buttons.</div>
        `)},unmount:function(){}},be=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"})),Oe={id:"paint",title:"Paint",iconEmoji:"üé®",sortOrder:10,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Paint</div>
            <div class="wos-app-placeholder-text">A simple drawing app will live here.</div>
        `)},unmount:function(){}},_e=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),Ne={id:"story",title:"Story Time",iconEmoji:"üìñ",sortOrder:20,mount:function(e){const t=e&&e.root;t&&(t.className="wos-app-placeholder",t.innerHTML=`
            <div class="wos-app-placeholder-title">Story Time</div>
            <div class="wos-app-placeholder-text">Soon we‚Äôll read and play through stories here.</div>
        `)},unmount:function(){}},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));function Le(e){if(!e||typeof e!="object")return null;const t=typeof e.id=="string"&&e.id.trim()?e.id.trim():null,n=typeof e.title=="string"&&e.title.trim()?e.title.trim():null,i=typeof e.mount=="function"?e.mount:null,o=typeof e.unmount=="function"?e.unmount:null;return!t||!n||!i?null:{id:t,title:n,iconSrc:typeof e.iconSrc=="string"?e.iconSrc:null,iconEmoji:typeof e.iconEmoji=="string"?e.iconEmoji:null,sortOrder:Number.isFinite(e.sortOrder)?e.sortOrder:0,mount:i,unmount:o}}const Z=Object.assign({"./music/app.js":be,"./paint/app.js":_e,"./story/app.js":Ce}),P=new Map;Object.keys(Z).forEach(e=>{const t=Z[e],n=t&&(t.default||t.app)||null,i=Le(n);if(!i){console.warn(`WinnieOS.Apps: invalid app module at ${e}`);return}if(P.has(i.id)){console.warn(`WinnieOS.Apps: duplicate app id "${i.id}" (skipping ${e})`);return}P.set(i.id,i)});function We(){return Array.from(P.values()).sort((e,t)=>e.sortOrder!==t.sortOrder?e.sortOrder-t.sortOrder:e.title.localeCompare(t.title))}const le={list:function(){return We()},get:function(e){return P.get(String(e||""))||null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Apps=le);let R=!1,j={screen:"startup"};const F=new Set;function Te(e,t){return!e||!t||e.screen!==t.screen?!1:e.screen==="app"?e.appId===t.appId:!0}function ae(){F.forEach(e=>{try{e(v.getState())}catch{}})}function C(e){const t=e&&typeof e=="object"?e:{screen:"desktop"},n=t.screen==="app"?{screen:"app",appId:String(t.appId||"")}:{screen:t.screen==="startup"?"startup":"desktop"};Te(j,n)||(j=n,ae())}const v={init:function(e){R||(R=!0,e&&e.initialState&&C(e.initialState),ae())},getState:function(){return{...j}},subscribe:function(e){return typeof e!="function"?function(){}:(F.add(e),function(){F.delete(e)})},start:function(){C({screen:"startup"})},goHome:function(){C({screen:"desktop"})},openApp:function(e){C({screen:"app",appId:e})},_resetForTests:function(){R=!1,j={screen:"startup"},F.clear()}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Navigation=v);const Me="/assets/images/winnieOS_logo_temp.png",Fe=(function(){let e=null,t=!1;const n=new Map;function i(){n.forEach((s,l)=>{try{clearTimeout(l)}catch{}try{s()}catch{}}),n.clear()}function o(s){return new Promise(l=>{const a=setTimeout(()=>{n.delete(a),l()},s);n.set(a,l)})}async function r(s){const l=e?e.querySelector("[data-wos-startup-status]"):null,a=d=>{l&&(l.textContent=d)},m=[{label:"Waking up WinnieOS",run:()=>o(450)},{label:"Checking apps",run:()=>o(450)},{label:"Almost ready",run:()=>o(450)}];for(const d of m){if(t)return;a(d.label);try{await d.run()}catch{}}if(!t)try{s.goHome()}catch{}}return{mount:function(s){const l=s&&s.root,a=s&&s.nav;l&&(t=!1,e=document.createElement("div"),e.className="wos-startup",e.innerHTML=`
                <img class="wos-startup-logo" src="${Me}" alt="WinnieOS" />
                <div class="wos-startup-title">WinnieOS</div>
                <div class="wos-startup-status">
                    <span data-wos-startup-status>Starting up</span>
                    <span class="wos-startup-dots" aria-hidden="true">
                        <span>.</span><span>.</span><span>.</span>
                    </span>
                </div>
            `,l.replaceChildren(e),a&&r(a))},unmount:function(){if(t=!0,i(),e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null}}})(),ke=(function(){let e=null;function t(n,i){const o=document.createElement("button");if(o.className="wos-app-tile",o.type="button",o.setAttribute("aria-label",n.title),o.addEventListener("click",()=>i.openApp(n.id)),n.iconSrc){const s=document.createElement("img");s.className="wos-app-icon",s.alt="",s.src=n.iconSrc,o.appendChild(s)}else{const s=document.createElement("div");s.className="wos-app-emoji",s.textContent=n.iconEmoji||"‚≠ê",o.appendChild(s)}const r=document.createElement("div");return r.className="wos-app-title",r.textContent=n.title,o.appendChild(r),o}return{mount:function(n){const i=n&&n.root,o=n&&n.nav,r=n&&n.apps;if(!i||!o||!r)return;const s=r.list();e=document.createElement("div"),e.className="wos-desktop";const l=document.createElement("div");l.className="wos-desktop-header",l.innerHTML=`
                <div class="wos-desktop-title">Winnie‚Äôs Desktop</div>
                <div class="wos-desktop-subtitle">Tap an app to play</div>
            `;const a=document.createElement("div");a.className="wos-app-grid",s.forEach(m=>{a.appendChild(t(m,o))}),e.appendChild(l),e.appendChild(a),i.replaceChildren(e)},unmount:function(){if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null}}})(),Ae=(function(){let e=null,t=null,n=null,i=null;function o(){if(typeof i=="function")try{i()}catch{}if(n&&typeof n.unmount=="function")try{n.unmount()}catch{}i=null,n=null}return{mount:function(r){const s=r&&r.root,l=r&&r.nav,a=r&&r.apps,m=r&&r.appId;if(!s||!a)return;e=document.createElement("div"),e.className="wos-app-host",t=document.createElement("div"),t.className="wos-app-root",e.appendChild(t),s.replaceChildren(e);const d=a.get(m);if(!d){t.className="wos-app-placeholder",t.innerHTML=`
                    <div class="wos-app-placeholder-title">Oops!</div>
                    <div class="wos-app-placeholder-text">That app isn‚Äôt here yet.</div>
                `;return}n=d;try{const g=d.mount({root:t,nav:l});i=typeof g=="function"?g:null}catch{t.className="wos-app-placeholder",t.innerHTML=`
                    <div class="wos-app-placeholder-title">Uh oh!</div>
                    <div class="wos-app-placeholder-text">This app had a little problem starting.</div>
                `,n=null,i=null}},unmount:function(){if(o(),e&&e.parentNode)try{e.parentNode.removeChild(e)}catch{}e=null,t=null}}})(),B={startup:Fe,desktop:ke,app:Ae};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Screens=B);let H=!1,L=null,u=null,w=null,f=null,U=null;function Pe(){return document.getElementById("winnieos-canvas")}function je(){const e=Pe();if(!e)return!1;const t=e.querySelector(".wos-html-fallback");if(t&&t.parentNode)try{t.parentNode.removeChild(t)}catch{}u=e.querySelector("#wos-shell"),u||(u=document.createElement("div"),u.id="wos-shell",e.appendChild(u));let n=u.querySelector("#wos-topbar");n||(n=document.createElement("div"),n.id="wos-topbar",u.appendChild(n));let i=u.querySelector("#wos-home-btn");return i||(i=document.createElement("button"),i.id="wos-home-btn",i.type="button",i.setAttribute("aria-label","Home"),i.innerHTML='<span class="wos-home-icon" aria-hidden="true">‚åÇ</span>',i.addEventListener("click",()=>v.goHome()),n.appendChild(i)),w=u.querySelector("#wos-content"),w||(w=document.createElement("div"),w.id="wos-content",u.appendChild(w)),!0}function ce(){if(f&&typeof f.unmount=="function")try{f.unmount()}catch{}f=null}function ee(e){if(!w||!u)return;const t=e&&e.screen?e.screen:"desktop";u.dataset.screen=t;const n=B[t]||B.desktop,i=t==="app"?`app:${String(e&&e.appId||"")}`:t;f===n&&U===i||(ce(),f=n,U=i,f&&typeof f.mount=="function"&&f.mount({root:w,nav:v,apps:le,appId:e&&e.appId}))}const k={init:function(){H||je()&&(H=!0,v.init({initialState:{screen:"startup"}}),L=v.subscribe(ee),ee(v.getState()))},_resetForTests:function(){if(L)try{L()}catch{}L=null,ce(),H=!1,u=null,w=null,U=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Shell=k);function te(){!k||typeof k.init!="function"||k.init()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",te):te();
