(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))v(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&v(a)}).observe(document,{childList:!0,subtree:!0});function d(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function v(s){if(s.ep)return;s.ep=!0;const e=d(s);fetch(s.href,e)}})();const Nt="winnieos.";function bt(){try{if(typeof window>"u"||!window.localStorage)return!1;const o="__storage_test__";return window.localStorage.setItem(o,"test"),window.localStorage.removeItem(o),!0}catch{return!1}}function Jt(o){if(!o||typeof o!="string")throw new Error("Storage key must be a non-empty string");return o.startsWith(Nt)?o:Nt+o}const Ge={get:function(o,f=null){if(!bt())return f;try{const d=Jt(o),v=window.localStorage.getItem(d);if(v===null)return f;try{return JSON.parse(v)}catch{return v}}catch(d){if(d.message&&d.message.includes("Storage key must be"))throw d;return f}},set:function(o,f){if(!bt())return!1;try{const d=Jt(o),v=JSON.stringify(f);return window.localStorage.setItem(d,v),!0}catch(d){if(d.message&&d.message.includes("Storage key must be"))throw d;return!1}},remove:function(o){if(!bt())return!1;try{const f=Jt(o);return window.localStorage.removeItem(f),!0}catch(f){if(f.message&&f.message.includes("Storage key must be"))throw f;return!1}},has:function(o){if(!bt())return!1;try{const f=Jt(o);return window.localStorage.getItem(f)!==null}catch(f){if(f.message&&f.message.includes("Storage key must be"))throw f;return!1}},clear:function(){if(!bt())return!1;try{const o=[];for(let f=0;f<window.localStorage.length;f++){const d=window.localStorage.key(f);d&&d.startsWith(Nt)&&o.push(d)}return o.forEach(f=>window.localStorage.removeItem(f)),!0}catch{return!1}},keys:function(){if(!bt())return[];try{const o=[];for(let f=0;f<window.localStorage.length;f++){const d=window.localStorage.key(f);d&&d.startsWith(Nt)&&o.push(d.substring(Nt.length))}return o}catch{return[]}}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils.Storage=Ge);const Un="display.reference",pi={width:1280,height:800};let Fe=null;function _n(o){if(o==null)return null;const f=String(o).trim();if(!f)return null;const d=f.match(/^([0-9.]+)px$/i);if(!d)return null;const v=Number(d[1]);return Number.isFinite(v)?v:null}function dn(o,f,d){const v=Math.round(Number(o));return Number.isFinite(v)?Math.min(d,Math.max(f,v)):null}function di(o){return!!o&&Number.isFinite(o.width)&&Number.isFinite(o.height)&&o.width>=320&&o.height>=240&&o.width<=7680&&o.height<=4320}function hi(){const o=document.documentElement,f=window.getComputedStyle(o),d=_n(f.getPropertyValue("--ref-width")),v=_n(f.getPropertyValue("--ref-height"));return Number.isFinite(d)&&Number.isFinite(v)&&d>0&&v>0?{width:Math.round(d),height:Math.round(v)}:null}function _i(){const o=Ge.get(Un);if(!o||typeof o!="object")return null;const f=dn(o.width,320,7680),d=dn(o.height,240,4320),v={width:f,height:d};return di(v)?v:null}function Qi(o){Ge.set(Un,o)}function Yi(){Ge.remove(Un)}function Ln(o){const f=document.documentElement;f.style.setProperty("--ref-width",o.width+"px"),f.style.setProperty("--ref-height",o.height+"px"),f.style.setProperty("--ref-aspect-ratio",String(o.width/o.height)),f.dataset.refWidth=String(o.width),f.dataset.refHeight=String(o.height)}function Cn(o){try{const f=new CustomEvent("winnieos:displaychange",{detail:{reference:{width:o.width,height:o.height}}});document.dispatchEvent(f)}catch{}}function An(){Fe||(Fe=_i()||hi()||pi,Ln(Fe))}const Ze={init:function(){An(),Cn(Fe)},getReferenceSize:function(){return An(),{width:Fe.width,height:Fe.height}},setReferenceSize:function(o){An();const f=dn(o&&o.width,320,7680),d=dn(o&&o.height,240,4320),v={width:f,height:d};return di(v)?(Fe=v,Ln(Fe),(!o||o.persist!==!1)&&Qi(Fe),Cn(Fe),!0):!1},resetReferenceSize:function(){Fe=hi()||pi,Yi(),Ln(Fe),Cn(Fe)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Display=Ze);let an=null,At=null,Zt=!1,pt=null;function ln(){return an||(an=document.getElementById("winnieos-canvas")),an}function In(){if(Ze&&typeof Ze.getReferenceSize=="function"){const v=Ze.getReferenceSize();if(v&&Number.isFinite(v.width)&&Number.isFinite(v.height)&&v.width>0&&v.height>0)return{width:v.width,height:v.height}}const o=window.getComputedStyle(document.documentElement),f=parseFloat(o.getPropertyValue("--ref-width")),d=parseFloat(o.getPropertyValue("--ref-height"));return Number.isFinite(f)&&Number.isFinite(d)&&f>0&&d>0?{width:Math.round(f),height:Math.round(d)}:{width:1280,height:800}}function mi(){const o=window.visualViewport;return o&&typeof o.width=="number"&&typeof o.height=="number"?{width:o.width,height:o.height,offsetLeft:o.offsetLeft||0,offsetTop:o.offsetTop||0}:{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0}}function Xi(){const o=ln();if(!o)return;const f=In(),d=f.width,v=f.height,s=mi(),e=s.width,a=s.height,i=Math.min(e/d,a/v),n=d*i,h=v*i,r=Math.round(s.offsetLeft+(e-n)/2),p=Math.round(s.offsetTop+(a-h)/2);o.style.position="fixed",o.style.width=d+"px",o.style.height=v+"px",o.style.left=r+"px",o.style.top=p+"px",o.style.margin="0",o.style.padding="0",o.style.transformOrigin="top left";const u=String(gi(i));o.style.transform=`scale(${u})`,o.dataset.scale=u,o.dataset.vw=String(Math.round(e)),o.dataset.vh=String(Math.round(a)),o.dataset.left=String(r),o.dataset.top=String(p),document.documentElement.style.setProperty("--viewport-scale",u)}function _e(){At||(At=window.requestAnimationFrame(function(){At=null,Xi()}))}function gi(o){return Math.round(o*1e5)/1e5}const ke={init:function(){Zt||ln()&&(Zt=!0,_e(),window.addEventListener("resize",_e),document.addEventListener("winnieos:displaychange",_e),window.visualViewport&&(pt=window.visualViewport,pt.addEventListener("resize",_e),pt.addEventListener("scroll",_e)))},getScale:function(){const o=ln();return o?parseFloat(o.dataset.scale||"1"):1},getReferenceSize:function(){return In()},getMetrics:function(){const o=In(),f=mi(),d=ln(),v=d?parseFloat(d.dataset.scale||"1"):gi(Math.min(f.width/o.width,f.height/o.height));return{reference:{width:o.width,height:o.height},viewport:{width:f.width,height:f.height,offsetLeft:f.offsetLeft||0,offsetTop:f.offsetTop||0},scale:v}},refresh:function(){_e()},_resetForTests:function(){if(Zt&&(window.removeEventListener("resize",_e),document.removeEventListener("winnieos:displaychange",_e),pt&&(pt.removeEventListener("resize",_e),pt.removeEventListener("scroll",_e))),At&&typeof window.cancelAnimationFrame=="function")try{window.cancelAnimationFrame(At)}catch{}Zt=!1,At=null,an=null,pt=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Viewport=ke);let en=!1,Ot=null;function Qn(o){return o.preventDefault(),!1}function Yn(o){if(o.key==="F5"||o.ctrlKey&&(o.key==="r"||o.key==="R")||o.altKey&&(o.key==="ArrowLeft"||o.key==="ArrowRight")||o.key==="Backspace"&&o.target.tagName!=="INPUT"&&o.target.tagName!=="TEXTAREA"&&!o.target.isContentEditable||o.ctrlKey&&(o.key==="w"||o.key==="W"))return o.preventDefault(),!1}function Xn(o){if(o.button===1)return o.preventDefault(),!1}function Ji(o){return o.preventDefault(),!1}const On={init:function(){en||(en=!0,document.addEventListener("contextmenu",Qn),document.addEventListener("keydown",Yn),document.addEventListener("mousedown",Xn),Ot=Ji,document.addEventListener("dragstart",Ot))},_resetForTests:function(){en&&(document.removeEventListener("contextmenu",Qn),document.removeEventListener("keydown",Yn),document.removeEventListener("mousedown",Xn),Ot&&document.removeEventListener("dragstart",Ot)),en=!1,Ot=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Kiosk=On);let Rt=null,Tt=null;function Zi(o){return new Promise(f=>setTimeout(f,o))}async function eo(o,f){const d=typeof AbortController<"u"?new AbortController:null,v=d?setTimeout(()=>d.abort(),f):null;try{const s=await fetch(o,{cache:"no-store",signal:d?d.signal:void 0});return s.ok?await s.json():null}catch{return null}finally{v&&clearTimeout(v)}}const et={load:async function(){return Rt||Tt||(Tt=(async()=>{const o=[{timeoutMs:1500,sleepMs:250},{timeoutMs:1500,sleepMs:250},{timeoutMs:2e3,sleepMs:500},{timeoutMs:2500,sleepMs:750}];let f=null;for(let d=0;d<o.length;d++){const v=o[d];if(f=await eo("/winnieos-config.json",v.timeoutMs),f&&typeof f=="object")break;v.sleepMs&&await Zi(v.sleepMs)}return Rt=f&&typeof f=="object"?f:null,Tt=null,Rt})(),Tt)},clearCache:function(){Rt=null,Tt=null}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Config=et);const vi="preferences.backgroundColor",to="#667eea",no="#764ba2";function yi(o,f,d){const v=s=>{const e=Math.round(Math.max(0,Math.min(255,s))).toString(16);return e.length===1?"0"+e:e};return`#${v(o)}${v(f)}${v(d)}`}function xi(o){if(!o||typeof o!="string")return{r:0,g:0,b:0};let f=o.replace("#","").trim();if(f.length===3&&(f=f.split("").map(e=>e+e).join("")),f.length!==6||!/^[0-9a-fA-F]{6}$/.test(f))return{r:0,g:0,b:0};const d=parseInt(f.substring(0,2),16),v=parseInt(f.substring(2,4),16),s=parseInt(f.substring(4,6),16);return!Number.isFinite(d)||!Number.isFinite(v)||!Number.isFinite(s)?{r:0,g:0,b:0}:{r:d,g:v,b:s}}function wi(o){const f=xi(o),d=f.r/255,v=f.g/255,s=f.b/255,e=Math.max(d,v,s),a=Math.min(d,v,s),i=e-a;let n=0;i!==0&&(e===d?n=(v-s)/i%6:e===v?n=(s-d)/i+2:n=(d-v)/i+4),n=Math.round(n*60),n<0&&(n+=360),n=(n+30)%360;const h=(e+a)/2,r=i===0?0:i/(1-Math.abs(2*h-1)),p=(1-Math.abs(2*h-1))*r,u=p*(1-Math.abs(n/60%2-1)),t=h-p/2;let c=0,l=0,m=0;return n<60?(c=p,l=u,m=0):n<120?(c=u,l=p,m=0):n<180?(c=0,l=p,m=u):n<240?(c=0,l=u,m=p):n<300?(c=u,l=0,m=p):(c=p,l=0,m=u),yi(Math.round((c+t)*255),Math.round((l+t)*255),Math.round((m+t)*255))}function Rn(o,f=null){if(!o||typeof o!="string")return;const d=f||wi(o),v=document.body,s=document.getElementById("winnieos-canvas");v&&v.style.setProperty("background",o),s&&s.style.setProperty("background",`linear-gradient(135deg, ${o} 0%, ${d} 100%)`)}function Si(){return Ge.get(vi,null)}function io(o){return!o||typeof o!="string"?!1:Ge.set(vi,o)}function oo(){const o=Si();o?Rn(o):Rn(to,no)}const Xe={apply:Rn,getSaved:Si,save:io,load:oo,rgbToHex:yi,hexToRgb:xi,generateSecondary:wi};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils.Background=Xe);const ro="display.reference";function so(){return Ge.has(ro)}function ao(o){const f=o&&o.display&&o.display.reference;if(!f||!Number.isFinite(f.width)||!Number.isFinite(f.height)||f.width<=0||f.height<=0||so())return;if(Ze&&typeof Ze.setReferenceSize=="function"){Ze.setReferenceSize({width:f.width,height:f.height,persist:!1});return}const d=document.documentElement;d.style.setProperty("--ref-width",`${Math.round(f.width)}px`),d.style.setProperty("--ref-height",`${Math.round(f.height)}px`),d.style.setProperty("--ref-aspect-ratio",String(f.width/f.height))}function Jn(){const o=et&&typeof et.load=="function"?et.load():Promise.resolve(null);Ze?Ze.init():console.warn("WinnieOS: Display module failed to load; falling back to CSS reference tokens"),ke?ke.init():console.error("WinnieOS: Viewport module failed to load"),On?On.init():console.error("WinnieOS: Kiosk module failed to load"),Xe&&typeof Xe.load=="function"&&Xe.load(),o.then(ao).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Jn):Jn();let He=null,j=null,Vt=null,rt=null,Ft=null,Fn=!1,Pt=null,Dt=1;const Dn=-24,Mi=18,Zn=new Map,lo={tick:.06,plink:.03,pop:.08,buzz:.1,thud:.05,launch:.12,bounce:.02,reward:.2,poof:.18,ready:.3,binBounce:.03,scoreTick:.09,star:.35,type:.028};function co(){return He?He.currentTime:0}function hn(o,f,d){const v=Number(o);return Number.isFinite(v)?Math.max(f,Math.min(d,v)):f}function we(o){const f=Number(o);return Number.isFinite(f)?Math.max(0,Math.min(1,f)):0}function uo(o){return Number.isFinite(o)?Math.pow(10,o/20):0}function bi(o){const f=we(o),d=Math.pow(f,1.35);return Dn+(Mi-Dn)*d}function Nn(o,{immediate:f=!1}={}){const d=ce();if(!d||!Vt)return;const v=d.currentTime,s=Vt.gain,e=uo(o);s.cancelScheduledValues(v),f?s.setValueAtTime(e,v):s.setTargetAtTime(e,v,.03)}function Ne(o){const f=co(),d=lo[o]||0,v=Zn.get(o)||-1/0;return f-v<d?!1:(Zn.set(o,f),!0)}function ce(){if(He)return He;const o=window.AudioContext||window.webkitAudioContext;if(!o)return null;He=new o({latencyHint:"interactive"}),j=He.createGain(),j.gain.value=1,rt=He.createDynamicsCompressor(),rt.threshold.value=-6,rt.knee.value=0,rt.ratio.value=20,rt.attack.value=.002,rt.release.value=.1,Vt=He.createGain(),Nn(bi(Dt),{immediate:!0}),Ft=He.createWaveShaper(),Ft.oversample="4x";const f=2048,d=new Float32Array(f);for(let v=0;v<f;v++){const s=v*2/(f-1)-1;d[v]=Math.tanh(1.35*s)}return Ft.curve=d,j.connect(Vt),Vt.connect(rt),rt.connect(Ft),Ft.connect(He.destination),He}async function fo(){const o=ce();if(!o)return!1;if(Fn)return!0;try{o.state==="suspended"&&await o.resume();const f=o.currentTime,d=o.createOscillator(),v=o.createGain();return v.gain.setValueAtTime(1e-5,f),d.frequency.setValueAtTime(440,f),d.connect(v),v.connect(j),d.start(f),d.stop(f+.01),Fn=!0,!0}catch{return!1}}function me(o,f,d,v,s,e){const a=o.gain;a.cancelScheduledValues(f),a.setValueAtTime(Math.max(0,e),f),a.linearRampToValueAtTime(Math.max(0,s),f+d),a.exponentialRampToValueAtTime(Math.max(1e-5,e),f+d+v)}function Ht(o){const f=ce();if(!f)return null;const d=f.sampleRate,v=Math.max(1,Math.floor(o*d)),s=f.createBuffer(1,v,d),e=s.getChannelData(0);for(let a=0;a<v;a++)e[a]=Math.random()*2-1;return s}function Ye(o,f,{gainPeak:d=.02,gainFloor:v=1e-5,hpHz:s=1800,bpHz:e=null,bpQ:a=1}={}){const i=ce();if(!i||!j)return;const n=Ht(f);if(!n)return;const h=i.createBufferSource();h.buffer=n;const r=i.createGain();if(me(r,o,.001,Math.max(.02,f),d,v),e&&Number.isFinite(e)){const p=i.createBiquadFilter();p.type="bandpass",p.frequency.setValueAtTime(e,o),p.Q.setValueAtTime(a,o),h.connect(p),p.connect(r)}else{const p=i.createBiquadFilter();p.type="highpass",p.frequency.setValueAtTime(s,o),h.connect(p),p.connect(r)}r.connect(j),h.start(o),h.stop(o+f+.02)}function po(o=.8){const f=ce();if(!f||!j||!Ne("launch"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(1400+1e3*d,v),s.type="sawtooth";const i=220+120*d,n=720+260*d;s.frequency.setValueAtTime(i,v),s.frequency.exponentialRampToValueAtTime(n,v+.12),me(e,v,.003,.16,.11*(.65+.35*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),s.stop(v+.18),Ye(v,.06,{gainPeak:.01+.014*d,bpHz:2600+900*d,bpQ:.9})}function ho(o=.4,f="peg"){const d=ce();if(!d||!j||!Ne("bounce"))return;const v=we(o),s=d.currentTime,e=d.createOscillator(),a=d.createGain(),i=d.createBiquadFilter();i.type="bandpass",i.Q.setValueAtTime(.9+.6*v,s),i.frequency.setValueAtTime((f==="wall"?520:f==="bin"?380:760)+520*v,s),e.type=f==="wall"||f==="bin"?"sine":"triangle";const n=(f==="wall"?220:f==="bin"?160:360)+520*v;e.frequency.setValueAtTime(n,s),e.frequency.exponentialRampToValueAtTime(Math.max(60,n*.92),s+.08),me(a,s,.001,f==="wall"?.1:f==="bin"?.13:.07,.06*(.25+.75*v),1e-5),e.connect(i),i.connect(a),a.connect(j),e.start(s),e.stop(s+.11),v>.35&&Ye(s,.03,{gainPeak:(f==="bin"?.006:.004)+.01*v,hpHz:(f==="bin"?2200:3200)+900*v})}function mo(o=.4){const f=ce();if(!f||!j||!Ne("binBounce"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(900+500*d,v),s.type="sine";const i=130+110*d;s.frequency.setValueAtTime(i,v),s.frequency.exponentialRampToValueAtTime(Math.max(60,i*.82),v+.14),me(e,v,.001,.16,.07*(.25+.75*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),s.stop(v+.2),Ye(v,.06,{gainPeak:.004+.008*d,bpHz:720+220*d,bpQ:.9})}function go(o=.6,f=180){const d=ce();if(!d||!j)return;const v=we(o),s=d.currentTime,e=d.createOscillator(),a=d.createGain(),i=d.createBiquadFilter();i.type="lowpass",i.frequency.setValueAtTime(800+900*v,s),e.type="sine";const n=Math.max(80,f);e.frequency.setValueAtTime(n,s),e.frequency.exponentialRampToValueAtTime(Math.max(60,n*.76),s+.12),me(a,s,.001,.14,.09*(.35+.65*v),1e-5),e.connect(i),i.connect(a),a.connect(j),e.start(s),e.stop(s+.18),Ye(s,.025,{gainPeak:.003+.006*v,hpHz:2800+700*v})}function vo(o=2e3,f=.6){const d=ce();if(!d)return function(){};const v=we(f),s=d.currentTime,e=s+Math.max(.2,o/1e3);let a=!1;const i=new Set,n=()=>{if(a)return;const h=d.currentTime;if(h>=e)return;const r=we((h-s)/Math.max(1e-4,e-s)),p=(1-r)*.16+.05,u=150+120*r;go(.45+.45*v,u);const t=setTimeout(()=>{i.delete(t),n()},Math.round(p*1e3));i.add(t)};return n(),function(){a=!0;for(const r of Array.from(i))try{clearTimeout(r)}catch{}i.clear()}}function yo(o="blue",f=.8){const d=ce();if(!d||!j||!Ne("reward"))return;const v=we(f),s=d.currentTime,e={red:{f:520,type:"square",sparkle:3200},orange:{f:460,type:"sawtooth",sparkle:3e3},yellow:{f:600,type:"triangle",sparkle:3600},green:{f:420,type:"triangle",sparkle:2600},blue:{f:560,type:"sine",sparkle:2400},purple:{f:480,type:"sawtooth",sparkle:2800}},a=e[String(o||"").toLowerCase()]||e.blue,i=d.createOscillator(),n=d.createOscillator(),h=d.createGain(),r=d.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(1400+1100*v,s),i.type=a.type,n.type="sine",i.frequency.setValueAtTime(a.f,s),n.frequency.setValueAtTime(a.f*1.18,s),me(h,s,.003,.2,.14*(.55+.45*v),1e-5),i.connect(r),n.connect(r),r.connect(h),h.connect(j),i.start(s),n.start(s),i.stop(s+.24),n.stop(s+.24),Ye(s,.08,{gainPeak:.008+.014*v,bpHz:a.sparkle,bpQ:.8})}function xo(o=.6){const f=ce();if(!f||!j||!Ne("poof"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(600+300*d,v),s.type="sine";const i=160+40*d;s.frequency.setValueAtTime(i,v),s.frequency.exponentialRampToValueAtTime(Math.max(60,i*.72),v+.14),me(e,v,.002,.16,.07*(.5+.5*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),s.stop(v+.2),Ye(v,.1,{gainPeak:.01+.012*d,bpHz:420+120*d,bpQ:.7})}function wo(o=.6){const f=ce();if(!f||!j||!Ne("ready"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createOscillator(),a=f.createGain(),i=f.createBiquadFilter();i.type="lowpass",i.frequency.setValueAtTime(1800+1200*d,v),s.type="triangle",e.type="sine";const n=520+120*d;s.frequency.setValueAtTime(n,v),s.frequency.exponentialRampToValueAtTime(n*1.6,v+.16),e.frequency.setValueAtTime(n*2,v+.02),me(a,v,.003,.18,.11*(.55+.45*d),1e-5),s.connect(i),e.connect(i),i.connect(a),a.connect(j),s.start(v),e.start(v),s.stop(v+.22),e.stop(v+.22),Ye(v+.03,.07,{gainPeak:.007+.01*d,bpHz:3100+700*d,bpQ:.9})}function So(){const o=ce();if(!o||!j||!Ne("tick"))return;const f=o.currentTime,d=o.createOscillator(),v=o.createGain();d.type="sine",d.frequency.setValueAtTime(920,f),me(v,f,.001,.03,.015,1e-5),d.connect(v),v.connect(j),d.start(f),d.stop(f+.04)}function Mo(o=.6){const f=ce();if(!f||!j||!Ne("pop"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createOscillator(),a=f.createGain(),i=520;s.type="triangle",e.type="sine",s.frequency.setValueAtTime(i,v),e.frequency.setValueAtTime(i*1.24,v),me(a,v,.002,.09,.1*(.6+.4*d),1e-5),s.connect(a),e.connect(a),a.connect(j),s.start(v),e.start(v),s.stop(v+.12),e.stop(v+.12);const n=Ht(.06);if(n){const h=f.createBufferSource();h.buffer=n;const r=f.createGain(),p=f.createBiquadFilter();p.type="highpass",p.frequency.setValueAtTime(2600,v),me(r,v,.001,.06,.018*(.6+.4*d),1e-5),h.connect(p),p.connect(r),r.connect(j),h.start(v),h.stop(v+.07)}}function bo(o=.7){const f=ce();if(!f||!j||!Ne("buzz"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(1400+600*d,v),s.type="square",s.frequency.setValueAtTime(155+25*d,v);const i=f.createOscillator(),n=f.createGain();i.type="sine",i.frequency.setValueAtTime(16,v),n.gain.setValueAtTime(10+8*d,v),i.connect(n),n.connect(s.frequency),me(e,v,.004,.12,.085*(.6+.4*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),i.start(v),s.stop(v+.15),i.stop(v+.15);const h=Ht(.09);if(h){const r=f.createBufferSource();r.buffer=h;const p=f.createBiquadFilter();p.type="bandpass",p.frequency.setValueAtTime(520,v),p.Q.setValueAtTime(1.2,v);const u=f.createGain();me(u,v,.002,.1,.028*(.55+.45*d),1e-5),r.connect(p),p.connect(u),u.connect(j),r.start(v),r.stop(v+.11)}}function To(o=.4){const f=ce();if(!f||!j||!Ne("plink"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="highpass",a.frequency.setValueAtTime(220+1800*d,v),s.type="triangle";const i=420+260*d,n=(Math.random()*2-1)*16;s.frequency.setValueAtTime(i,v),s.detune.setValueAtTime(n,v),me(e,v,.001,.07,.07*(.35+.65*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),s.stop(v+.09);const h=Ht(.04);if(h){const r=f.createBufferSource();r.buffer=h;const p=f.createBiquadFilter();p.type="highpass",p.frequency.setValueAtTime(3e3,v);const u=f.createGain();me(u,v,.001,.04,.012*(.3+.7*d),1e-5),r.connect(p),p.connect(u),u.connect(j),r.start(v),r.stop(v+.05)}}function Co(o=.45,f="alpha"){const d=ce();if(!d||!j||!Ne("type"))return;const v=we(o),s=d.currentTime,e=d.createOscillator(),a=d.createGain(),i=d.createBiquadFilter();i.type="highpass",i.frequency.setValueAtTime(900+2200*v,s),e.type="square";const n=f==="space"?180+120*Math.random():f==="enter"?240+160*Math.random():260+520*Math.random();e.frequency.setValueAtTime(n,s),e.detune.setValueAtTime((Math.random()*2-1)*28,s),me(a,s,.001,.045+.02*Math.random(),.016*(.35+.65*v),1e-5),e.connect(i),i.connect(a),a.connect(j),e.start(s),e.stop(s+.08);const h=d.createOscillator(),r=d.createOscillator(),p=d.createGain(),u=d.createBiquadFilter();u.type="lowpass",u.frequency.setValueAtTime(1200+1200*v,s),h.type="triangle",r.type="sine";const t=f==="space"?320+180*Math.random():f==="enter"?420+240*Math.random():420+520*Math.random(),c=1.1+.22*Math.random();if(h.frequency.setValueAtTime(t,s),r.frequency.setValueAtTime(t*c,s),h.detune.setValueAtTime((Math.random()*2-1)*18,s),r.detune.setValueAtTime((Math.random()*2-1)*18,s),h.frequency.exponentialRampToValueAtTime(t*(1.1+.1*Math.random()),s+.035),me(p,s,.001,.07+.03*Math.random(),.02*(.35+.65*v),1e-5),h.connect(u),r.connect(u),u.connect(p),p.connect(j),h.start(s),r.start(s),h.stop(s+.11),r.stop(s+.11),Math.random()<.55+.25*v&&Ye(s,.02+.015*Math.random(),{gainPeak:.0012+.0022*v,bpHz:2200+2200*Math.random(),bpQ:.8+.6*Math.random()}),Math.random()<.1){const l=s+.028+.02*Math.random(),m=d.createOscillator(),w=d.createGain();m.type="square",m.frequency.setValueAtTime(520+820*Math.random(),l),me(w,l,.001,.028,.005*(.35+.65*v),1e-5),m.connect(w),w.connect(j),m.start(l),m.stop(l+.05)}}function Ao(o){const f=hn(Number(o),0,360);return 120*Math.pow(2,f/360*3)}function Ti(o=0){const f=He,d=Pt;if(Pt=null,!d)return;const v=f?f.currentTime+Math.max(0,o):0;try{d.g&&d.g.gain&&(d.g.gain.cancelScheduledValues(v),d.g.gain.setTargetAtTime(1e-5,v,.02))}catch{}const s=v+.12;try{d.osc1&&d.osc1.stop(s)}catch{}try{d.osc2&&d.osc2.stop(s)}catch{}try{d.lfo&&d.lfo.stop(s)}catch{}try{d.noise&&d.noise.stop(s)}catch{}setTimeout(()=>{try{d.osc1&&d.osc1.disconnect()}catch{}try{d.osc2&&d.osc2.disconnect()}catch{}try{d.lfo&&d.lfo.disconnect()}catch{}try{d.noise&&d.noise.disconnect()}catch{}try{d.filt&&d.filt.disconnect()}catch{}try{d.noiseFilt&&d.noiseFilt.disconnect()}catch{}try{d.g&&d.g.disconnect()}catch{}try{d.noiseGain&&d.noiseGain.disconnect()}catch{}},220)}function Ci(){const o=ce();if(!o||!j)return!1;Ti(0);const f=o.currentTime,d=o.createGain();d.gain.setValueAtTime(1e-5,f);const v=o.createOscillator(),s=o.createOscillator(),e=o.createBiquadFilter();e.type="lowpass",e.frequency.setValueAtTime(1800,f),e.Q.setValueAtTime(.5,f),v.type="triangle",s.type="sine";const a=(Math.random()*2-1)*9;v.detune.setValueAtTime(a,f),s.detune.setValueAtTime(-a,f);const i=o.createOscillator(),n=o.createGain();i.type="sine",i.frequency.setValueAtTime(7.5,f),n.gain.setValueAtTime(0,f),i.connect(n),n.connect(v.frequency),n.connect(s.frequency),v.connect(e),s.connect(e),e.connect(d),d.connect(j);const h=Ht(.8);let r=null,p=null,u=null;return h&&(r=o.createBufferSource(),r.buffer=h,r.loop=!0,p=o.createBiquadFilter(),p.type="bandpass",p.frequency.setValueAtTime(1200,f),p.Q.setValueAtTime(.8,f),u=o.createGain(),u.gain.setValueAtTime(1e-5,f),r.connect(p),p.connect(u),u.connect(j),r.start(f)),v.start(f),s.start(f),i.start(f),Pt={g:d,osc1:v,osc2:s,filt:e,lfo:i,lfoGain:n,noise:r,noiseFilt:p,noiseGain:u},!0}function Po({hue:o=0,t01:f=0,speed01:d=.4}={}){const v=ce();if(!v||!j||(Pt||Ci(),!Pt))return;const s=Pt,e=v.currentTime,a=we(f),i=we(d),n=Ao(o),h=.92+.18*a,r=hn(n*h,110,1200),p=hn(r*(1.12+.16*Math.sin(o/360*Math.PI*2)),140,1600);try{s.osc1.frequency.setTargetAtTime(r,e,.015),s.osc2.frequency.setTargetAtTime(p,e,.015)}catch{}const u=800+5200*a;try{s.filt.frequency.setTargetAtTime(u,e,.03)}catch{}const t=.8+10*a;try{s.lfoGain.gain.setTargetAtTime(t,e,.05)}catch{}const c=(.0012+.006*i)*(.5+.65*a);try{s.g.gain.setTargetAtTime(c,e,.02)}catch{}if(s.noiseGain){const l=(35e-5+.0018*i)*(.45+.55*a);try{s.noiseGain.gain.setTargetAtTime(l,e,.02)}catch{}}if(s.noiseFilt){const l=900+2400*a+300*i;try{s.noiseFilt.frequency.setTargetAtTime(l,e,.03)}catch{}}}function Eo(o=.7){const f=ce();if(!f||!j||!Ne("scoreTick"))return;const d=we(o),v=f.currentTime,s=f.createOscillator(),e=f.createGain(),a=f.createBiquadFilter();a.type="bandpass",a.Q.setValueAtTime(1.1+.6*d,v),a.frequency.setValueAtTime(980+520*d,v),s.type="sine",s.frequency.setValueAtTime(820+460*d,v),s.frequency.exponentialRampToValueAtTime(1200+700*d,v+.04),me(e,v,.001,.07,.06*(.55+.45*d),1e-5),s.connect(a),a.connect(e),e.connect(j),s.start(v),s.stop(v+.09),d>.35&&Ye(v,.03,{gainPeak:.003+.004*d,hpHz:4200+900*d})}function ko(o=.9){const f=ce();if(!f||!j||!Ne("star"))return;const d=we(o),v=f.currentTime,s=[660,880+40*d,1175+80*d];for(let e=0;e<s.length;e++){const a=f.createOscillator(),i=f.createGain(),n=v+e*.045;a.type="triangle",a.frequency.setValueAtTime(s[e],n),me(i,n,.001,.11,.05*(.65+.35*d),1e-5),a.connect(i),i.connect(j),a.start(n),a.stop(n+.13)}Ye(v+.02,.12,{gainPeak:.006+.01*d,gainFloor:1e-5,hpHz:2500,bpHz:4200+800*d,bpQ:.9})}const R={ensure:function(){return!!ce()},unlock:function(){return fo()},isUnlocked:function(){return Fn},setMasterLevel:function(o,f){return Dt=we(o),Nn(bi(Dt),f||{}),Dt},getMasterLevel:function(){return Dt},setMasterDb:function(o,f){const d=hn(o,Dn,Mi);return Nn(d,f||{}),d},tick:function(){So()},pop:function(o){Mo(o)},buzz:function(o){bo(o)},plink:function(o){To(o)},launch:function(o){po(o)},bounce:function(o,f){ho(o,f)},binBounce:function(o){mo(o)},reward:function(o,f){yo(o,f)},scoreTick:function(o){Eo(o)},star:function(o){ko(o)},poof:function(o){xo(o)},ready:function(o){wo(o)},type:function(o,f){Co(o,f)},colorDragStart:function(){return Ci()},colorDragUpdate:function({hue:o,t:f,speed:d}={}){Po({hue:o,t01:f,speed01:d})},colorDragStop:function(){Ti(0)},drumroll:function(o,f){return vo(o,f)}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils.Audio=R);typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Utils=window.WinnieOS.Utils||{},window.WinnieOS.Utils);const Bo={};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Components=Bo);const Lo={id:"animals",title:"Animals",iconEmoji:"ðŸ¦",sortOrder:25,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Animals</div>
            <div class="wos-app-placeholder-text">Animal sounds and matching will live here.</div>
        `)},unmount:function(){}},Io=Object.freeze(Object.defineProperty({__proto__:null,default:Lo},Symbol.toStringTag,{value:"Module"})),Oo={id:"blocks",title:"Blocks",iconEmoji:"ðŸ§±",sortOrder:15,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Blocks</div>
            <div class="wos-app-placeholder-text">A building blocks game will live here.</div>
        `)},unmount:function(){}},Ro=Object.freeze(Object.defineProperty({__proto__:null,default:Oo},Symbol.toStringTag,{value:"Module"})),Fo={id:"bubbles",title:"Bubbles",iconEmoji:"ðŸ«§",sortOrder:20,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Bubbles</div>
            <div class="wos-app-placeholder-text">Pop pop pop!</div>
        `)},unmount:function(){}},Do=Object.freeze(Object.defineProperty({__proto__:null,default:Fo},Symbol.toStringTag,{value:"Module"})),No={id:"colors",title:"Colors",iconEmoji:"ðŸŒˆ",sortOrder:30,mount:function({root:o}){if(!o)return;try{R.ensure()}catch{}o.className="wos-colors-app",o.innerHTML="";const f=document.createElement("div");f.className="wos-colors-container";const d=document.createElement("div");d.className="wos-colors-picker",d.setAttribute("role","application"),d.setAttribute("aria-label","Color picker");const v=document.createElement("canvas");v.className="wos-colors-canvas";const s=.35,e=.95;let a=0;const i=M=>Math.max(0,Math.min(1,M)),n=(M,B,I)=>{M=M%360,M<0&&(M+=360);const L=I*B,F=L*(1-Math.abs(M/60%2-1)),O=I-L;let N=0,V=0,z=0;return M<60?(N=L,V=F,z=0):M<120?(N=F,V=L,z=0):M<180?(N=0,V=L,z=F):M<240?(N=0,V=F,z=L):M<300?(N=F,V=0,z=L):(N=L,V=0,z=F),{r:Math.round((N+O)*255),g:Math.round((V+O)*255),b:Math.round((z+O)*255)}},h=(M,B,I)=>{M=M/255,B=B/255,I=I/255;const L=Math.max(M,B,I),F=Math.min(M,B,I),O=L-F;let N=0;O!==0&&(L===M?N=(B-I)/O%6:L===B?N=(I-M)/O+2:N=(M-B)/O+4),N=Math.round(N*60),N<0&&(N+=360);const V=L===0?0:O/L;return{h:N,s:V,v:L}},r=()=>{const M=d.getBoundingClientRect(),B=Math.max(1,M.width),I=Math.max(1,M.height),L=B/2,F=I/2,O=Math.min(L,F);return{rect:M,width:B,height:I,cx:L,cy:F,radius:O}},p=M=>s+(1-s)*i(M),u=M=>i((M-s)/(1-s)),t=(M,B)=>{const{rect:I,width:L,height:F,cx:O,cy:N,radius:V}=r(),z=M-I.left,Z=B-I.top,J=z-O,ee=Z-N,ue=Math.sqrt(J*J+ee*ee),fe=Math.min(V,ue),K=Math.atan2(ee,J),ge=ue<1?a:(K*180/Math.PI+360)%360,oe=V<=0?0:fe/V;return{width:L,height:F,cx:O,cy:N,radius:V,dx:J,dy:ee,distance:ue,distClamped:fe,angle:K,hue:ge,t:oe}},c=({hue:M,t:B})=>{const I=p(B),L=n(M,I,e);return Xe.rgbToHex(L.r,L.g,L.b)},l=document.createElement("div");l.className="wos-colors-indicator",l.setAttribute("aria-hidden","true");const m=({cx:M,cy:B,radius:I,angle:L,distClamped:F,width:O,height:N})=>{const V=M+Math.cos(L)*F,z=B+Math.sin(L)*F;l.style.left=`${V/O*100}%`,l.style.top=`${z/N*100}%`},w=()=>{const M=Xe.getSaved(),{width:B,height:I,cx:L,cy:F,radius:O}=r();if(!M||O<=0){l.style.left="50%",l.style.top="50%";return}const N=Xe.hexToRgb(M),V=h(N.r,N.g,N.b);a=V.h;const z=u(V.s),Z=V.h*Math.PI/180,J=z*O,ee=L+Math.cos(Z)*J,ue=F+Math.sin(Z)*J;l.style.left=`${ee/B*100}%`,l.style.top=`${ue/I*100}%`},T=()=>{const M=d.getBoundingClientRect(),B=window.devicePixelRatio||1,I=Math.max(1,Math.floor(M.width)),L=Math.max(1,Math.floor(M.height)),F=Math.max(1,Math.floor(I*B)),O=Math.max(1,Math.floor(L*B));v.width=F,v.height=O;const N=v.getContext("2d");if(!N)return;const V=N.createImageData(F,O),z=V.data,Z=F/2,J=O/2,ee=Math.min(Z,J);for(let ue=0;ue<O;ue++)for(let fe=0;fe<F;fe++){const K=fe-Z,ge=ue-J,oe=Math.sqrt(K*K+ge*ge),Ie=(ue*F+fe)*4;if(oe>ee){z[Ie+3]=0;continue}const Be=(Math.atan2(ge,K)*180/Math.PI+360)%360,ve=ee<=0?0:oe/ee,Et=p(ve),lt=n(Be,Et,e);z[Ie]=lt.r,z[Ie+1]=lt.g,z[Ie+2]=lt.b,z[Ie+3]=255}N.putImageData(V,0,0)};d.appendChild(v),d.appendChild(l),f.appendChild(d),o.appendChild(f),requestAnimationFrame(()=>{T(),w()});const A=new ResizeObserver(()=>{T(),w()});A.observe(d);let E=null,g=null;const x=()=>typeof performance<"u"&&performance.now?performance.now():Date.now(),S=(M,B,I)=>{try{if(!M)return;const L=x();let F=.35;if(g&&Number.isFinite(g.ts)){const O=Math.max(1,L-g.ts),N=B-g.x,V=I-g.y,Z=Math.sqrt(N*N+V*V)/O;F=Math.max(0,Math.min(1,Z/1.6))}g={x:B,y:I,ts:L},R&&typeof R.colorDragUpdate=="function"&&R.colorDragUpdate({hue:M.hue,t:M.t,speed:F})}catch{}},y=(M,B)=>{const I=t(M,B);a=I.hue,m(I);const L=c(I);l.classList.add("wos-colors-indicator-active"),setTimeout(()=>{l.classList.remove("wos-colors-indicator-active")},180),Xe.apply(L),Xe.save(L),E!==null&&R&&S(I,M,B)},C=M=>{if(E!==null)return;E=M.pointerId;try{d.setPointerCapture(E)}catch{}M.preventDefault(),(()=>{try{if(R&&typeof R.isUnlocked=="function"&&R.isUnlocked())return Promise.resolve(!0);if(R&&typeof R.unlock=="function")return R.unlock().then(()=>!0).catch(()=>!1)}catch{}return Promise.resolve(!1)})().then(I=>{if(I){try{R&&typeof R.colorDragStart=="function"&&R.colorDragStart()}catch{}try{const L=t(M.clientX,M.clientY);S(L,M.clientX,M.clientY)}catch{}}}),g=null,y(M.clientX,M.clientY)},b=M=>{E===null||M.pointerId!==E||(M.preventDefault(),y(M.clientX,M.clientY))},P=M=>{if(!(E===null||M.pointerId!==E)){M.preventDefault();try{d.releasePointerCapture(E)}catch{}E=null,g=null;try{R&&typeof R.colorDragStop=="function"&&R.colorDragStop()}catch{}}};return d.addEventListener("pointerdown",C),d.addEventListener("pointermove",b),d.addEventListener("pointerup",P),d.addEventListener("pointercancel",P),function(){try{A.disconnect()}catch{}d.removeEventListener("pointerdown",C),d.removeEventListener("pointermove",b),d.removeEventListener("pointerup",P),d.removeEventListener("pointercancel",P);try{R&&typeof R.colorDragStop=="function"&&R.colorDragStop()}catch{}}},unmount:function(){}},Vo=Object.freeze(Object.defineProperty({__proto__:null,default:No},Symbol.toStringTag,{value:"Module"})),Wo={id:"dance",title:"Dance",iconEmoji:"ðŸ’ƒ",sortOrder:55,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Dance</div>
            <div class="wos-app-placeholder-text">A dance party will live here.</div>
        `)},unmount:function(){}},Ho=Object.freeze(Object.defineProperty({__proto__:null,default:Wo},Symbol.toStringTag,{value:"Module"})),Uo={id:"garden",title:"Garden",iconEmoji:"ðŸŒ»",sortOrder:60,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Garden</div>
            <div class="wos-app-placeholder-text">Plant and grow little flowers.</div>
        `)},unmount:function(){}},zo=Object.freeze(Object.defineProperty({__proto__:null,default:Uo},Symbol.toStringTag,{value:"Module"}));var ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $o(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var cn={exports:{}};var Go=cn.exports,ti;function jo(){return ti||(ti=1,(function(o,f){(function(v,s){o.exports=s()})(Go,function(){return(function(d){var v={};function s(e){if(v[e])return v[e].exports;var a=v[e]={i:e,l:!1,exports:{}};return d[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=d,s.c=v,s.d=function(e,a,i){s.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:i})},s.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,a){if(a&1&&(e=s(e)),a&8||a&4&&typeof e=="object"&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),a&2&&typeof e!="string")for(var n in e)s.d(i,n,(function(h){return e[h]}).bind(null,n));return i},s.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(a,"a",a),a},s.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},s.p="",s(s.s=20)})([(function(d,v){var s={};d.exports=s,(function(){s._baseDelta=1e3/60,s._nextId=0,s._seed=0,s._nowStartTime=+new Date,s._warnedOnce={},s._decomp=null,s.extend=function(a,i){var n,h;typeof i=="boolean"?(n=2,h=i):(n=1,h=!0);for(var r=n;r<arguments.length;r++){var p=arguments[r];if(p)for(var u in p)h&&p[u]&&p[u].constructor===Object&&(!a[u]||a[u].constructor===Object)?(a[u]=a[u]||{},s.extend(a[u],h,p[u])):a[u]=p[u]}return a},s.clone=function(a,i){return s.extend({},i,a)},s.keys=function(a){if(Object.keys)return Object.keys(a);var i=[];for(var n in a)i.push(n);return i},s.values=function(a){var i=[];if(Object.keys){for(var n=Object.keys(a),h=0;h<n.length;h++)i.push(a[n[h]]);return i}for(var r in a)i.push(a[r]);return i},s.get=function(a,i,n,h){i=i.split(".").slice(n,h);for(var r=0;r<i.length;r+=1)a=a[i[r]];return a},s.set=function(a,i,n,h,r){var p=i.split(".").slice(h,r);return s.get(a,i,0,-1)[p[p.length-1]]=n,n},s.shuffle=function(a){for(var i=a.length-1;i>0;i--){var n=Math.floor(s.random()*(i+1)),h=a[i];a[i]=a[n],a[n]=h}return a},s.choose=function(a){return a[Math.floor(s.random()*a.length)]},s.isElement=function(a){return typeof HTMLElement<"u"?a instanceof HTMLElement:!!(a&&a.nodeType&&a.nodeName)},s.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},s.isFunction=function(a){return typeof a=="function"},s.isPlainObject=function(a){return typeof a=="object"&&a.constructor===Object},s.isString=function(a){return toString.call(a)==="[object String]"},s.clamp=function(a,i,n){return a<i?i:a>n?n:a},s.sign=function(a){return a<0?-1:1},s.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-s._nowStartTime},s.random=function(a,i){return a=typeof a<"u"?a:0,i=typeof i<"u"?i:1,a+e()*(i-a)};var e=function(){return s._seed=(s._seed*9301+49297)%233280,s._seed/233280};s.colorToNumber=function(a){return a=a.replace("#",""),a.length==3&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},s.logLevel=1,s.log=function(){console&&s.logLevel>0&&s.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.info=function(){console&&s.logLevel>0&&s.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.warn=function(){console&&s.logLevel>0&&s.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},s.warnOnce=function(){var a=Array.prototype.slice.call(arguments).join(" ");s._warnedOnce[a]||(s.warn(a),s._warnedOnce[a]=!0)},s.deprecated=function(a,i,n){a[i]=s.chain(function(){s.warnOnce("ðŸ”… deprecated ðŸ”…",n)},a[i])},s.nextId=function(){return s._nextId++},s.indexOf=function(a,i){if(a.indexOf)return a.indexOf(i);for(var n=0;n<a.length;n++)if(a[n]===i)return n;return-1},s.map=function(a,i){if(a.map)return a.map(i);for(var n=[],h=0;h<a.length;h+=1)n.push(i(a[h]));return n},s.topologicalSort=function(a){var i=[],n=[],h=[];for(var r in a)!n[r]&&!h[r]&&s._topologicalSort(r,n,h,a,i);return i},s._topologicalSort=function(a,i,n,h,r){var p=h[a]||[];n[a]=!0;for(var u=0;u<p.length;u+=1){var t=p[u];n[t]||i[t]||s._topologicalSort(t,i,n,h,r)}n[a]=!1,i[a]=!0,r.push(a)},s.chain=function(){for(var a=[],i=0;i<arguments.length;i+=1){var n=arguments[i];n._chained?a.push.apply(a,n._chained):a.push(n)}var h=function(){for(var r,p=new Array(arguments.length),u=0,t=arguments.length;u<t;u++)p[u]=arguments[u];for(u=0;u<a.length;u+=1){var c=a[u].apply(r,p);typeof c<"u"&&(r=c)}return r};return h._chained=a,h},s.chainPathBefore=function(a,i,n){return s.set(a,i,s.chain(n,s.get(a,i)))},s.chainPathAfter=function(a,i,n){return s.set(a,i,s.chain(s.get(a,i),n))},s.setDecomp=function(a){s._decomp=a},s.getDecomp=function(){var a=s._decomp;try{!a&&typeof window<"u"&&(a=window.decomp),!a&&typeof ei<"u"&&(a=ei.decomp)}catch{a=null}return a}})()}),(function(d,v){var s={};d.exports=s,(function(){s.create=function(e){var a={min:{x:0,y:0},max:{x:0,y:0}};return e&&s.update(a,e),a},s.update=function(e,a,i){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var n=0;n<a.length;n++){var h=a[n];h.x>e.max.x&&(e.max.x=h.x),h.x<e.min.x&&(e.min.x=h.x),h.y>e.max.y&&(e.max.y=h.y),h.y<e.min.y&&(e.min.y=h.y)}i&&(i.x>0?e.max.x+=i.x:e.min.x+=i.x,i.y>0?e.max.y+=i.y:e.min.y+=i.y)},s.contains=function(e,a){return a.x>=e.min.x&&a.x<=e.max.x&&a.y>=e.min.y&&a.y<=e.max.y},s.overlaps=function(e,a){return e.min.x<=a.max.x&&e.max.x>=a.min.x&&e.max.y>=a.min.y&&e.min.y<=a.max.y},s.translate=function(e,a){e.min.x+=a.x,e.max.x+=a.x,e.min.y+=a.y,e.max.y+=a.y},s.shift=function(e,a){var i=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=a.x,e.max.x=a.x+i,e.min.y=a.y,e.max.y=a.y+n}})()}),(function(d,v){var s={};d.exports=s,(function(){s.create=function(e,a){return{x:e||0,y:a||0}},s.clone=function(e){return{x:e.x,y:e.y}},s.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},s.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},s.rotate=function(e,a,i){var n=Math.cos(a),h=Math.sin(a);i||(i={});var r=e.x*n-e.y*h;return i.y=e.x*h+e.y*n,i.x=r,i},s.rotateAbout=function(e,a,i,n){var h=Math.cos(a),r=Math.sin(a);n||(n={});var p=i.x+((e.x-i.x)*h-(e.y-i.y)*r);return n.y=i.y+((e.x-i.x)*r+(e.y-i.y)*h),n.x=p,n},s.normalise=function(e){var a=s.magnitude(e);return a===0?{x:0,y:0}:{x:e.x/a,y:e.y/a}},s.dot=function(e,a){return e.x*a.x+e.y*a.y},s.cross=function(e,a){return e.x*a.y-e.y*a.x},s.cross3=function(e,a,i){return(a.x-e.x)*(i.y-e.y)-(a.y-e.y)*(i.x-e.x)},s.add=function(e,a,i){return i||(i={}),i.x=e.x+a.x,i.y=e.y+a.y,i},s.sub=function(e,a,i){return i||(i={}),i.x=e.x-a.x,i.y=e.y-a.y,i},s.mult=function(e,a){return{x:e.x*a,y:e.y*a}},s.div=function(e,a){return{x:e.x/a,y:e.y/a}},s.perp=function(e,a){return a=a===!0?-1:1,{x:a*-e.y,y:a*e.x}},s.neg=function(e){return{x:-e.x,y:-e.y}},s.angle=function(e,a){return Math.atan2(a.y-e.y,a.x-e.x)},s._temp=[s.create(),s.create(),s.create(),s.create(),s.create(),s.create()]})()}),(function(d,v,s){var e={};d.exports=e;var a=s(2),i=s(0);(function(){e.create=function(n,h){for(var r=[],p=0;p<n.length;p++){var u=n[p],t={x:u.x,y:u.y,index:p,body:h,isInternal:!1};r.push(t)}return r},e.fromPath=function(n,h){var r=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,p=[];return n.replace(r,function(u,t,c){p.push({x:parseFloat(t),y:parseFloat(c)})}),e.create(p,h)},e.centre=function(n){for(var h=e.area(n,!0),r={x:0,y:0},p,u,t,c=0;c<n.length;c++)t=(c+1)%n.length,p=a.cross(n[c],n[t]),u=a.mult(a.add(n[c],n[t]),p),r=a.add(r,u);return a.div(r,6*h)},e.mean=function(n){for(var h={x:0,y:0},r=0;r<n.length;r++)h.x+=n[r].x,h.y+=n[r].y;return a.div(h,n.length)},e.area=function(n,h){for(var r=0,p=n.length-1,u=0;u<n.length;u++)r+=(n[p].x-n[u].x)*(n[p].y+n[u].y),p=u;return h?r/2:Math.abs(r)/2},e.inertia=function(n,h){for(var r=0,p=0,u=n,t,c,l=0;l<u.length;l++)c=(l+1)%u.length,t=Math.abs(a.cross(u[c],u[l])),r+=t*(a.dot(u[c],u[c])+a.dot(u[c],u[l])+a.dot(u[l],u[l])),p+=t;return h/6*(r/p)},e.translate=function(n,h,r){r=typeof r<"u"?r:1;var p=n.length,u=h.x*r,t=h.y*r,c;for(c=0;c<p;c++)n[c].x+=u,n[c].y+=t;return n},e.rotate=function(n,h,r){if(h!==0){var p=Math.cos(h),u=Math.sin(h),t=r.x,c=r.y,l=n.length,m,w,T,A;for(A=0;A<l;A++)m=n[A],w=m.x-t,T=m.y-c,m.x=t+(w*p-T*u),m.y=c+(w*u+T*p);return n}},e.contains=function(n,h){for(var r=h.x,p=h.y,u=n.length,t=n[u-1],c,l=0;l<u;l++){if(c=n[l],(r-t.x)*(c.y-t.y)+(p-t.y)*(t.x-c.x)>0)return!1;t=c}return!0},e.scale=function(n,h,r,p){if(h===1&&r===1)return n;p=p||e.centre(n);for(var u,t,c=0;c<n.length;c++)u=n[c],t=a.sub(u,p),n[c].x=p.x+t.x*h,n[c].y=p.y+t.y*r;return n},e.chamfer=function(n,h,r,p,u){typeof h=="number"?h=[h]:h=h||[8],r=typeof r<"u"?r:-1,p=p||2,u=u||14;for(var t=[],c=0;c<n.length;c++){var l=n[c-1>=0?c-1:n.length-1],m=n[c],w=n[(c+1)%n.length],T=h[c<h.length?c:h.length-1];if(T===0){t.push(m);continue}var A=a.normalise({x:m.y-l.y,y:l.x-m.x}),E=a.normalise({x:w.y-m.y,y:m.x-w.x}),g=Math.sqrt(2*Math.pow(T,2)),x=a.mult(i.clone(A),T),S=a.normalise(a.mult(a.add(A,E),.5)),y=a.sub(m,a.mult(S,g)),C=r;r===-1&&(C=Math.pow(T,.32)*1.75),C=i.clamp(C,p,u),C%2===1&&(C+=1);for(var b=Math.acos(a.dot(A,E)),P=b/C,M=0;M<C;M++)t.push(a.add(a.rotate(x,P*M),y))}return t},e.clockwiseSort=function(n){var h=e.mean(n);return n.sort(function(r,p){return a.angle(h,r)-a.angle(h,p)}),n},e.isConvex=function(n){var h=0,r=n.length,p,u,t,c;if(r<3)return null;for(p=0;p<r;p++)if(u=(p+1)%r,t=(p+2)%r,c=(n[u].x-n[p].x)*(n[t].y-n[u].y),c-=(n[u].y-n[p].y)*(n[t].x-n[u].x),c<0?h|=1:c>0&&(h|=2),h===3)return!1;return h!==0?!0:null},e.hull=function(n){var h=[],r=[],p,u;for(n=n.slice(0),n.sort(function(t,c){var l=t.x-c.x;return l!==0?l:t.y-c.y}),u=0;u<n.length;u+=1){for(p=n[u];r.length>=2&&a.cross3(r[r.length-2],r[r.length-1],p)<=0;)r.pop();r.push(p)}for(u=n.length-1;u>=0;u-=1){for(p=n[u];h.length>=2&&a.cross3(h[h.length-2],h[h.length-1],p)<=0;)h.pop();h.push(p)}return h.pop(),r.pop(),h.concat(r)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(2),n=s(7),h=s(0),r=s(1),p=s(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var c={id:h.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:a.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},l=h.extend(c,t);return u(l,t),l},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var u=function(t,c){c=c||{},e.set(t,{bounds:t.bounds||r.create(t.vertices),positionPrev:t.positionPrev||i.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),a.rotate(t.vertices,t.angle,t.position),p.rotate(t.axes,t.angle),r.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:c.axes||t.axes,area:c.area||t.area,mass:c.mass||t.mass,inertia:c.inertia||t.inertia});var l=t.isStatic?"#14151f":h.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),m=t.isStatic?"#555":"#ccc",w=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||l,t.render.strokeStyle=t.render.strokeStyle||m,t.render.lineWidth=t.render.lineWidth||w,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,c,l){var m;typeof c=="string"&&(m=c,c={},c[m]=l);for(m in c)if(Object.prototype.hasOwnProperty.call(c,m))switch(l=c[m],m){case"isStatic":e.setStatic(t,l);break;case"isSleeping":n.set(t,l);break;case"mass":e.setMass(t,l);break;case"density":e.setDensity(t,l);break;case"inertia":e.setInertia(t,l);break;case"vertices":e.setVertices(t,l);break;case"position":e.setPosition(t,l);break;case"angle":e.setAngle(t,l);break;case"velocity":e.setVelocity(t,l);break;case"angularVelocity":e.setAngularVelocity(t,l);break;case"speed":e.setSpeed(t,l);break;case"angularSpeed":e.setAngularSpeed(t,l);break;case"parts":e.setParts(t,l);break;case"centre":e.setCentre(t,l);break;default:t[m]=l}},e.setStatic=function(t,c){for(var l=0;l<t.parts.length;l++){var m=t.parts[l];c?(m.isStatic||(m._original={restitution:m.restitution,friction:m.friction,mass:m.mass,inertia:m.inertia,density:m.density,inverseMass:m.inverseMass,inverseInertia:m.inverseInertia}),m.restitution=0,m.friction=1,m.mass=m.inertia=m.density=1/0,m.inverseMass=m.inverseInertia=0,m.positionPrev.x=m.position.x,m.positionPrev.y=m.position.y,m.anglePrev=m.angle,m.angularVelocity=0,m.speed=0,m.angularSpeed=0,m.motion=0):m._original&&(m.restitution=m._original.restitution,m.friction=m._original.friction,m.mass=m._original.mass,m.inertia=m._original.inertia,m.density=m._original.density,m.inverseMass=m._original.inverseMass,m.inverseInertia=m._original.inverseInertia,m._original=null),m.isStatic=c}},e.setMass=function(t,c){var l=t.inertia/(t.mass/6);t.inertia=l*(c/6),t.inverseInertia=1/t.inertia,t.mass=c,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,c){e.setMass(t,c*t.area),t.density=c},e.setInertia=function(t,c){t.inertia=c,t.inverseInertia=1/t.inertia},e.setVertices=function(t,c){c[0].body===t?t.vertices=c:t.vertices=a.create(c,t),t.axes=p.fromVertices(t.vertices),t.area=a.area(t.vertices),e.setMass(t,t.density*t.area);var l=a.centre(t.vertices);a.translate(t.vertices,l,-1),e.setInertia(t,e._inertiaScale*a.inertia(t.vertices,t.mass)),a.translate(t.vertices,t.position),r.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,c,l){var m;for(c=c.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,m=0;m<c.length;m++){var w=c[m];w!==t&&(w.parent=t,t.parts.push(w))}if(t.parts.length!==1){if(l=typeof l<"u"?l:!0,l){var T=[];for(m=0;m<c.length;m++)T=T.concat(c[m].vertices);a.clockwiseSort(T);var A=a.hull(T),E=a.centre(A);e.setVertices(t,A),a.translate(t.vertices,E)}var g=e._totalProperties(t);t.area=g.area,t.parent=t,t.position.x=g.centre.x,t.position.y=g.centre.y,t.positionPrev.x=g.centre.x,t.positionPrev.y=g.centre.y,e.setMass(t,g.mass),e.setInertia(t,g.inertia),e.setPosition(t,g.centre)}},e.setCentre=function(t,c,l){l?(t.positionPrev.x+=c.x,t.positionPrev.y+=c.y,t.position.x+=c.x,t.position.y+=c.y):(t.positionPrev.x=c.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=c.y-(t.position.y-t.positionPrev.y),t.position.x=c.x,t.position.y=c.y)},e.setPosition=function(t,c,l){var m=i.sub(c,t.position);l?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=m.x,t.velocity.y=m.y,t.speed=i.magnitude(m)):(t.positionPrev.x+=m.x,t.positionPrev.y+=m.y);for(var w=0;w<t.parts.length;w++){var T=t.parts[w];T.position.x+=m.x,T.position.y+=m.y,a.translate(T.vertices,m),r.update(T.bounds,T.vertices,t.velocity)}},e.setAngle=function(t,c,l){var m=c-t.angle;l?(t.anglePrev=t.angle,t.angularVelocity=m,t.angularSpeed=Math.abs(m)):t.anglePrev+=m;for(var w=0;w<t.parts.length;w++){var T=t.parts[w];T.angle+=m,a.rotate(T.vertices,m,t.position),p.rotate(T.axes,m),r.update(T.bounds,T.vertices,t.velocity),w>0&&i.rotateAbout(T.position,m,t.position,T.position)}},e.setVelocity=function(t,c){var l=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-c.x*l,t.positionPrev.y=t.position.y-c.y*l,t.velocity.x=(t.position.x-t.positionPrev.x)/l,t.velocity.y=(t.position.y-t.positionPrev.y)/l,t.speed=i.magnitude(t.velocity)},e.getVelocity=function(t){var c=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*c,y:(t.position.y-t.positionPrev.y)*c}},e.getSpeed=function(t){return i.magnitude(e.getVelocity(t))},e.setSpeed=function(t,c){e.setVelocity(t,i.mult(i.normalise(e.getVelocity(t)),c))},e.setAngularVelocity=function(t,c){var l=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-c*l,t.angularVelocity=(t.angle-t.anglePrev)/l,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,c){e.setAngularVelocity(t,h.sign(e.getAngularVelocity(t))*c)},e.translate=function(t,c,l){e.setPosition(t,i.add(t.position,c),l)},e.rotate=function(t,c,l,m){if(!l)e.setAngle(t,t.angle+c,m);else{var w=Math.cos(c),T=Math.sin(c),A=t.position.x-l.x,E=t.position.y-l.y;e.setPosition(t,{x:l.x+(A*w-E*T),y:l.y+(A*T+E*w)},m),e.setAngle(t,t.angle+c,m)}},e.scale=function(t,c,l,m){var w=0,T=0;m=m||t.position;for(var A=0;A<t.parts.length;A++){var E=t.parts[A];a.scale(E.vertices,c,l,m),E.axes=p.fromVertices(E.vertices),E.area=a.area(E.vertices),e.setMass(E,t.density*E.area),a.translate(E.vertices,{x:-E.position.x,y:-E.position.y}),e.setInertia(E,e._inertiaScale*a.inertia(E.vertices,E.mass)),a.translate(E.vertices,{x:E.position.x,y:E.position.y}),A>0&&(w+=E.area,T+=E.inertia),E.position.x=m.x+(E.position.x-m.x)*c,E.position.y=m.y+(E.position.y-m.y)*l,r.update(E.bounds,E.vertices,t.velocity)}t.parts.length>1&&(t.area=w,t.isStatic||(e.setMass(t,t.density*w),e.setInertia(t,T))),t.circleRadius&&(c===l?t.circleRadius*=c:t.circleRadius=null)},e.update=function(t,c){c=(typeof c<"u"?c:1e3/60)*t.timeScale;var l=c*c,m=e._timeCorrection?c/(t.deltaTime||c):1,w=1-t.frictionAir*(c/h._baseDelta),T=(t.position.x-t.positionPrev.x)*m,A=(t.position.y-t.positionPrev.y)*m;t.velocity.x=T*w+t.force.x/t.mass*l,t.velocity.y=A*w+t.force.y/t.mass*l,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=c,t.angularVelocity=(t.angle-t.anglePrev)*w*m+t.torque/t.inertia*l,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var E=0;E<t.parts.length;E++){var g=t.parts[E];a.translate(g.vertices,t.velocity),E>0&&(g.position.x+=t.velocity.x,g.position.y+=t.velocity.y),t.angularVelocity!==0&&(a.rotate(g.vertices,t.angularVelocity,t.position),p.rotate(g.axes,t.angularVelocity),E>0&&i.rotateAbout(g.position,t.angularVelocity,t.position,g.position)),r.update(g.bounds,g.vertices,t.velocity)}},e.updateVelocities=function(t){var c=e._baseDelta/t.deltaTime,l=t.velocity;l.x=(t.position.x-t.positionPrev.x)*c,l.y=(t.position.y-t.positionPrev.y)*c,t.speed=Math.sqrt(l.x*l.x+l.y*l.y),t.angularVelocity=(t.angle-t.anglePrev)*c,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,c,l){var m={x:c.x-t.position.x,y:c.y-t.position.y};t.force.x+=l.x,t.force.y+=l.y,t.torque+=m.x*l.y-m.y*l.x},e._totalProperties=function(t){for(var c={mass:0,area:0,inertia:0,centre:{x:0,y:0}},l=t.parts.length===1?0:1;l<t.parts.length;l++){var m=t.parts[l],w=m.mass!==1/0?m.mass:1;c.mass+=w,c.area+=m.area,c.inertia+=m.inertia,c.centre=i.add(c.centre,i.mult(m.position,w))}return c.centre=i.div(c.centre,c.mass),c}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(0);(function(){e.on=function(i,n,h){for(var r=n.split(" "),p,u=0;u<r.length;u++)p=r[u],i.events=i.events||{},i.events[p]=i.events[p]||[],i.events[p].push(h);return h},e.off=function(i,n,h){if(!n){i.events={};return}typeof n=="function"&&(h=n,n=a.keys(i.events).join(" "));for(var r=n.split(" "),p=0;p<r.length;p++){var u=i.events[r[p]],t=[];if(h&&u)for(var c=0;c<u.length;c++)u[c]!==h&&t.push(u[c]);i.events[r[p]]=t}},e.trigger=function(i,n,h){var r,p,u,t,c=i.events;if(c&&a.keys(c).length>0){h||(h={}),r=n.split(" ");for(var l=0;l<r.length;l++)if(p=r[l],u=c[p],u){t=a.clone(h,!1),t.name=p,t.source=i;for(var m=0;m<u.length;m++)u[m].apply(i,[t])}}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(5),i=s(0),n=s(1),h=s(4);(function(){e.create=function(r){return i.extend({id:i.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},r)},e.setModified=function(r,p,u,t){if(r.isModified=p,p&&r.cache&&(r.cache.allBodies=null,r.cache.allConstraints=null,r.cache.allComposites=null),u&&r.parent&&e.setModified(r.parent,p,u,t),t)for(var c=0;c<r.composites.length;c++){var l=r.composites[c];e.setModified(l,p,u,t)}},e.add=function(r,p){var u=[].concat(p);a.trigger(r,"beforeAdd",{object:p});for(var t=0;t<u.length;t++){var c=u[t];switch(c.type){case"body":if(c.parent!==c){i.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(r,c);break;case"constraint":e.addConstraint(r,c);break;case"composite":e.addComposite(r,c);break;case"mouseConstraint":e.addConstraint(r,c.constraint);break}}return a.trigger(r,"afterAdd",{object:p}),r},e.remove=function(r,p,u){var t=[].concat(p);a.trigger(r,"beforeRemove",{object:p});for(var c=0;c<t.length;c++){var l=t[c];switch(l.type){case"body":e.removeBody(r,l,u);break;case"constraint":e.removeConstraint(r,l,u);break;case"composite":e.removeComposite(r,l,u);break;case"mouseConstraint":e.removeConstraint(r,l.constraint);break}}return a.trigger(r,"afterRemove",{object:p}),r},e.addComposite=function(r,p){return r.composites.push(p),p.parent=r,e.setModified(r,!0,!0,!1),r},e.removeComposite=function(r,p,u){var t=i.indexOf(r.composites,p);if(t!==-1){var c=e.allBodies(p);e.removeCompositeAt(r,t);for(var l=0;l<c.length;l++)c[l].sleepCounter=0}if(u)for(var l=0;l<r.composites.length;l++)e.removeComposite(r.composites[l],p,!0);return r},e.removeCompositeAt=function(r,p){return r.composites.splice(p,1),e.setModified(r,!0,!0,!1),r},e.addBody=function(r,p){return r.bodies.push(p),e.setModified(r,!0,!0,!1),r},e.removeBody=function(r,p,u){var t=i.indexOf(r.bodies,p);if(t!==-1&&(e.removeBodyAt(r,t),p.sleepCounter=0),u)for(var c=0;c<r.composites.length;c++)e.removeBody(r.composites[c],p,!0);return r},e.removeBodyAt=function(r,p){return r.bodies.splice(p,1),e.setModified(r,!0,!0,!1),r},e.addConstraint=function(r,p){return r.constraints.push(p),e.setModified(r,!0,!0,!1),r},e.removeConstraint=function(r,p,u){var t=i.indexOf(r.constraints,p);if(t!==-1&&e.removeConstraintAt(r,t),u)for(var c=0;c<r.composites.length;c++)e.removeConstraint(r.composites[c],p,!0);return r},e.removeConstraintAt=function(r,p){return r.constraints.splice(p,1),e.setModified(r,!0,!0,!1),r},e.clear=function(r,p,u){if(u)for(var t=0;t<r.composites.length;t++)e.clear(r.composites[t],p,!0);return p?r.bodies=r.bodies.filter(function(c){return c.isStatic}):r.bodies.length=0,r.constraints.length=0,r.composites.length=0,e.setModified(r,!0,!0,!1),r},e.allBodies=function(r){if(r.cache&&r.cache.allBodies)return r.cache.allBodies;for(var p=[].concat(r.bodies),u=0;u<r.composites.length;u++)p=p.concat(e.allBodies(r.composites[u]));return r.cache&&(r.cache.allBodies=p),p},e.allConstraints=function(r){if(r.cache&&r.cache.allConstraints)return r.cache.allConstraints;for(var p=[].concat(r.constraints),u=0;u<r.composites.length;u++)p=p.concat(e.allConstraints(r.composites[u]));return r.cache&&(r.cache.allConstraints=p),p},e.allComposites=function(r){if(r.cache&&r.cache.allComposites)return r.cache.allComposites;for(var p=[].concat(r.composites),u=0;u<r.composites.length;u++)p=p.concat(e.allComposites(r.composites[u]));return r.cache&&(r.cache.allComposites=p),p},e.get=function(r,p,u){var t,c;switch(u){case"body":t=e.allBodies(r);break;case"constraint":t=e.allConstraints(r);break;case"composite":t=e.allComposites(r).concat(r);break}return t?(c=t.filter(function(l){return l.id.toString()===p.toString()}),c.length===0?null:c[0]):null},e.move=function(r,p,u){return e.remove(r,p),e.add(u,p),r},e.rebase=function(r){for(var p=e.allBodies(r).concat(e.allConstraints(r)).concat(e.allComposites(r)),u=0;u<p.length;u++)p[u].id=i.nextId();return r},e.translate=function(r,p,u){for(var t=u?e.allBodies(r):r.bodies,c=0;c<t.length;c++)h.translate(t[c],p);return r},e.rotate=function(r,p,u,t){for(var c=Math.cos(p),l=Math.sin(p),m=t?e.allBodies(r):r.bodies,w=0;w<m.length;w++){var T=m[w],A=T.position.x-u.x,E=T.position.y-u.y;h.setPosition(T,{x:u.x+(A*c-E*l),y:u.y+(A*l+E*c)}),h.rotate(T,p)}return r},e.scale=function(r,p,u,t,c){for(var l=c?e.allBodies(r):r.bodies,m=0;m<l.length;m++){var w=l[m],T=w.position.x-t.x,A=w.position.y-t.y;h.setPosition(w,{x:t.x+T*p,y:t.y+A*u}),h.scale(w,p,u)}return r},e.bounds=function(r){for(var p=e.allBodies(r),u=[],t=0;t<p.length;t+=1){var c=p[t];u.push(c.bounds.min,c.bounds.max)}return n.create(u)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(4),i=s(5),n=s(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(h,r){for(var p=r/n._baseDelta,u=e._motionSleepThreshold,t=0;t<h.length;t++){var c=h[t],l=a.getSpeed(c),m=a.getAngularSpeed(c),w=l*l+m*m;if(c.force.x!==0||c.force.y!==0){e.set(c,!1);continue}var T=Math.min(c.motion,w),A=Math.max(c.motion,w);c.motion=e._minBias*T+(1-e._minBias)*A,c.sleepThreshold>0&&c.motion<u?(c.sleepCounter+=1,c.sleepCounter>=c.sleepThreshold/p&&e.set(c,!0)):c.sleepCounter>0&&(c.sleepCounter-=1)}},e.afterCollisions=function(h){for(var r=e._motionSleepThreshold,p=0;p<h.length;p++){var u=h[p];if(u.isActive){var t=u.collision,c=t.bodyA.parent,l=t.bodyB.parent;if(!(c.isSleeping&&l.isSleeping||c.isStatic||l.isStatic)&&(c.isSleeping||l.isSleeping)){var m=c.isSleeping&&!c.isStatic?c:l,w=m===c?l:c;!m.isStatic&&w.motion>r&&e.set(m,!1)}}}},e.set=function(h,r){var p=h.isSleeping;r?(h.isSleeping=!0,h.sleepCounter=h.sleepThreshold,h.positionImpulse.x=0,h.positionImpulse.y=0,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.anglePrev=h.angle,h.speed=0,h.angularSpeed=0,h.motion=0,p||i.trigger(h,"sleepStart")):(h.isSleeping=!1,h.sleepCounter=0,p&&i.trigger(h,"sleepEnd"))}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(9);(function(){var n=[],h={overlap:0,axis:null},r={overlap:0,axis:null};e.create=function(p,u){return{pair:null,collided:!1,bodyA:p,bodyB:u,parentA:p.parent,parentB:u.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(p,u,t){if(e._overlapAxes(h,p.vertices,u.vertices,p.axes),h.overlap<=0||(e._overlapAxes(r,u.vertices,p.vertices,u.axes),r.overlap<=0))return null;var c=t&&t.table[i.id(p,u)],l;c?l=c.collision:(l=e.create(p,u),l.collided=!0,l.bodyA=p.id<u.id?p:u,l.bodyB=p.id<u.id?u:p,l.parentA=l.bodyA.parent,l.parentB=l.bodyB.parent),p=l.bodyA,u=l.bodyB;var m;h.overlap<r.overlap?m=h:m=r;var w=l.normal,T=l.tangent,A=l.penetration,E=l.supports,g=m.overlap,x=m.axis,S=x.x,y=x.y,C=u.position.x-p.position.x,b=u.position.y-p.position.y;S*C+y*b>=0&&(S=-S,y=-y),w.x=S,w.y=y,T.x=-y,T.y=S,A.x=S*g,A.y=y*g,l.depth=g;var P=e._findSupports(p,u,w,1),M=0;if(a.contains(p.vertices,P[0])&&(E[M++]=P[0]),a.contains(p.vertices,P[1])&&(E[M++]=P[1]),M<2){var B=e._findSupports(u,p,w,-1);a.contains(u.vertices,B[0])&&(E[M++]=B[0]),M<2&&a.contains(u.vertices,B[1])&&(E[M++]=B[1])}return M===0&&(E[M++]=P[0]),l.supportCount=M,l},e._overlapAxes=function(p,u,t,c){var l=u.length,m=t.length,w=u[0].x,T=u[0].y,A=t[0].x,E=t[0].y,g=c.length,x=Number.MAX_VALUE,S=0,y,C,b,P,M,B;for(M=0;M<g;M++){var I=c[M],L=I.x,F=I.y,O=w*L+T*F,N=A*L+E*F,V=O,z=N;for(B=1;B<l;B+=1)P=u[B].x*L+u[B].y*F,P>V?V=P:P<O&&(O=P);for(B=1;B<m;B+=1)P=t[B].x*L+t[B].y*F,P>z?z=P:P<N&&(N=P);if(C=V-N,b=z-O,y=C<b?C:b,y<x&&(x=y,S=M,y<=0))break}p.axis=c[S],p.overlap=x},e._findSupports=function(p,u,t,c){var l=u.vertices,m=l.length,w=p.position.x,T=p.position.y,A=t.x*c,E=t.y*c,g=l[0],x=g,S=A*(w-x.x)+E*(T-x.y),y,C,b;for(b=1;b<m;b+=1)x=l[b],C=A*(w-x.x)+E*(T-x.y),C<S&&(S=C,g=x);return y=l[(m+g.index-1)%m],S=A*(w-y.x)+E*(T-y.y),x=l[(g.index+1)%m],A*(w-x.x)+E*(T-x.y)<S?(n[0]=g,n[1]=x,n):(n[0]=g,n[1]=y,n)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(16);(function(){e.create=function(i,n){var h=i.bodyA,r=i.bodyB,p={id:e.id(h,r),bodyA:h,bodyB:r,collision:i,contacts:[a.create(),a.create()],contactCount:0,separation:0,isActive:!0,isSensor:h.isSensor||r.isSensor,timeCreated:n,timeUpdated:n,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(p,i,n),p},e.update=function(i,n,h){var r=n.supports,p=n.supportCount,u=i.contacts,t=n.parentA,c=n.parentB;i.isActive=!0,i.timeUpdated=h,i.collision=n,i.separation=n.depth,i.inverseMass=t.inverseMass+c.inverseMass,i.friction=t.friction<c.friction?t.friction:c.friction,i.frictionStatic=t.frictionStatic>c.frictionStatic?t.frictionStatic:c.frictionStatic,i.restitution=t.restitution>c.restitution?t.restitution:c.restitution,i.slop=t.slop>c.slop?t.slop:c.slop,i.contactCount=p,n.pair=i;var l=r[0],m=u[0],w=r[1],T=u[1];(T.vertex===l||m.vertex===w)&&(u[1]=m,u[0]=m=T,T=u[1]),m.vertex=l,T.vertex=w},e.setActive=function(i,n,h){n?(i.isActive=!0,i.timeUpdated=h):(i.isActive=!1,i.contactCount=0)},e.id=function(i,n){return i.id<n.id?i.id.toString(36)+":"+n.id.toString(36):n.id.toString(36)+":"+i.id.toString(36)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(2),n=s(7),h=s(1),r=s(11),p=s(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(u){var t=u;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var c=t.bodyA?i.add(t.bodyA.position,t.pointA):t.pointA,l=t.bodyB?i.add(t.bodyB.position,t.pointB):t.pointB,m=i.magnitude(i.sub(c,l));t.length=typeof t.length<"u"?t.length:m,t.id=t.id||p.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var w={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(w.type="pin",w.anchors=!1):t.stiffness<.9&&(w.type="spring"),t.render=p.extend(w,t.render),t},e.preSolveAll=function(u){for(var t=0;t<u.length;t+=1){var c=u[t],l=c.constraintImpulse;c.isStatic||l.x===0&&l.y===0&&l.angle===0||(c.position.x+=l.x,c.position.y+=l.y,c.angle+=l.angle)}},e.solveAll=function(u,t){for(var c=p.clamp(t/p._baseDelta,0,1),l=0;l<u.length;l+=1){var m=u[l],w=!m.bodyA||m.bodyA&&m.bodyA.isStatic,T=!m.bodyB||m.bodyB&&m.bodyB.isStatic;(w||T)&&e.solve(u[l],c)}for(l=0;l<u.length;l+=1)m=u[l],w=!m.bodyA||m.bodyA&&m.bodyA.isStatic,T=!m.bodyB||m.bodyB&&m.bodyB.isStatic,!w&&!T&&e.solve(u[l],c)},e.solve=function(u,t){var c=u.bodyA,l=u.bodyB,m=u.pointA,w=u.pointB;if(!(!c&&!l)){c&&!c.isStatic&&(i.rotate(m,c.angle-u.angleA,m),u.angleA=c.angle),l&&!l.isStatic&&(i.rotate(w,l.angle-u.angleB,w),u.angleB=l.angle);var T=m,A=w;if(c&&(T=i.add(c.position,m)),l&&(A=i.add(l.position,w)),!(!T||!A)){var E=i.sub(T,A),g=i.magnitude(E);g<e._minLength&&(g=e._minLength);var x=(g-u.length)/g,S=u.stiffness>=1||u.length===0,y=S?u.stiffness*t:u.stiffness*t*t,C=u.damping*t,b=i.mult(E,x*y),P=(c?c.inverseMass:0)+(l?l.inverseMass:0),M=(c?c.inverseInertia:0)+(l?l.inverseInertia:0),B=P+M,I,L,F,O,N;if(C>0){var V=i.create();F=i.div(E,g),N=i.sub(l&&i.sub(l.position,l.positionPrev)||V,c&&i.sub(c.position,c.positionPrev)||V),O=i.dot(F,N)}c&&!c.isStatic&&(L=c.inverseMass/P,c.constraintImpulse.x-=b.x*L,c.constraintImpulse.y-=b.y*L,c.position.x-=b.x*L,c.position.y-=b.y*L,C>0&&(c.positionPrev.x-=C*F.x*O*L,c.positionPrev.y-=C*F.y*O*L),I=i.cross(m,b)/B*e._torqueDampen*c.inverseInertia*(1-u.angularStiffness),c.constraintImpulse.angle-=I,c.angle-=I),l&&!l.isStatic&&(L=l.inverseMass/P,l.constraintImpulse.x+=b.x*L,l.constraintImpulse.y+=b.y*L,l.position.x+=b.x*L,l.position.y+=b.y*L,C>0&&(l.positionPrev.x+=C*F.x*O*L,l.positionPrev.y+=C*F.y*O*L),I=i.cross(w,b)/B*e._torqueDampen*l.inverseInertia*(1-u.angularStiffness),l.constraintImpulse.angle+=I,l.angle+=I)}}},e.postSolveAll=function(u){for(var t=0;t<u.length;t++){var c=u[t],l=c.constraintImpulse;if(!(c.isStatic||l.x===0&&l.y===0&&l.angle===0)){n.set(c,!1);for(var m=0;m<c.parts.length;m++){var w=c.parts[m];a.translate(w.vertices,l),m>0&&(w.position.x+=l.x,w.position.y+=l.y),l.angle!==0&&(a.rotate(w.vertices,l.angle,c.position),r.rotate(w.axes,l.angle),m>0&&i.rotateAbout(w.position,l.angle,c.position,w.position)),h.update(w.bounds,w.vertices,c.velocity)}l.angle*=e._warming,l.x*=e._warming,l.y*=e._warming}}},e.pointAWorld=function(u){return{x:(u.bodyA?u.bodyA.position.x:0)+(u.pointA?u.pointA.x:0),y:(u.bodyA?u.bodyA.position.y:0)+(u.pointA?u.pointA.y:0)}},e.pointBWorld=function(u){return{x:(u.bodyB?u.bodyB.position.x:0)+(u.pointB?u.pointB.x:0),y:(u.bodyB?u.bodyB.position.y:0)+(u.pointB?u.pointB.y:0)}},e.currentLength=function(u){var t=(u.bodyA?u.bodyA.position.x:0)+(u.pointA?u.pointA.x:0),c=(u.bodyA?u.bodyA.position.y:0)+(u.pointA?u.pointA.y:0),l=(u.bodyB?u.bodyB.position.x:0)+(u.pointB?u.pointB.x:0),m=(u.bodyB?u.bodyB.position.y:0)+(u.pointB?u.pointB.y:0),w=t-l,T=c-m;return Math.sqrt(w*w+T*T)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(2),i=s(0);(function(){e.fromVertices=function(n){for(var h={},r=0;r<n.length;r++){var p=(r+1)%n.length,u=a.normalise({x:n[p].y-n[r].y,y:n[r].x-n[p].x}),t=u.y===0?1/0:u.x/u.y;t=t.toFixed(3).toString(),h[t]=u}return i.values(h)},e.rotate=function(n,h){if(h!==0)for(var r=Math.cos(h),p=Math.sin(h),u=0;u<n.length;u++){var t=n[u],c;c=t.x*r-t.y*p,t.y=t.x*p+t.y*r,t.x=c}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(0),n=s(4),h=s(1),r=s(2);(function(){e.rectangle=function(p,u,t,c,l){l=l||{};var m={label:"Rectangle Body",position:{x:p,y:u},vertices:a.fromPath("L 0 0 L "+t+" 0 L "+t+" "+c+" L 0 "+c)};if(l.chamfer){var w=l.chamfer;m.vertices=a.chamfer(m.vertices,w.radius,w.quality,w.qualityMin,w.qualityMax),delete l.chamfer}return n.create(i.extend({},m,l))},e.trapezoid=function(p,u,t,c,l,m){m=m||{},l>=1&&i.warn("Bodies.trapezoid: slope parameter must be < 1."),l*=.5;var w=(1-l*2)*t,T=t*l,A=T+w,E=A+T,g;l<.5?g="L 0 0 L "+T+" "+-c+" L "+A+" "+-c+" L "+E+" 0":g="L 0 0 L "+A+" "+-c+" L "+E+" 0";var x={label:"Trapezoid Body",position:{x:p,y:u},vertices:a.fromPath(g)};if(m.chamfer){var S=m.chamfer;x.vertices=a.chamfer(x.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete m.chamfer}return n.create(i.extend({},x,m))},e.circle=function(p,u,t,c,l){c=c||{};var m={label:"Circle Body",circleRadius:t};l=l||25;var w=Math.ceil(Math.max(10,Math.min(l,t)));return w%2===1&&(w+=1),e.polygon(p,u,w,t,i.extend({},m,c))},e.polygon=function(p,u,t,c,l){if(l=l||{},t<3)return e.circle(p,u,c,l);for(var m=2*Math.PI/t,w="",T=m*.5,A=0;A<t;A+=1){var E=T+A*m,g=Math.cos(E)*c,x=Math.sin(E)*c;w+="L "+g.toFixed(3)+" "+x.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:p,y:u},vertices:a.fromPath(w)};if(l.chamfer){var y=l.chamfer;S.vertices=a.chamfer(S.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return n.create(i.extend({},S,l))},e.fromVertices=function(p,u,t,c,l,m,w,T){var A=i.getDecomp(),E,g,x,S,y,C,b,P,M,B,I;for(E=!!(A&&A.quickDecomp),c=c||{},x=[],l=typeof l<"u"?l:!1,m=typeof m<"u"?m:.01,w=typeof w<"u"?w:10,T=typeof T<"u"?T:.01,i.isArray(t[0])||(t=[t]),B=0;B<t.length;B+=1)if(C=t[B],S=a.isConvex(C),y=!S,y&&!E&&i.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!E)S?C=a.clockwiseSort(C):C=a.hull(C),x.push({position:{x:p,y:u},vertices:C});else{var L=C.map(function(K){return[K.x,K.y]});A.makeCCW(L),m!==!1&&A.removeCollinearPoints(L,m),T!==!1&&A.removeDuplicatePoints&&A.removeDuplicatePoints(L,T);var F=A.quickDecomp(L);for(b=0;b<F.length;b++){var O=F[b],N=O.map(function(K){return{x:K[0],y:K[1]}});w>0&&a.area(N)<w||x.push({position:a.centre(N),vertices:N})}}for(b=0;b<x.length;b++)x[b]=n.create(i.extend(x[b],c));if(l){var V=5;for(b=0;b<x.length;b++){var z=x[b];for(P=b+1;P<x.length;P++){var Z=x[P];if(h.overlaps(z.bounds,Z.bounds)){var J=z.vertices,ee=Z.vertices;for(M=0;M<z.vertices.length;M++)for(I=0;I<Z.vertices.length;I++){var ue=r.magnitudeSquared(r.sub(J[(M+1)%J.length],ee[I])),fe=r.magnitudeSquared(r.sub(J[M],ee[(I+1)%ee.length]));ue<V&&fe<V&&(J[M].isInternal=!0,ee[I].isInternal=!0)}}}}}return x.length>1?(g=n.create(i.extend({parts:x.slice(0)},c)),n.setPosition(g,{x:p,y:u}),g):x[0]}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(0),i=s(8);(function(){e.create=function(n){var h={bodies:[],collisions:[],pairs:null};return a.extend(h,n)},e.setBodies=function(n,h){n.bodies=h.slice(0)},e.clear=function(n){n.bodies=[],n.collisions=[]},e.collisions=function(n){var h=n.pairs,r=n.bodies,p=r.length,u=e.canCollide,t=i.collides,c=n.collisions,l=0,m,w;for(r.sort(e._compareBoundsX),m=0;m<p;m++){var T=r[m],A=T.bounds,E=T.bounds.max.x,g=T.bounds.max.y,x=T.bounds.min.y,S=T.isStatic||T.isSleeping,y=T.parts.length,C=y===1;for(w=m+1;w<p;w++){var b=r[w],P=b.bounds;if(P.min.x>E)break;if(!(g<P.min.y||x>P.max.y)&&!(S&&(b.isStatic||b.isSleeping))&&u(T.collisionFilter,b.collisionFilter)){var M=b.parts.length;if(C&&M===1){var B=t(T,b,h);B&&(c[l++]=B)}else for(var I=y>1?1:0,L=M>1?1:0,F=I;F<y;F++)for(var O=T.parts[F],A=O.bounds,N=L;N<M;N++){var V=b.parts[N],P=V.bounds;if(!(A.min.x>P.max.x||A.max.x<P.min.x||A.max.y<P.min.y||A.min.y>P.max.y)){var B=t(O,V,h);B&&(c[l++]=B)}}}}}return c.length!==l&&(c.length=l),c},e.canCollide=function(n,h){return n.group===h.group&&n.group!==0?n.group>0:(n.mask&h.category)!==0&&(h.mask&n.category)!==0},e._compareBoundsX=function(n,h){return n.bounds.min.x-h.bounds.min.x}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(0);(function(){e.create=function(i){var n={};return i||a.log("Mouse.create: element was undefined, defaulting to document.body","warn"),n.element=i||document.body,n.absolute={x:0,y:0},n.position={x:0,y:0},n.mousedownPosition={x:0,y:0},n.mouseupPosition={x:0,y:0},n.offset={x:0,y:0},n.scale={x:1,y:1},n.wheelDelta=0,n.button=-1,n.pixelRatio=parseInt(n.element.getAttribute("data-pixel-ratio"),10)||1,n.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},n.mousemove=function(h){var r=e._getRelativeMousePosition(h,n.element,n.pixelRatio),p=h.changedTouches;p&&(n.button=0,h.preventDefault()),n.absolute.x=r.x,n.absolute.y=r.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.sourceEvents.mousemove=h},n.mousedown=function(h){var r=e._getRelativeMousePosition(h,n.element,n.pixelRatio),p=h.changedTouches;p?(n.button=0,h.preventDefault()):n.button=h.button,n.absolute.x=r.x,n.absolute.y=r.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mousedownPosition.x=n.position.x,n.mousedownPosition.y=n.position.y,n.sourceEvents.mousedown=h},n.mouseup=function(h){var r=e._getRelativeMousePosition(h,n.element,n.pixelRatio),p=h.changedTouches;p&&h.preventDefault(),n.button=-1,n.absolute.x=r.x,n.absolute.y=r.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mouseupPosition.x=n.position.x,n.mouseupPosition.y=n.position.y,n.sourceEvents.mouseup=h},n.mousewheel=function(h){n.wheelDelta=Math.max(-1,Math.min(1,h.wheelDelta||-h.detail)),h.preventDefault(),n.sourceEvents.mousewheel=h},e.setElement(n,n.element),n},e.setElement=function(i,n){i.element=n,n.addEventListener("mousemove",i.mousemove,{passive:!0}),n.addEventListener("mousedown",i.mousedown,{passive:!0}),n.addEventListener("mouseup",i.mouseup,{passive:!0}),n.addEventListener("wheel",i.mousewheel,{passive:!1}),n.addEventListener("touchmove",i.mousemove,{passive:!1}),n.addEventListener("touchstart",i.mousedown,{passive:!1}),n.addEventListener("touchend",i.mouseup,{passive:!1})},e.clearSourceEvents=function(i){i.sourceEvents.mousemove=null,i.sourceEvents.mousedown=null,i.sourceEvents.mouseup=null,i.sourceEvents.mousewheel=null,i.wheelDelta=0},e.setOffset=function(i,n){i.offset.x=n.x,i.offset.y=n.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y},e.setScale=function(i,n){i.scale.x=n.x,i.scale.y=n.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y},e._getRelativeMousePosition=function(i,n,h){var r=n.getBoundingClientRect(),p=document.documentElement||document.body.parentNode||document.body,u=window.pageXOffset!==void 0?window.pageXOffset:p.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:p.scrollTop,c=i.changedTouches,l,m;return c?(l=c[0].pageX-r.left-u,m=c[0].pageY-r.top-t):(l=i.pageX-r.left-u,m=i.pageY-r.top-t),{x:l/(n.clientWidth/(n.width||n.clientWidth)*h),y:m/(n.clientHeight/(n.height||n.clientHeight)*h)}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(0);(function(){e._registry={},e.register=function(i){if(e.isPlugin(i)||a.warn("Plugin.register:",e.toString(i),"does not implement all required fields."),i.name in e._registry){var n=e._registry[i.name],h=e.versionParse(i.version).number,r=e.versionParse(n.version).number;h>r?(a.warn("Plugin.register:",e.toString(n),"was upgraded to",e.toString(i)),e._registry[i.name]=i):h<r?a.warn("Plugin.register:",e.toString(n),"can not be downgraded to",e.toString(i)):i!==n&&a.warn("Plugin.register:",e.toString(i),"is already registered to different plugin object")}else e._registry[i.name]=i;return i},e.resolve=function(i){return e._registry[e.dependencyParse(i).name]},e.toString=function(i){return typeof i=="string"?i:(i.name||"anonymous")+"@"+(i.version||i.range||"0.0.0")},e.isPlugin=function(i){return i&&i.name&&i.version&&i.install},e.isUsed=function(i,n){return i.used.indexOf(n)>-1},e.isFor=function(i,n){var h=i.for&&e.dependencyParse(i.for);return!i.for||n.name===h.name&&e.versionSatisfies(n.version,h.range)},e.use=function(i,n){if(i.uses=(i.uses||[]).concat(n||[]),i.uses.length===0){a.warn("Plugin.use:",e.toString(i),"does not specify any dependencies to install.");return}for(var h=e.dependencies(i),r=a.topologicalSort(h),p=[],u=0;u<r.length;u+=1)if(r[u]!==i.name){var t=e.resolve(r[u]);if(!t){p.push("âŒ "+r[u]);continue}e.isUsed(i,t.name)||(e.isFor(t,i)||(a.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(i)+"."),t._warned=!0),t.install?t.install(i):(a.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(p.push("ðŸ”¶ "+e.toString(t)),delete t._warned):p.push("âœ… "+e.toString(t)),i.used.push(t.name))}p.length>0&&a.info(p.join("  "))},e.dependencies=function(i,n){var h=e.dependencyParse(i),r=h.name;if(n=n||{},!(r in n)){i=e.resolve(i)||i,n[r]=a.map(i.uses||[],function(u){e.isPlugin(u)&&e.register(u);var t=e.dependencyParse(u),c=e.resolve(u);return c&&!e.versionSatisfies(c.version,t.range)?(a.warn("Plugin.dependencies:",e.toString(c),"does not satisfy",e.toString(t),"used by",e.toString(h)+"."),c._warned=!0,i._warned=!0):c||(a.warn("Plugin.dependencies:",e.toString(u),"used by",e.toString(h),"could not be resolved."),i._warned=!0),t.name});for(var p=0;p<n[r].length;p+=1)e.dependencies(n[r][p],n);return n}},e.dependencyParse=function(i){if(a.isString(i)){var n=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return n.test(i)||a.warn("Plugin.dependencyParse:",i,"is not a valid dependency string."),{name:i.split("@")[0],range:i.split("@")[1]||"*"}}return{name:i.name,range:i.range||i.version}},e.versionParse=function(i){var n=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;n.test(i)||a.warn("Plugin.versionParse:",i,"is not a valid version or range.");var h=n.exec(i),r=Number(h[4]),p=Number(h[5]),u=Number(h[6]);return{isRange:!!(h[1]||h[2]),version:h[3],range:i,operator:h[1]||h[2]||"",major:r,minor:p,patch:u,parts:[r,p,u],prerelease:h[7],number:r*1e8+p*1e4+u}},e.versionSatisfies=function(i,n){n=n||"*";var h=e.versionParse(n),r=e.versionParse(i);if(h.isRange){if(h.operator==="*"||i==="*")return!0;if(h.operator===">")return r.number>h.number;if(h.operator===">=")return r.number>=h.number;if(h.operator==="~")return r.major===h.major&&r.minor===h.minor&&r.patch>=h.patch;if(h.operator==="^")return h.major>0?r.major===h.major&&r.number>=h.number:h.minor>0?r.minor===h.minor&&r.patch>=h.patch:r.patch===h.patch}return i===n||i==="*"}})()}),(function(d,v){var s={};d.exports=s,(function(){s.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(7),i=s(18),n=s(13),h=s(19),r=s(5),p=s(6),u=s(10),t=s(0),c=s(4);(function(){e._deltaMax=1e3/60,e.create=function(l){l=l||{};var m={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},w=t.extend(m,l);return w.world=l.world||p.create({label:"World"}),w.pairs=l.pairs||h.create(),w.detector=l.detector||n.create(),w.detector.pairs=w.pairs,w.grid={buckets:[]},w.world.gravity=w.gravity,w.broadphase=w.grid,w.metrics={},w},e.update=function(l,m){var w=t.now(),T=l.world,A=l.detector,E=l.pairs,g=l.timing,x=g.timestamp,S;m>e._deltaMax&&t.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),m=typeof m<"u"?m:t._baseDelta,m*=g.timeScale,g.timestamp+=m,g.lastDelta=m;var y={timestamp:g.timestamp,delta:m};r.trigger(l,"beforeUpdate",y);var C=p.allBodies(T),b=p.allConstraints(T);for(T.isModified&&(n.setBodies(A,C),p.setModified(T,!1,!1,!0)),l.enableSleeping&&a.update(C,m),e._bodiesApplyGravity(C,l.gravity),m>0&&e._bodiesUpdate(C,m),r.trigger(l,"beforeSolve",y),u.preSolveAll(C),S=0;S<l.constraintIterations;S++)u.solveAll(b,m);u.postSolveAll(C);var P=n.collisions(A);h.update(E,P,x),l.enableSleeping&&a.afterCollisions(E.list),E.collisionStart.length>0&&r.trigger(l,"collisionStart",{pairs:E.collisionStart,timestamp:g.timestamp,delta:m});var M=t.clamp(20/l.positionIterations,0,1);for(i.preSolvePosition(E.list),S=0;S<l.positionIterations;S++)i.solvePosition(E.list,m,M);for(i.postSolvePosition(C),u.preSolveAll(C),S=0;S<l.constraintIterations;S++)u.solveAll(b,m);for(u.postSolveAll(C),i.preSolveVelocity(E.list),S=0;S<l.velocityIterations;S++)i.solveVelocity(E.list,m);return e._bodiesUpdateVelocities(C),E.collisionActive.length>0&&r.trigger(l,"collisionActive",{pairs:E.collisionActive,timestamp:g.timestamp,delta:m}),E.collisionEnd.length>0&&r.trigger(l,"collisionEnd",{pairs:E.collisionEnd,timestamp:g.timestamp,delta:m}),e._bodiesClearForces(C),r.trigger(l,"afterUpdate",y),l.timing.lastElapsed=t.now()-w,l},e.merge=function(l,m){if(t.extend(l,m),m.world){l.world=m.world,e.clear(l);for(var w=p.allBodies(l.world),T=0;T<w.length;T++){var A=w[T];a.set(A,!1),A.id=t.nextId()}}},e.clear=function(l){h.clear(l.pairs),n.clear(l.detector)},e._bodiesClearForces=function(l){for(var m=l.length,w=0;w<m;w++){var T=l[w];T.force.x=0,T.force.y=0,T.torque=0}},e._bodiesApplyGravity=function(l,m){var w=typeof m.scale<"u"?m.scale:.001,T=l.length;if(!(m.x===0&&m.y===0||w===0))for(var A=0;A<T;A++){var E=l[A];E.isStatic||E.isSleeping||(E.force.y+=E.mass*m.y*w,E.force.x+=E.mass*m.x*w)}},e._bodiesUpdate=function(l,m){for(var w=l.length,T=0;T<w;T++){var A=l[T];A.isStatic||A.isSleeping||c.update(A,m)}},e._bodiesUpdateVelocities=function(l){for(var m=l.length,w=0;w<m;w++)c.updateVelocities(l[w])}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(0),n=s(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(h){var r,p,u,t=h.length;for(r=0;r<t;r++)p=h[r],p.isActive&&(u=p.contactCount,p.collision.parentA.totalContacts+=u,p.collision.parentB.totalContacts+=u)},e.solvePosition=function(h,r,p){var u,t,c,l,m,w,T,A,E=e._positionDampen*(p||1),g=i.clamp(r/i._baseDelta,0,1),x=h.length;for(u=0;u<x;u++)t=h[u],!(!t.isActive||t.isSensor)&&(c=t.collision,l=c.parentA,m=c.parentB,w=c.normal,t.separation=c.depth+w.x*(m.positionImpulse.x-l.positionImpulse.x)+w.y*(m.positionImpulse.y-l.positionImpulse.y));for(u=0;u<x;u++)t=h[u],!(!t.isActive||t.isSensor)&&(c=t.collision,l=c.parentA,m=c.parentB,w=c.normal,A=t.separation-t.slop*g,(l.isStatic||m.isStatic)&&(A*=2),l.isStatic||l.isSleeping||(T=E/l.totalContacts,l.positionImpulse.x+=w.x*A*T,l.positionImpulse.y+=w.y*A*T),m.isStatic||m.isSleeping||(T=E/m.totalContacts,m.positionImpulse.x-=w.x*A*T,m.positionImpulse.y-=w.y*A*T))},e.postSolvePosition=function(h){for(var r=e._positionWarming,p=h.length,u=a.translate,t=n.update,c=0;c<p;c++){var l=h[c],m=l.positionImpulse,w=m.x,T=m.y,A=l.velocity;if(l.totalContacts=0,w!==0||T!==0){for(var E=0;E<l.parts.length;E++){var g=l.parts[E];u(g.vertices,m),t(g.bounds,g.vertices,A),g.position.x+=w,g.position.y+=T}l.positionPrev.x+=w,l.positionPrev.y+=T,w*A.x+T*A.y<0?(m.x=0,m.y=0):(m.x*=r,m.y*=r)}}},e.preSolveVelocity=function(h){var r=h.length,p,u;for(p=0;p<r;p++){var t=h[p];if(!(!t.isActive||t.isSensor)){var c=t.contacts,l=t.contactCount,m=t.collision,w=m.parentA,T=m.parentB,A=m.normal,E=m.tangent;for(u=0;u<l;u++){var g=c[u],x=g.vertex,S=g.normalImpulse,y=g.tangentImpulse;if(S!==0||y!==0){var C=A.x*S+E.x*y,b=A.y*S+E.y*y;w.isStatic||w.isSleeping||(w.positionPrev.x+=C*w.inverseMass,w.positionPrev.y+=b*w.inverseMass,w.anglePrev+=w.inverseInertia*((x.x-w.position.x)*b-(x.y-w.position.y)*C)),T.isStatic||T.isSleeping||(T.positionPrev.x-=C*T.inverseMass,T.positionPrev.y-=b*T.inverseMass,T.anglePrev-=T.inverseInertia*((x.x-T.position.x)*b-(x.y-T.position.y)*C))}}}}},e.solveVelocity=function(h,r){var p=r/i._baseDelta,u=p*p,t=u*p,c=-e._restingThresh*p,l=e._restingThreshTangent,m=e._frictionNormalMultiplier*p,w=e._frictionMaxStatic,T=h.length,A,E,g,x;for(g=0;g<T;g++){var S=h[g];if(!(!S.isActive||S.isSensor)){var y=S.collision,C=y.parentA,b=y.parentB,P=y.normal.x,M=y.normal.y,B=y.tangent.x,I=y.tangent.y,L=S.inverseMass,F=S.friction*S.frictionStatic*m,O=S.contacts,N=S.contactCount,V=1/N,z=C.position.x-C.positionPrev.x,Z=C.position.y-C.positionPrev.y,J=C.angle-C.anglePrev,ee=b.position.x-b.positionPrev.x,ue=b.position.y-b.positionPrev.y,fe=b.angle-b.anglePrev;for(x=0;x<N;x++){var K=O[x],ge=K.vertex,oe=ge.x-C.position.x,Ie=ge.y-C.position.y,Oe=ge.x-b.position.x,Be=ge.y-b.position.y,ve=z-Ie*J,Et=Z+oe*J,lt=ee-Be*fe,gn=ue+Oe*fe,ze=ve-lt,kt=Et-gn,dt=P*ze+M*kt,$e=B*ze+I*kt,Ut=S.separation+dt,je=Math.min(Ut,1);je=Ut<0?0:je;var zt=je*F;$e<-zt||$e>zt?(E=$e>0?$e:-$e,A=S.friction*($e>0?1:-1)*t,A<-E?A=-E:A>E&&(A=E)):(A=$e,E=w);var ct=oe*M-Ie*P,$t=Oe*M-Be*P,qe=V/(L+C.inverseInertia*ct*ct+b.inverseInertia*$t*$t),ht=(1+S.restitution)*dt*qe;if(A*=qe,dt<c)K.normalImpulse=0;else{var Bt=K.normalImpulse;K.normalImpulse+=ht,K.normalImpulse>0&&(K.normalImpulse=0),ht=K.normalImpulse-Bt}if($e<-l||$e>l)K.tangentImpulse=0;else{var vn=K.tangentImpulse;K.tangentImpulse+=A,K.tangentImpulse<-E&&(K.tangentImpulse=-E),K.tangentImpulse>E&&(K.tangentImpulse=E),A=K.tangentImpulse-vn}var mt=P*ht+B*A,gt=M*ht+I*A;C.isStatic||C.isSleeping||(C.positionPrev.x+=mt*C.inverseMass,C.positionPrev.y+=gt*C.inverseMass,C.anglePrev+=(oe*gt-Ie*mt)*C.inverseInertia),b.isStatic||b.isSleeping||(b.positionPrev.x-=mt*b.inverseMass,b.positionPrev.y-=gt*b.inverseMass,b.anglePrev-=(Oe*gt-Be*mt)*b.inverseInertia)}}}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(9),i=s(0);(function(){e.create=function(n){return i.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},n)},e.update=function(n,h,r){var p=a.update,u=a.create,t=a.setActive,c=n.table,l=n.list,m=l.length,w=m,T=n.collisionStart,A=n.collisionEnd,E=n.collisionActive,g=h.length,x=0,S=0,y=0,C,b,P;for(P=0;P<g;P++)C=h[P],b=C.pair,b?(b.isActive&&(E[y++]=b),p(b,C,r)):(b=u(C,r),c[b.id]=b,T[x++]=b,l[w++]=b);for(w=0,m=l.length,P=0;P<m;P++)b=l[P],b.timeUpdated>=r?l[w++]=b:(t(b,!1,r),b.collision.bodyA.sleepCounter>0&&b.collision.bodyB.sleepCounter>0?l[w++]=b:(A[S++]=b,delete c[b.id]));l.length!==w&&(l.length=w),T.length!==x&&(T.length=x),A.length!==S&&(A.length=S),E.length!==y&&(E.length=y)},e.clear=function(n){return n.table={},n.list.length=0,n.collisionStart.length=0,n.collisionActive.length=0,n.collisionEnd.length=0,n}})()}),(function(d,v,s){var e=d.exports=s(21);e.Axes=s(11),e.Bodies=s(12),e.Body=s(4),e.Bounds=s(1),e.Collision=s(8),e.Common=s(0),e.Composite=s(6),e.Composites=s(22),e.Constraint=s(10),e.Contact=s(16),e.Detector=s(13),e.Engine=s(17),e.Events=s(5),e.Grid=s(23),e.Mouse=s(14),e.MouseConstraint=s(24),e.Pair=s(9),e.Pairs=s(19),e.Plugin=s(15),e.Query=s(25),e.Render=s(26),e.Resolver=s(18),e.Runner=s(27),e.SAT=s(28),e.Sleeping=s(7),e.Svg=s(29),e.Vector=s(2),e.Vertices=s(3),e.World=s(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(d,v,s){var e={};d.exports=e;var a=s(15),i=s(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){a.use(e,Array.prototype.slice.call(arguments))},e.before=function(n,h){return n=n.replace(/^Matter./,""),i.chainPathBefore(e,n,h)},e.after=function(n,h){return n=n.replace(/^Matter./,""),i.chainPathAfter(e,n,h)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(6),i=s(10),n=s(0),h=s(4),r=s(12),p=n.deprecated;(function(){e.stack=function(u,t,c,l,m,w,T){for(var A=a.create({label:"Stack"}),E=u,g=t,x,S=0,y=0;y<l;y++){for(var C=0,b=0;b<c;b++){var P=T(E,g,b,y,x,S);if(P){var M=P.bounds.max.y-P.bounds.min.y,B=P.bounds.max.x-P.bounds.min.x;M>C&&(C=M),h.translate(P,{x:B*.5,y:M*.5}),E=P.bounds.max.x+m,a.addBody(A,P),x=P,S+=1}else E+=m}g+=C+w,E=u}return A},e.chain=function(u,t,c,l,m,w){for(var T=u.bodies,A=1;A<T.length;A++){var E=T[A-1],g=T[A],x=E.bounds.max.y-E.bounds.min.y,S=E.bounds.max.x-E.bounds.min.x,y=g.bounds.max.y-g.bounds.min.y,C=g.bounds.max.x-g.bounds.min.x,b={bodyA:E,pointA:{x:S*t,y:x*c},bodyB:g,pointB:{x:C*l,y:y*m}},P=n.extend(b,w);a.addConstraint(u,i.create(P))}return u.label+=" Chain",u},e.mesh=function(u,t,c,l,m){var w=u.bodies,T,A,E,g,x;for(T=0;T<c;T++){for(A=1;A<t;A++)E=w[A-1+T*t],g=w[A+T*t],a.addConstraint(u,i.create(n.extend({bodyA:E,bodyB:g},m)));if(T>0)for(A=0;A<t;A++)E=w[A+(T-1)*t],g=w[A+T*t],a.addConstraint(u,i.create(n.extend({bodyA:E,bodyB:g},m))),l&&A>0&&(x=w[A-1+(T-1)*t],a.addConstraint(u,i.create(n.extend({bodyA:x,bodyB:g},m)))),l&&A<t-1&&(x=w[A+1+(T-1)*t],a.addConstraint(u,i.create(n.extend({bodyA:x,bodyB:g},m))))}return u.label+=" Mesh",u},e.pyramid=function(u,t,c,l,m,w,T){return e.stack(u,t,c,l,m,w,function(A,E,g,x,S,y){var C=Math.min(l,Math.ceil(c/2)),b=S?S.bounds.max.x-S.bounds.min.x:0;if(!(x>C)){x=C-x;var P=x,M=c-1-x;if(!(g<P||g>M)){y===1&&h.translate(S,{x:(g+(c%2===1?1:-1))*b,y:0});var B=S?g*b:0;return T(u+B+g*m,E,g,x,S,y)}}})},e.newtonsCradle=function(u,t,c,l,m){for(var w=a.create({label:"Newtons Cradle"}),T=0;T<c;T++){var A=1.9,E=r.circle(u+T*(l*A),t+m,l,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),g=i.create({pointA:{x:u+T*(l*A),y:t},bodyB:E});a.addBody(w,E),a.addConstraint(w,g)}return w},p(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(u,t,c,l,m){var w=h.nextGroup(!0),T=20,A=-c*.5+T,E=c*.5-T,g=0,x=a.create({label:"Car"}),S=r.rectangle(u,t,c,l,{collisionFilter:{group:w},chamfer:{radius:l*.5},density:2e-4}),y=r.circle(u+A,t+g,m,{collisionFilter:{group:w},friction:.8}),C=r.circle(u+E,t+g,m,{collisionFilter:{group:w},friction:.8}),b=i.create({bodyB:S,pointB:{x:A,y:g},bodyA:y,stiffness:1,length:0}),P=i.create({bodyB:S,pointB:{x:E,y:g},bodyA:C,stiffness:1,length:0});return a.addBody(x,S),a.addBody(x,y),a.addBody(x,C),a.addConstraint(x,b),a.addConstraint(x,P),x},p(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(u,t,c,l,m,w,T,A,E,g){E=n.extend({inertia:1/0},E),g=n.extend({stiffness:.2,render:{type:"line",anchors:!1}},g);var x=e.stack(u,t,c,l,m,w,function(S,y){return r.circle(S,y,A,E)});return e.mesh(x,c,l,T,g),x.label="Soft Body",x},p(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(d,v,s){var e={};d.exports=e;var a=s(9),i=s(0),n=i.deprecated;(function(){e.create=function(h){var r={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return i.extend(r,h)},e.update=function(h,r,p,u){var t,c,l,m=p.world,w=h.buckets,T,A,E=!1;for(t=0;t<r.length;t++){var g=r[t];if(!(g.isSleeping&&!u)&&!(m.bounds&&(g.bounds.max.x<m.bounds.min.x||g.bounds.min.x>m.bounds.max.x||g.bounds.max.y<m.bounds.min.y||g.bounds.min.y>m.bounds.max.y))){var x=e._getRegion(h,g);if(!g.region||x.id!==g.region.id||u){(!g.region||u)&&(g.region=x);var S=e._regionUnion(x,g.region);for(c=S.startCol;c<=S.endCol;c++)for(l=S.startRow;l<=S.endRow;l++){A=e._getBucketId(c,l),T=w[A];var y=c>=x.startCol&&c<=x.endCol&&l>=x.startRow&&l<=x.endRow,C=c>=g.region.startCol&&c<=g.region.endCol&&l>=g.region.startRow&&l<=g.region.endRow;!y&&C&&C&&T&&e._bucketRemoveBody(h,T,g),(g.region===x||y&&!C||u)&&(T||(T=e._createBucket(w,A)),e._bucketAddBody(h,T,g))}g.region=x,E=!0}}}E&&(h.pairsList=e._createActivePairsList(h))},n(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(h){h.buckets={},h.pairs={},h.pairsList=[]},n(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(h,r){var p=Math.min(h.startCol,r.startCol),u=Math.max(h.endCol,r.endCol),t=Math.min(h.startRow,r.startRow),c=Math.max(h.endRow,r.endRow);return e._createRegion(p,u,t,c)},e._getRegion=function(h,r){var p=r.bounds,u=Math.floor(p.min.x/h.bucketWidth),t=Math.floor(p.max.x/h.bucketWidth),c=Math.floor(p.min.y/h.bucketHeight),l=Math.floor(p.max.y/h.bucketHeight);return e._createRegion(u,t,c,l)},e._createRegion=function(h,r,p,u){return{id:h+","+r+","+p+","+u,startCol:h,endCol:r,startRow:p,endRow:u}},e._getBucketId=function(h,r){return"C"+h+"R"+r},e._createBucket=function(h,r){var p=h[r]=[];return p},e._bucketAddBody=function(h,r,p){var u=h.pairs,t=a.id,c=r.length,l;for(l=0;l<c;l++){var m=r[l];if(!(p.id===m.id||p.isStatic&&m.isStatic)){var w=t(p,m),T=u[w];T?T[2]+=1:u[w]=[p,m,1]}}r.push(p)},e._bucketRemoveBody=function(h,r,p){var u=h.pairs,t=a.id,c;r.splice(i.indexOf(r,p),1);var l=r.length;for(c=0;c<l;c++){var m=u[t(p,r[c])];m&&(m[2]-=1)}},e._createActivePairsList=function(h){var r,p=h.pairs,u=i.keys(p),t=u.length,c=[],l;for(l=0;l<t;l++)r=p[u[l]],r[2]>0?c.push(r):delete p[u[l]];return c}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(3),i=s(7),n=s(14),h=s(5),r=s(13),p=s(10),u=s(6),t=s(0),c=s(1);(function(){e.create=function(l,m){var w=(l?l.mouse:null)||(m?m.mouse:null);w||(l&&l.render&&l.render.canvas?w=n.create(l.render.canvas):m&&m.element?w=n.create(m.element):(w=n.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var T=p.create({label:"Mouse Constraint",pointA:w.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),A={type:"mouseConstraint",mouse:w,element:null,body:null,constraint:T,collisionFilter:{category:1,mask:4294967295,group:0}},E=t.extend(A,m);return h.on(l,"beforeUpdate",function(){var g=u.allBodies(l.world);e.update(E,g),e._triggerEvents(E)}),E},e.update=function(l,m){var w=l.mouse,T=l.constraint,A=l.body;if(w.button===0){if(T.bodyB)i.set(T.bodyB,!1),T.pointA=w.position;else for(var E=0;E<m.length;E++)if(A=m[E],c.contains(A.bounds,w.position)&&r.canCollide(A.collisionFilter,l.collisionFilter))for(var g=A.parts.length>1?1:0;g<A.parts.length;g++){var x=A.parts[g];if(a.contains(x.vertices,w.position)){T.pointA=w.position,T.bodyB=l.body=A,T.pointB={x:w.position.x-A.position.x,y:w.position.y-A.position.y},T.angleB=A.angle,i.set(A,!1),h.trigger(l,"startdrag",{mouse:w,body:A});break}}}else T.bodyB=l.body=null,T.pointB=null,A&&h.trigger(l,"enddrag",{mouse:w,body:A})},e._triggerEvents=function(l){var m=l.mouse,w=m.sourceEvents;w.mousemove&&h.trigger(l,"mousemove",{mouse:m}),w.mousedown&&h.trigger(l,"mousedown",{mouse:m}),w.mouseup&&h.trigger(l,"mouseup",{mouse:m}),n.clearSourceEvents(m)}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(2),i=s(8),n=s(1),h=s(12),r=s(3);(function(){e.collides=function(p,u){for(var t=[],c=u.length,l=p.bounds,m=i.collides,w=n.overlaps,T=0;T<c;T++){var A=u[T],E=A.parts.length,g=E===1?0:1;if(w(A.bounds,l))for(var x=g;x<E;x++){var S=A.parts[x];if(w(S.bounds,l)){var y=m(S,p);if(y){t.push(y);break}}}}return t},e.ray=function(p,u,t,c){c=c||1e-100;for(var l=a.angle(u,t),m=a.magnitude(a.sub(u,t)),w=(t.x+u.x)*.5,T=(t.y+u.y)*.5,A=h.rectangle(w,T,m,c,{angle:l}),E=e.collides(A,p),g=0;g<E.length;g+=1){var x=E[g];x.body=x.bodyB=x.bodyA}return E},e.region=function(p,u,t){for(var c=[],l=0;l<p.length;l++){var m=p[l],w=n.overlaps(m.bounds,u);(w&&!t||!w&&t)&&c.push(m)}return c},e.point=function(p,u){for(var t=[],c=0;c<p.length;c++){var l=p[c];if(n.contains(l.bounds,u))for(var m=l.parts.length===1?0:1;m<l.parts.length;m++){var w=l.parts[m];if(n.contains(w.bounds,u)&&r.contains(w.vertices,u)){t.push(l);break}}}return t}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(4),i=s(0),n=s(6),h=s(1),r=s(5),p=s(2),u=s(14);(function(){var t,c;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(i.now())},1e3/60)},c=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(g){var x={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=i.extend(x,g);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=g.mouse,S.engine=g.engine,S.canvas=S.canvas||w(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=e,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&e.setPixelRatio(S,S.options.pixelRatio),i.isElement(S.element)&&S.element.appendChild(S.canvas),S},e.run=function(g){(function x(S){g.frameRequestId=t(x),l(g,S),e.world(g,S),g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0),(g.options.showStats||g.options.showDebug)&&e.stats(g,g.context,S),(g.options.showPerformance||g.options.showDebug)&&e.performance(g,g.context,S),g.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(g){c(g.frameRequestId)},e.setPixelRatio=function(g,x){var S=g.options,y=g.canvas;x==="auto"&&(x=T(y)),S.pixelRatio=x,y.setAttribute("data-pixel-ratio",x),y.width=S.width*x,y.height=S.height*x,y.style.width=S.width+"px",y.style.height=S.height+"px"},e.setSize=function(g,x,S){g.options.width=x,g.options.height=S,g.bounds.max.x=g.bounds.min.x+x,g.bounds.max.y=g.bounds.min.y+S,g.options.pixelRatio!==1?e.setPixelRatio(g,g.options.pixelRatio):(g.canvas.width=x,g.canvas.height=S)},e.lookAt=function(g,x,S,y){y=typeof y<"u"?y:!0,x=i.isArray(x)?x:[x],S=S||{x:0,y:0};for(var C={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},b=0;b<x.length;b+=1){var P=x[b],M=P.bounds?P.bounds.min:P.min||P.position||P,B=P.bounds?P.bounds.max:P.max||P.position||P;M&&B&&(M.x<C.min.x&&(C.min.x=M.x),B.x>C.max.x&&(C.max.x=B.x),M.y<C.min.y&&(C.min.y=M.y),B.y>C.max.y&&(C.max.y=B.y))}var I=C.max.x-C.min.x+2*S.x,L=C.max.y-C.min.y+2*S.y,F=g.canvas.height,O=g.canvas.width,N=O/F,V=I/L,z=1,Z=1;V>N?Z=V/N:z=N/V,g.options.hasBounds=!0,g.bounds.min.x=C.min.x,g.bounds.max.x=C.min.x+I*z,g.bounds.min.y=C.min.y,g.bounds.max.y=C.min.y+L*Z,y&&(g.bounds.min.x+=I*.5-I*z*.5,g.bounds.max.x+=I*.5-I*z*.5,g.bounds.min.y+=L*.5-L*Z*.5,g.bounds.max.y+=L*.5-L*Z*.5),g.bounds.min.x-=S.x,g.bounds.max.x-=S.x,g.bounds.min.y-=S.y,g.bounds.max.y-=S.y,g.mouse&&(u.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),u.setOffset(g.mouse,g.bounds.min))},e.startViewTransform=function(g){var x=g.bounds.max.x-g.bounds.min.x,S=g.bounds.max.y-g.bounds.min.y,y=x/g.options.width,C=S/g.options.height;g.context.setTransform(g.options.pixelRatio/y,0,0,g.options.pixelRatio/C,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},e.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},e.world=function(g,x){var S=i.now(),y=g.engine,C=y.world,b=g.canvas,P=g.context,M=g.options,B=g.timing,I=n.allBodies(C),L=n.allConstraints(C),F=M.wireframes?M.wireframeBackground:M.background,O=[],N=[],V,z={timestamp:y.timing.timestamp};if(r.trigger(g,"beforeRender",z),g.currentBackground!==F&&E(g,F),P.globalCompositeOperation="source-in",P.fillStyle="transparent",P.fillRect(0,0,b.width,b.height),P.globalCompositeOperation="source-over",M.hasBounds){for(V=0;V<I.length;V++){var Z=I[V];h.overlaps(Z.bounds,g.bounds)&&O.push(Z)}for(V=0;V<L.length;V++){var J=L[V],ee=J.bodyA,ue=J.bodyB,fe=J.pointA,K=J.pointB;ee&&(fe=p.add(ee.position,J.pointA)),ue&&(K=p.add(ue.position,J.pointB)),!(!fe||!K)&&(h.contains(g.bounds,fe)||h.contains(g.bounds,K))&&N.push(J)}e.startViewTransform(g),g.mouse&&(u.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),u.setOffset(g.mouse,g.bounds.min))}else N=L,O=I,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!M.wireframes||y.enableSleeping&&M.showSleeping?e.bodies(g,O,P):(M.showConvexHulls&&e.bodyConvexHulls(g,O,P),e.bodyWireframes(g,O,P)),M.showBounds&&e.bodyBounds(g,O,P),(M.showAxes||M.showAngleIndicator)&&e.bodyAxes(g,O,P),M.showPositions&&e.bodyPositions(g,O,P),M.showVelocity&&e.bodyVelocity(g,O,P),M.showIds&&e.bodyIds(g,O,P),M.showSeparations&&e.separations(g,y.pairs.list,P),M.showCollisions&&e.collisions(g,y.pairs.list,P),M.showVertexNumbers&&e.vertexNumbers(g,O,P),M.showMousePosition&&e.mousePosition(g,g.mouse,P),e.constraints(N,P),M.hasBounds&&e.endViewTransform(g),r.trigger(g,"afterRender",z),B.lastElapsed=i.now()-S},e.stats=function(g,x,S){for(var y=g.engine,C=y.world,b=n.allBodies(C),P=0,M=55,B=44,I=0,L=0,F=0;F<b.length;F+=1)P+=b[F].parts.length;var O={Part:P,Body:b.length,Cons:n.allConstraints(C).length,Comp:n.allComposites(C).length,Pair:y.pairs.list.length};x.fillStyle="#0e0f19",x.fillRect(I,L,M*5.5,B),x.font="12px Arial",x.textBaseline="top",x.textAlign="right";for(var N in O){var V=O[N];x.fillStyle="#aaa",x.fillText(N,I+M,L+8),x.fillStyle="#eee",x.fillText(V,I+M,L+26),I+=M}},e.performance=function(g,x){var S=g.engine,y=g.timing,C=y.deltaHistory,b=y.elapsedHistory,P=y.timestampElapsedHistory,M=y.engineDeltaHistory,B=y.engineUpdatesHistory,I=y.engineElapsedHistory,L=S.timing.lastUpdatesPerFrame,F=S.timing.lastDelta,O=m(C),N=m(b),V=m(M),z=m(B),Z=m(I),J=m(P),ee=J/O||0,ue=Math.round(O/F),fe=1e3/O||0,K=4,ge=12,oe=60,Ie=34,Oe=10,Be=69;x.fillStyle="#0e0f19",x.fillRect(0,50,ge*5+oe*6+22,Ie),e.status(x,Oe,Be,oe,K,C.length,Math.round(fe)+" fps",fe/e._goodFps,function(ve){return C[ve]/O-1}),e.status(x,Oe+ge+oe,Be,oe,K,M.length,F.toFixed(2)+" dt",e._goodDelta/F,function(ve){return M[ve]/V-1}),e.status(x,Oe+(ge+oe)*2,Be,oe,K,B.length,L+" upf",Math.pow(i.clamp(z/ue||1,0,1),4),function(ve){return B[ve]/z-1}),e.status(x,Oe+(ge+oe)*3,Be,oe,K,I.length,Z.toFixed(2)+" ut",1-L*Z/e._goodFps,function(ve){return I[ve]/Z-1}),e.status(x,Oe+(ge+oe)*4,Be,oe,K,b.length,N.toFixed(2)+" rt",1-N/e._goodFps,function(ve){return b[ve]/N-1}),e.status(x,Oe+(ge+oe)*5,Be,oe,K,P.length,ee.toFixed(2)+" x",ee*ee*ee,function(ve){return(P[ve]/C[ve]/ee||0)-1})},e.status=function(g,x,S,y,C,b,P,M,B){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(x,S+7,y,1),g.beginPath(),g.moveTo(x,S+7-C*i.clamp(.4*B(0),-2,2));for(var I=0;I<y;I+=1)g.lineTo(x+I,S+7-(I<b?C*i.clamp(.4*B(I),-2,2):0));g.stroke(),g.fillStyle="hsl("+i.clamp(25+95*M,0,120)+",100%,60%)",g.fillRect(x,S-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(P,x+y,S-5)},e.constraints=function(g,x){for(var S=x,y=0;y<g.length;y++){var C=g[y];if(!(!C.render.visible||!C.pointA||!C.pointB)){var b=C.bodyA,P=C.bodyB,M,B;if(b?M=p.add(b.position,C.pointA):M=C.pointA,C.render.type==="pin")S.beginPath(),S.arc(M.x,M.y,3,0,2*Math.PI),S.closePath();else{if(P?B=p.add(P.position,C.pointB):B=C.pointB,S.beginPath(),S.moveTo(M.x,M.y),C.render.type==="spring")for(var I=p.sub(B,M),L=p.perp(p.normalise(I)),F=Math.ceil(i.clamp(C.length/5,12,20)),O,N=1;N<F;N+=1)O=N%2===0?1:-1,S.lineTo(M.x+I.x*(N/F)+L.x*O*4,M.y+I.y*(N/F)+L.y*O*4);S.lineTo(B.x,B.y)}C.render.lineWidth&&(S.lineWidth=C.render.lineWidth,S.strokeStyle=C.render.strokeStyle,S.stroke()),C.render.anchors&&(S.fillStyle=C.render.strokeStyle,S.beginPath(),S.arc(M.x,M.y,3,0,2*Math.PI),S.arc(B.x,B.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},e.bodies=function(g,x,S){var y=S;g.engine;var C=g.options,b=C.showInternalEdges||!C.wireframes,P,M,B,I;for(B=0;B<x.length;B++)if(P=x[B],!!P.render.visible){for(I=P.parts.length>1?1:0;I<P.parts.length;I++)if(M=P.parts[I],!!M.render.visible){if(C.showSleeping&&P.isSleeping?y.globalAlpha=.5*M.render.opacity:M.render.opacity!==1&&(y.globalAlpha=M.render.opacity),M.render.sprite&&M.render.sprite.texture&&!C.wireframes){var L=M.render.sprite,F=A(g,L.texture);y.translate(M.position.x,M.position.y),y.rotate(M.angle),y.drawImage(F,F.width*-L.xOffset*L.xScale,F.height*-L.yOffset*L.yScale,F.width*L.xScale,F.height*L.yScale),y.rotate(-M.angle),y.translate(-M.position.x,-M.position.y)}else{if(M.circleRadius)y.beginPath(),y.arc(M.position.x,M.position.y,M.circleRadius,0,2*Math.PI);else{y.beginPath(),y.moveTo(M.vertices[0].x,M.vertices[0].y);for(var O=1;O<M.vertices.length;O++)!M.vertices[O-1].isInternal||b?y.lineTo(M.vertices[O].x,M.vertices[O].y):y.moveTo(M.vertices[O].x,M.vertices[O].y),M.vertices[O].isInternal&&!b&&y.moveTo(M.vertices[(O+1)%M.vertices.length].x,M.vertices[(O+1)%M.vertices.length].y);y.lineTo(M.vertices[0].x,M.vertices[0].y),y.closePath()}C.wireframes?(y.lineWidth=1,y.strokeStyle=g.options.wireframeStrokeStyle,y.stroke()):(y.fillStyle=M.render.fillStyle,M.render.lineWidth&&(y.lineWidth=M.render.lineWidth,y.strokeStyle=M.render.strokeStyle,y.stroke()),y.fill())}y.globalAlpha=1}}},e.bodyWireframes=function(g,x,S){var y=S,C=g.options.showInternalEdges,b,P,M,B,I;for(y.beginPath(),M=0;M<x.length;M++)if(b=x[M],!!b.render.visible)for(I=b.parts.length>1?1:0;I<b.parts.length;I++){for(P=b.parts[I],y.moveTo(P.vertices[0].x,P.vertices[0].y),B=1;B<P.vertices.length;B++)!P.vertices[B-1].isInternal||C?y.lineTo(P.vertices[B].x,P.vertices[B].y):y.moveTo(P.vertices[B].x,P.vertices[B].y),P.vertices[B].isInternal&&!C&&y.moveTo(P.vertices[(B+1)%P.vertices.length].x,P.vertices[(B+1)%P.vertices.length].y);y.lineTo(P.vertices[0].x,P.vertices[0].y)}y.lineWidth=1,y.strokeStyle=g.options.wireframeStrokeStyle,y.stroke()},e.bodyConvexHulls=function(g,x,S){var y=S,C,b,P;for(y.beginPath(),b=0;b<x.length;b++)if(C=x[b],!(!C.render.visible||C.parts.length===1)){for(y.moveTo(C.vertices[0].x,C.vertices[0].y),P=1;P<C.vertices.length;P++)y.lineTo(C.vertices[P].x,C.vertices[P].y);y.lineTo(C.vertices[0].x,C.vertices[0].y)}y.lineWidth=1,y.strokeStyle="rgba(255,255,255,0.2)",y.stroke()},e.vertexNumbers=function(g,x,S){var y=S,C,b,P;for(C=0;C<x.length;C++){var M=x[C].parts;for(P=M.length>1?1:0;P<M.length;P++){var B=M[P];for(b=0;b<B.vertices.length;b++)y.fillStyle="rgba(255,255,255,0.2)",y.fillText(C+"_"+b,B.position.x+(B.vertices[b].x-B.position.x)*.8,B.position.y+(B.vertices[b].y-B.position.y)*.8)}}},e.mousePosition=function(g,x,S){var y=S;y.fillStyle="rgba(255,255,255,0.8)",y.fillText(x.position.x+"  "+x.position.y,x.position.x+5,x.position.y-5)},e.bodyBounds=function(g,x,S){var y=S;g.engine;var C=g.options;y.beginPath();for(var b=0;b<x.length;b++){var P=x[b];if(P.render.visible)for(var M=x[b].parts,B=M.length>1?1:0;B<M.length;B++){var I=M[B];y.rect(I.bounds.min.x,I.bounds.min.y,I.bounds.max.x-I.bounds.min.x,I.bounds.max.y-I.bounds.min.y)}}C.wireframes?y.strokeStyle="rgba(255,255,255,0.08)":y.strokeStyle="rgba(0,0,0,0.1)",y.lineWidth=1,y.stroke()},e.bodyAxes=function(g,x,S){var y=S;g.engine;var C=g.options,b,P,M,B;for(y.beginPath(),P=0;P<x.length;P++){var I=x[P],L=I.parts;if(I.render.visible)if(C.showAxes)for(M=L.length>1?1:0;M<L.length;M++)for(b=L[M],B=0;B<b.axes.length;B++){var F=b.axes[B];y.moveTo(b.position.x,b.position.y),y.lineTo(b.position.x+F.x*20,b.position.y+F.y*20)}else for(M=L.length>1?1:0;M<L.length;M++)for(b=L[M],B=0;B<b.axes.length;B++)y.moveTo(b.position.x,b.position.y),y.lineTo((b.vertices[0].x+b.vertices[b.vertices.length-1].x)/2,(b.vertices[0].y+b.vertices[b.vertices.length-1].y)/2)}C.wireframes?(y.strokeStyle="indianred",y.lineWidth=1):(y.strokeStyle="rgba(255, 255, 255, 0.4)",y.globalCompositeOperation="overlay",y.lineWidth=2),y.stroke(),y.globalCompositeOperation="source-over"},e.bodyPositions=function(g,x,S){var y=S;g.engine;var C=g.options,b,P,M,B;for(y.beginPath(),M=0;M<x.length;M++)if(b=x[M],!!b.render.visible)for(B=0;B<b.parts.length;B++)P=b.parts[B],y.arc(P.position.x,P.position.y,3,0,2*Math.PI,!1),y.closePath();for(C.wireframes?y.fillStyle="indianred":y.fillStyle="rgba(0,0,0,0.5)",y.fill(),y.beginPath(),M=0;M<x.length;M++)b=x[M],b.render.visible&&(y.arc(b.positionPrev.x,b.positionPrev.y,2,0,2*Math.PI,!1),y.closePath());y.fillStyle="rgba(255,165,0,0.8)",y.fill()},e.bodyVelocity=function(g,x,S){var y=S;y.beginPath();for(var C=0;C<x.length;C++){var b=x[C];if(b.render.visible){var P=a.getVelocity(b);y.moveTo(b.position.x,b.position.y),y.lineTo(b.position.x+P.x,b.position.y+P.y)}}y.lineWidth=3,y.strokeStyle="cornflowerblue",y.stroke()},e.bodyIds=function(g,x,S){var y=S,C,b;for(C=0;C<x.length;C++)if(x[C].render.visible){var P=x[C].parts;for(b=P.length>1?1:0;b<P.length;b++){var M=P[b];y.font="12px Arial",y.fillStyle="rgba(255,255,255,0.5)",y.fillText(M.id,M.position.x+10,M.position.y-10)}}},e.collisions=function(g,x,S){var y=S,C=g.options,b,P,M,B;for(y.beginPath(),M=0;M<x.length;M++)if(b=x[M],!!b.isActive)for(P=b.collision,B=0;B<b.contactCount;B++){var I=b.contacts[B],L=I.vertex;y.rect(L.x-1.5,L.y-1.5,3.5,3.5)}for(C.wireframes?y.fillStyle="rgba(255,255,255,0.7)":y.fillStyle="orange",y.fill(),y.beginPath(),M=0;M<x.length;M++)if(b=x[M],!!b.isActive&&(P=b.collision,b.contactCount>0)){var F=b.contacts[0].vertex.x,O=b.contacts[0].vertex.y;b.contactCount===2&&(F=(b.contacts[0].vertex.x+b.contacts[1].vertex.x)/2,O=(b.contacts[0].vertex.y+b.contacts[1].vertex.y)/2),P.bodyB===P.supports[0].body||P.bodyA.isStatic===!0?y.moveTo(F-P.normal.x*8,O-P.normal.y*8):y.moveTo(F+P.normal.x*8,O+P.normal.y*8),y.lineTo(F,O)}C.wireframes?y.strokeStyle="rgba(255,165,0,0.7)":y.strokeStyle="orange",y.lineWidth=1,y.stroke()},e.separations=function(g,x,S){var y=S,C=g.options,b,P,M,B,I;for(y.beginPath(),I=0;I<x.length;I++)if(b=x[I],!!b.isActive){P=b.collision,M=P.bodyA,B=P.bodyB;var L=1;!B.isStatic&&!M.isStatic&&(L=.5),B.isStatic&&(L=0),y.moveTo(B.position.x,B.position.y),y.lineTo(B.position.x-P.penetration.x*L,B.position.y-P.penetration.y*L),L=1,!B.isStatic&&!M.isStatic&&(L=.5),M.isStatic&&(L=0),y.moveTo(M.position.x,M.position.y),y.lineTo(M.position.x+P.penetration.x*L,M.position.y+P.penetration.y*L)}C.wireframes?y.strokeStyle="rgba(255,165,0,0.5)":y.strokeStyle="orange",y.stroke()},e.inspector=function(g,x){g.engine;var S=g.selected,y=g.render,C=y.options,b;if(C.hasBounds){var P=y.bounds.max.x-y.bounds.min.x,M=y.bounds.max.y-y.bounds.min.y,B=P/y.options.width,I=M/y.options.height;x.scale(1/B,1/I),x.translate(-y.bounds.min.x,-y.bounds.min.y)}for(var L=0;L<S.length;L++){var F=S[L].data;switch(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.9)",x.setLineDash([1,2]),F.type){case"body":b=F.bounds,x.beginPath(),x.rect(Math.floor(b.min.x-3),Math.floor(b.min.y-3),Math.floor(b.max.x-b.min.x+6),Math.floor(b.max.y-b.min.y+6)),x.closePath(),x.stroke();break;case"constraint":var O=F.pointA;F.bodyA&&(O=F.pointB),x.beginPath(),x.arc(O.x,O.y,10,0,2*Math.PI),x.closePath(),x.stroke();break}x.setLineDash([]),x.translate(-.5,-.5)}g.selectStart!==null&&(x.translate(.5,.5),x.lineWidth=1,x.strokeStyle="rgba(255,165,0,0.6)",x.fillStyle="rgba(255,165,0,0.1)",b=g.selectBounds,x.beginPath(),x.rect(Math.floor(b.min.x),Math.floor(b.min.y),Math.floor(b.max.x-b.min.x),Math.floor(b.max.y-b.min.y)),x.closePath(),x.stroke(),x.fill(),x.translate(-.5,-.5)),C.hasBounds&&x.setTransform(1,0,0,1,0,0)};var l=function(g,x){var S=g.engine,y=g.timing,C=y.historySize,b=S.timing.timestamp;y.delta=x-y.lastTime||e._goodDelta,y.lastTime=x,y.timestampElapsed=b-y.lastTimestamp||0,y.lastTimestamp=b,y.deltaHistory.unshift(y.delta),y.deltaHistory.length=Math.min(y.deltaHistory.length,C),y.engineDeltaHistory.unshift(S.timing.lastDelta),y.engineDeltaHistory.length=Math.min(y.engineDeltaHistory.length,C),y.timestampElapsedHistory.unshift(y.timestampElapsed),y.timestampElapsedHistory.length=Math.min(y.timestampElapsedHistory.length,C),y.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),y.engineUpdatesHistory.length=Math.min(y.engineUpdatesHistory.length,C),y.engineElapsedHistory.unshift(S.timing.lastElapsed),y.engineElapsedHistory.length=Math.min(y.engineElapsedHistory.length,C),y.elapsedHistory.unshift(y.lastElapsed),y.elapsedHistory.length=Math.min(y.elapsedHistory.length,C)},m=function(g){for(var x=0,S=0;S<g.length;S+=1)x+=g[S];return x/g.length||0},w=function(g,x){var S=document.createElement("canvas");return S.width=g,S.height=x,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},T=function(g){var x=g.getContext("2d"),S=window.devicePixelRatio||1,y=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1;return S/y},A=function(g,x){var S=g.textures[x];return S||(S=g.textures[x]=new Image,S.src=x,S)},E=function(g,x){var S=x;/(jpg|gif|png)$/.test(x)&&(S="url("+x+")"),g.canvas.style.background=S,g.canvas.style.backgroundSize="contain",g.currentBackground=x}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(5),i=s(17),n=s(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(r){var p={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},u=n.extend(p,r);return u.fps=0,u},e.run=function(r,p){return r.timeBuffer=e._frameDeltaFallback,(function u(t){r.frameRequestId=e._onNextFrame(r,u),t&&r.enabled&&e.tick(r,p,t)})(),r},e.tick=function(r,p,u){var t=n.now(),c=r.delta,l=0,m=u-r.timeLastTick;if((!m||!r.timeLastTick||m>Math.max(e._maxFrameDelta,r.maxFrameTime))&&(m=r.frameDelta||e._frameDeltaFallback),r.frameDeltaSmoothing){r.frameDeltaHistory.push(m),r.frameDeltaHistory=r.frameDeltaHistory.slice(-r.frameDeltaHistorySize);var w=r.frameDeltaHistory.slice(0).sort(),T=r.frameDeltaHistory.slice(w.length*e._smoothingLowerBound,w.length*e._smoothingUpperBound),A=h(T);m=A||m}r.frameDeltaSnapping&&(m=1e3/Math.round(1e3/m)),r.frameDelta=m,r.timeLastTick=u,r.timeBuffer+=r.frameDelta,r.timeBuffer=n.clamp(r.timeBuffer,0,r.frameDelta+c*e._timeBufferMargin),r.lastUpdatesDeferred=0;var E=r.maxUpdates||Math.ceil(r.maxFrameTime/c),g={timestamp:p.timing.timestamp};a.trigger(r,"beforeTick",g),a.trigger(r,"tick",g);for(var x=n.now();c>0&&r.timeBuffer>=c*e._timeBufferMargin;){a.trigger(r,"beforeUpdate",g),i.update(p,c),a.trigger(r,"afterUpdate",g),r.timeBuffer-=c,l+=1;var S=n.now()-t,y=n.now()-x,C=S+e._elapsedNextEstimate*y/l;if(l>=E||C>r.maxFrameTime){r.lastUpdatesDeferred=Math.round(Math.max(0,r.timeBuffer/c-e._timeBufferMargin));break}}p.timing.lastUpdatesPerFrame=l,a.trigger(r,"afterTick",g),r.frameDeltaHistory.length>=100&&(r.lastUpdatesDeferred&&Math.round(r.frameDelta/c)>E?n.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):r.lastUpdatesDeferred&&n.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof r.isFixed<"u"&&n.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(r.deltaMin||r.deltaMax)&&n.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),r.fps!==0&&n.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(r){e._cancelNextFrame(r)},e._onNextFrame=function(r,p){if(typeof window<"u"&&window.requestAnimationFrame)r.frameRequestId=window.requestAnimationFrame(p);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return r.frameRequestId},e._cancelNextFrame=function(r){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(r.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var h=function(r){for(var p=0,u=r.length,t=0;t<u;t+=1)p+=r[t];return p/u||0}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(8),i=s(0),n=i.deprecated;(function(){e.collides=function(h,r){return a.collides(h,r)},n(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(d,v,s){var e={};d.exports=e,s(1);var a=s(0);(function(){e.pathToVertices=function(i,n){typeof window<"u"&&!("SVGPathSeg"in window)&&a.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var h,r,p,u,t,c,l,m,w,T,A=[],E,g,x=0,S=0,y=0;n=n||15;var C=function(P,M,B){var I=B%2===1&&B>1;if(!w||P!=w.x||M!=w.y){w&&I?(E=w.x,g=w.y):(E=0,g=0);var L={x:E+P,y:g+M};(I||!w)&&(w=L),A.push(L),S=E+P,y=g+M}},b=function(P){var M=P.pathSegTypeAsLetter.toUpperCase();if(M!=="Z"){switch(M){case"M":case"L":case"T":case"C":case"S":case"Q":S=P.x,y=P.y;break;case"H":S=P.x;break;case"V":y=P.y;break}C(S,y,P.pathSegType)}};for(e._svgPathToAbsolute(i),p=i.getTotalLength(),c=[],h=0;h<i.pathSegList.numberOfItems;h+=1)c.push(i.pathSegList.getItem(h));for(l=c.concat();x<p;){if(T=i.getPathSegAtLength(x),t=c[T],t!=m){for(;l.length&&l[0]!=t;)b(l.shift());m=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":u=i.getPointAtLength(x),C(u.x,u.y,0);break}x+=n}for(h=0,r=l.length;h<r;++h)b(l[h]);return A},e._svgPathToAbsolute=function(i){for(var n,h,r,p,u,t,c=i.pathSegList,l=0,m=0,w=c.numberOfItems,T=0;T<w;++T){var A=c.getItem(T),E=A.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(E))"x"in A&&(l=A.x),"y"in A&&(m=A.y);else switch("x1"in A&&(r=l+A.x1),"x2"in A&&(u=l+A.x2),"y1"in A&&(p=m+A.y1),"y2"in A&&(t=m+A.y2),"x"in A&&(l+=A.x),"y"in A&&(m+=A.y),E){case"m":c.replaceItem(i.createSVGPathSegMovetoAbs(l,m),T);break;case"l":c.replaceItem(i.createSVGPathSegLinetoAbs(l,m),T);break;case"h":c.replaceItem(i.createSVGPathSegLinetoHorizontalAbs(l),T);break;case"v":c.replaceItem(i.createSVGPathSegLinetoVerticalAbs(m),T);break;case"c":c.replaceItem(i.createSVGPathSegCurvetoCubicAbs(l,m,r,p,u,t),T);break;case"s":c.replaceItem(i.createSVGPathSegCurvetoCubicSmoothAbs(l,m,u,t),T);break;case"q":c.replaceItem(i.createSVGPathSegCurvetoQuadraticAbs(l,m,r,p),T);break;case"t":c.replaceItem(i.createSVGPathSegCurvetoQuadraticSmoothAbs(l,m),T);break;case"a":c.replaceItem(i.createSVGPathSegArcAbs(l,m,A.r1,A.r2,A.angle,A.largeArcFlag,A.sweepFlag),T);break;case"z":case"Z":l=n,m=h;break}(E=="M"||E=="m")&&(n=l,h=m)}}})()}),(function(d,v,s){var e={};d.exports=e;var a=s(6);s(0),(function(){e.create=a.create,e.add=a.add,e.remove=a.remove,e.clear=a.clear,e.addComposite=a.addComposite,e.addBody=a.addBody,e.addConstraint=a.addConstraint})()})])})})(cn)),cn.exports}var qo=jo();const st=$o(qo),ni="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Ct(o){const f=Number(o);return Number.isFinite(f)?Math.max(0,Math.min(1,f)):0}function tn(){const o=Math.floor(Math.random()*ni.length);return ni[o]||"A"}function Ko(o,f){return o+Math.random()*(f-o)}function _o(o,f){if(!o||!f)return null;try{const d=ke&&typeof ke.getScale=="function"&&ke.getScale()||1,v=o.getBoundingClientRect(),s=f.getBoundingClientRect(),e=(v.left-s.left)/(d||1),a=(v.top-s.top)/(d||1),i=v.width/(d||1),n=v.height/(d||1);return[e,a,i,n].every(Number.isFinite)?{x:e,y:a,w:i,h:n}:null}catch{return null}}function ii(o,f){return!o||!f?!1:o.x>=f.x&&o.y>=f.y&&o.x<=f.x+f.w&&o.y<=f.y+f.h}function Ai(o){return!!o&&o.tagName&&String(o.tagName).toUpperCase()==="CANVAS"}function Qo(o,f){if(!o||!Ai(o))return;const d=o.getContext("2d");if(!d)return;const v=o.getBoundingClientRect(),s=Math.max(1,Math.floor(v.width||180)),e=Math.max(1,Math.floor(v.height||180)),a=window.devicePixelRatio||1,i=Math.max(1,Math.floor(s*a)),n=Math.max(1,Math.floor(e*a));o.width!==i&&(o.width=i),o.height!==n&&(o.height=n),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,i,n);const h=Math.round(Math.min(i,n)*.67);d.font=`900 ${h}px system-ui, -apple-system, Segoe UI, Arial, sans-serif`,d.textBaseline="alphabetic",d.textAlign="center";const r=String(f||"A").toUpperCase().slice(0,1),p=d.measureText(r),u=Number.isFinite(p.actualBoundingBoxAscent)&&Number.isFinite(p.actualBoundingBoxDescent)&&Number.isFinite(p.actualBoundingBoxLeft)&&Number.isFinite(p.actualBoundingBoxRight),t=u?p.actualBoundingBoxAscent:h*.78,c=u?p.actualBoundingBoxDescent:h*.22,m=n/2+(t-c)/2;let w=i/2;u&&(w=i/2+(p.actualBoundingBoxLeft-p.actualBoundingBoxRight)/2),d.lineJoin="round",d.miterLimit=2,d.lineWidth=Math.max(2,Math.round(h*.1)),d.strokeStyle="rgba(0,0,0,0.62)",d.fillStyle="rgba(255,255,255,0.98)",d.shadowColor="rgba(0,0,0,0.22)",d.shadowBlur=Math.round(h*.06),d.shadowOffsetX=0,d.shadowOffsetY=Math.round(h*.02),d.strokeText(r,w,m),d.fillText(r,w,m)}function nn(){const o=ke&&typeof ke.getReferenceSize=="function"?ke.getReferenceSize():{width:1280,height:800},f=o&&Number.isFinite(o.width)?o.width:1280,d=o&&Number.isFinite(o.height)?o.height:800;return{width:f,height:d}}function Pn(o,f,d){return o?(o.classList.add(f),setTimeout(()=>{try{o.classList.remove(f)}catch{}},d)):null}function Yo(o){const f=o&&o.canvas,d=o&&o.hudEl,v=o&&o.glyphEl,s=o&&o.config&&typeof o.config=="object"?o.config:{};if(!f)return{start:function(){},dispose:function(){}};const e=st&&st.Engine?st:st&&st.default&&st.default.Engine?st.default:st,{Engine:a,World:i,Bodies:n,Body:h,Events:r}=e;let p=!1,u=null,t=null,c=null,l=null,m=[],w=new Set,T=null,A=null,E=null,g="introducing",x=tn(),S=tn(),y=null,C=0,b=0;const P=new Map,M="letters.score.v1",B=new Map,I=new Map;let L=null,F=0,O=0,N=!1,V=null;const z={x:0,y:0,w:190,h:190},Z=Number.isFinite(s.gravityY)?s.gravityY:1.15;Number.isFinite(s.settleBeatMs)&&s.settleBeatMs;const J=Number.isFinite(s.introBeatMs)?s.introBeatMs:650,ee=Number.isFinite(s.postLaunchLockMs)?s.postLaunchLockMs:200,ue=Number.isFinite(s.scoreBeatMs)?s.scoreBeatMs:650,fe=Number.isFinite(s.catchLingerMinMs)?s.catchLingerMinMs:1200,K=Number.isFinite(s.catchStillMs)?s.catchStillMs:520,ge=Number.isFinite(s.catchPostConfirmHoldMs)?s.catchPostConfirmHoldMs:1100,oe=Number.isFinite(s.nextReadyBaseMs)?s.nextReadyBaseMs:1800,Ie=Number.isFinite(s.nextReadyRandomMinMs)?s.nextReadyRandomMinMs:1e3,Oe=Number.isFinite(s.nextReadyRandomMaxMs)?s.nextReadyRandomMaxMs:3e3,Be=Number.isFinite(s.stuckMinDropMs)?s.stuckMinDropMs:2200,ve=Number.isFinite(s.stuckNoMotionMs)?s.stuckNoMotionMs:2600,Et=Number.isFinite(s.stuckPulseMs)?s.stuckPulseMs:2200,lt=Number.isFinite(s.stuckSpeedEps)?s.stuckSpeedEps:.22,gn=Number.isFinite(s.catchStillSpeedEps)?s.catchStillSpeedEps:.32,ze=[{id:"red",hex:"#E11D48"},{id:"orange",hex:"#F97316"},{id:"yellow",hex:"#F59E0B"},{id:"green",hex:"#16A34A"},{id:"blue",hex:"#2563EB"},{id:"purple",hex:"#7C3AED"}];function kt(D){const W={},k=D&&typeof D=="object"?D:{};for(const H of ze){const Q=H.id,re=k[Q]&&typeof k[Q]=="object"?k[Q]:{},$=Number.isFinite(re.count)?Math.floor(re.count):0,ye=Number.isFinite(re.stars)?Math.floor(re.stars):0;W[Q]={count:Math.max(0,Math.min(9,$)),stars:Math.max(0,ye)}}return W}function dt(){try{const D=Ge.get(M,null);return kt(D)}catch{return kt(null)}}function $e(){try{Ge.set(M,L)}catch{}}function Ut(D){const W=String(D||"");L||(L=dt()),L[W]||(L[W]={count:0,stars:0});const k=performance.now?performance.now():Date.now(),H=L[W];H.count=Math.max(0,Math.min(9,Math.floor(H.count||0)))+1;let Q=!1;H.count>=10&&(H.count=0,H.stars=Math.max(0,Math.floor(H.stars||0))+1,Q=!0),$e(),B.set(W,{start:k,end:k+520}),R.scoreTick(.72),Q&&(I.set(W,{start:k,end:k+1100}),qe(()=>{p||R.star(.95)},120))}function je(D){g=D}function zt(D){x=String(D||"A").toUpperCase().slice(0,1),v&&(Ai(v)?Qo(v,x):v.textContent=x)}function ct(D){d&&(D?d.classList.add("wos-letters-hud--empty"):d.classList.remove("wos-letters-hud--empty"))}function $t(){for(const D of Array.from(w))try{clearTimeout(D)}catch{}w.clear()}function qe(D,W){const k=setTimeout(()=>{w.delete(k);try{D()}catch{}},W);return w.add(k),k}function ht(D){const W=D&&D.key?String(D.key):"";return W&&W.length===1?W.toUpperCase():""}function Bt(){const D=nn(),W=Math.max(1,Math.floor(D.width)),k=Math.max(1,Math.floor(D.height));return f.width!==W&&(f.width=W),f.height!==k&&(f.height=k),{w:W,h:k}}function vn(D,W){const k=ke&&typeof ke.getScale=="function"&&ke.getScale()||1,H=f.getBoundingClientRect(),Q=(D-H.left)/k,re=(W-H.top)/k;return{x:Q,y:re}}function mt(D){return D.x>=z.x&&D.y>=z.y&&D.x<=z.x+z.w&&D.y<=z.y+z.h}function gt(){t=a.create({enableSleeping:!0}),c=t.world,c.gravity.y=Z;const D=nn(),W=D.width,k=D.height;T=_o(d,f);const H=60,Q=n.rectangle(W/2,k+H/2,W+H*2,H,{isStatic:!0}),re=n.rectangle(-H/2,k/2,H,k+H*2,{isStatic:!0}),$=n.rectangle(W+H/2,k/2,H,k+H*2,{isStatic:!0}),ye=n.rectangle(W/2,-H/2,W+H*2,H,{isStatic:!0});i.add(c,[Q,re,$,ye]);const te=12,ne=k-180,U=110,q=ne-62,Y=140,pe=(()=>{if(!T)return null;const G=140,_=18;return{x:Math.max(0,T.x-G),y:Math.max(0,T.y-_),w:Math.min(W,G+8),h:Math.min(k,T.h+_*2)}})(),Ae=Math.floor(Math.random()*1e9);function Se(G){return function(){G|=0,G=G+1831565813|0;let _=Math.imul(G^G>>>15,1|G);return _=_+Math.imul(_^_>>>7,61|_)^_,((_^_>>>14)>>>0)/4294967296}}const X=Se(Ae);function se(G,_){const be=Math.sin(G*12.9898+_*78.233+Ae*1e-6)*43758.5453123;return be-Math.floor(be)}function de(G,_){if(T){const be={x:G,y:_};if(ii(be,T)||pe&&ii(be,pe))return!0}else if(G>W-240&&_<240)return!0;return!1}function he({thresholdBase:G}){const _=[],Re=.01+X()*.004,xe=.01+X()*.004,Le=.006+X()*.003,jt=.006+X()*.003,qt=X()*Math.PI*2,vt=X()*Math.PI*2,Kt=X()*Math.PI*2,_t=X()*Math.PI*2,yt=te*3.15,xt=yt,it=new Map,xn=yt*yt;function wn(We,Pe){return`${We},${Pe}`}function Qt(We,Pe){const wt=Math.floor(We/xt),ot=Math.floor(Pe/xt);for(let Ee=ot-1;Ee<=ot+1;Ee++)for(let ft=wt-1;ft<=wt+1;ft++){const Yt=it.get(wn(ft,Ee));if(Yt)for(const Mn of Yt){const bn=_[Mn],Tn=bn.x-We,Xt=bn.y-Pe;if(Tn*Tn+Xt*Xt<xn)return!1}}return!0}function qn(We,Pe){const wt=Math.floor(We/xt),ot=Math.floor(Pe/xt),Ee=wn(wt,ot),ft=_.length;_.push({x:We,y:Pe}),it.has(Ee)||it.set(Ee,[]),it.get(Ee).push(ft)}const Sn=W/2,Kn=Sn-6,$i=Math.max(3,Math.floor((q-U)/102)+2),Gi=Math.max(3,Math.floor((Kn-Y)/118)+2);for(let We=0;We<$i;We++){const Pe=U+We*102;if(Pe<U-10||Pe>q+10)continue;const wt=We%2*(118/2);for(let ot=0;ot<Gi;ot++){const Ee=Y+ot*118+wt;if(Ee<Y||Ee>Kn)continue;const ft=(Pe-U)/Math.max(1,q-U),Yt=.12*Math.sin(ft*2*Math.PI+qt),Mn=.06*Math.cos(Ee/W*2*Math.PI+vt);if(!(se(Ee*.018,Pe*.018)>G+Yt+Mn))continue;const Xt=18*(.65*Math.sin(Pe*xe+Kt)+.35*Math.sin(Ee*Le+_t)),ji=18*(.55*Math.sin(Ee*Re+vt)+.25*Math.sin(Pe*jt+qt)),qi=(X()*2-1)*8,Ki=(X()*2-1)*8,St=Ee+Xt+qi,Mt=Pe+ji+Ki;if(!(St<Y||St>W-Y)&&!(Mt<U||Mt>q)&&!de(St,Mt)&&Qt(St,Mt)&&(qn(St,Mt),X()<.86)){const Lt=Sn+(Sn-St),It=Mt+(X()*2-1)*3;Lt>Y&&Lt<W-Y&&It>=U&&It<=q&&!de(Lt,It)&&Qt(Lt,It)&&qn(Lt,It)}}}return _}const Me=56,ie=86;let ae=[],le=.28;for(let G=0;G<5;G++){if(ae=he({thresholdBase:le}),ae.length<Me)le-=.03;else if(ae.length>ie)le+=.03;else break;le=Math.max(.12,Math.min(.46,le))}E={W,H:k,pegRadius:te,pegTop:U,pegBottom:q,xPad:Y,maxDrift:46,minDist:te*3.15,inNoGoZones:de};const Ve=[];for(const G of ae){const _=n.circle(G.x,G.y,te,{isStatic:!0,restitution:.95,friction:.02});_.label="peg",_.plugin=_.plugin||{},_.plugin.kind="peg",_.plugin.home={x:G.x,y:G.y},_.plugin.style={shade:.74+X()*.2,fillAlpha:.72+X()*.18,outlineAlpha:.55+X()*.2,ringAlpha:.14+X()*.16,drawRadiusJitter:(X()*2-1)*1.8,highlightAngle:X()*Math.PI*2,wiggleUntilMs:0},Ve.push(_)}i.add(c,Ve);const Ke=160,Gt=ze.length,ut=W/Gt,tt=18;for(let G=0;G<Gt;G++){const _=G*ut,be=(G+1)*ut,Ce=(_+be)/2,Te=n.rectangle(_+tt/2,ne+Ke/2,tt,Ke,{isStatic:!0,restitution:.25}),Re=n.rectangle(be-tt/2,ne+Ke/2,tt,Ke,{isStatic:!0,restitution:.25});Te.label="binWall",Re.label="binWall",Te.plugin={binId:ze[G].id},Re.plugin={binId:ze[G].id};const xe=n.rectangle(Ce,ne+Ke,ut,22,{isStatic:!0,restitution:.15,friction:.02});xe.label="binLip",xe.plugin={binId:ze[G].id};const Le=n.rectangle(Ce,ne+Ke-20,ut-tt*2,40,{isStatic:!0,isSensor:!0});Le.label="binSensor",Le.plugin={binId:ze[G].id},i.add(c,[Te,Re,xe,Le])}const nt=G=>{if(p||!y||!y.body||g!=="dropping"&&g!=="inBin"&&g!=="rewarding")return;const _=G&&G.pairs?G.pairs:[];for(const be of _){const Ce=be.bodyA,Te=be.bodyB,Re=Ce===y.body?Ce:Te===y.body?Te:null,xe=Re===Ce?Te:Re===Te?Ce:null;if(Re&&xe&&!xe.isSensor&&!Re.isSensor)try{const vt=Re.velocity||{x:0,y:0},Kt=xe.velocity||{x:0,y:0},_t=(vt.x||0)-(Kt.x||0),yt=(vt.y||0)-(Kt.y||0),xt=Math.sqrt(_t*_t+yt*yt),it=Ct((xt-1.5)/12.5);if(it>.02){const xn=xe.isStatic&&xe.circleRadius;if(xe.label==="binWall"||xe.label==="binLip"||xe.plugin&&xe.plugin.binId)R.binBounce(it);else{const Qt=xn?"peg":"wall";R.bounce(it,Qt)}}}catch{}const Le=Ce&&Ce.label==="binSensor"?Ce:Te&&Te.label==="binSensor"?Te:null,jt=Le===Ce?Te:Le===Te?Ce:null;if(!Le||!jt||jt!==y.body)continue;const qt=Le.plugin&&Le.plugin.binId?String(Le.plugin.binId):"unknown";Wi(qt,be);break}};r.on(t,"collisionStart",nt),m.push(()=>{try{r.off(t,"collisionStart",nt)}catch{}})}function Oi(){const D=nn(),W=D.width,k=D.height;let H=W-120,Q=120;try{if(d){const Y=ke&&typeof ke.getScale=="function"&&ke.getScale()||1,pe=d.getBoundingClientRect(),Ae=f.getBoundingClientRect(),Se=pe.left-18,X=pe.top+pe.height*.52;H=(Se-Ae.left)/(Y||1),Q=(X-Ae.top)/(Y||1)}}catch{}H=Math.max(80,Math.min(W-80,H)),Q=Math.max(80,Math.min(k-400,Q));const $=n.circle(H,Q,32,{restitution:.68,friction:.02,frictionAir:.006,density:.0025});$.label="letter",$.plugin={letter:x},i.add(c,$),y={body:$,letter:x};const ye=performance.now?performance.now():Date.now();F=ye,O=ye,N=!1;const te=Math.random();let ne;te<.55?ne=-(7+Math.random()*7):te<.9?ne=-(12+Math.random()*12):ne=-(20+Math.random()*16);const U=Math.random();let q;U<.6?q=-(1.2+Math.random()*4.2):U<.92?q=-(2.8+Math.random()*6):q=-(5.5+Math.random()*7);try{h.setVelocity($,{x:ne,y:q})}catch{}try{h.setAngularVelocity($,(Math.random()*2-1)*.14)}catch{}}function zn(){if(!c||!y||!y.body){y=null;return}try{i.remove(c,y.body)}catch{}y=null}function yn(D,W){if(p)return;zn(),V=null,je("introducing"),ct(!0);const k=!!(W&&W.initial),H=k?250:oe,Q=k?450:Ie,re=k?1100:Oe,$=()=>qe(()=>{if(p)return;try{!R.isUnlocked||!R.isUnlocked()||R.ready(k?.52:.62)}catch{}const ye=Math.round(Ko(Q,re));if(A){try{A()}catch{}A=null}try{R.isUnlocked&&R.isUnlocked()&&(A=R.drumroll(ye,k?.42:.55))}catch{}qe(()=>{if(p)return;if(A){try{A()}catch{}A=null}const te=Math.random(),ne=te<.34?"left":te<.68?"right":te<.86?"wiggle":"none";d&&d.setAttribute("data-wos-letters-intro",ne),zt(S),S=tn(),ct(!1),d&&Pn(d,"wos-letters-hud--intro-slow",700);try{R.isUnlocked&&R.isUnlocked()&&R.pop(.28)}catch{}qe(()=>{p||je("idleAwaitingKey")},J)},ye)},H);D?(Ut(D),qe(()=>{p||$()},ue)):$()}function Ri(D){if(!y||!y.body||g!=="dropping"||D-F<Be)return;const W=y.body.velocity||{x:0,y:0};if(Math.sqrt((W.x||0)*(W.x||0)+(W.y||0)*(W.y||0))>lt){O=D,N=!1;return}!N&&D-O>=ve&&(N=!0),N&&D-(O+ve)>=Et&&(R.poof(.65),yn())}function Fi(D){if(!y||!y.body||g!=="inBin"||!V)return;const H=nn().height-180;if(y.body.position&&y.body.position.y<H-70){V=null,je("dropping");return}const Q=y.body.velocity||{x:0,y:0};Math.sqrt((Q.x||0)*(Q.x||0)+(Q.y||0)*(Q.y||0))<=gn?V.stillStartMs||(V.stillStartMs=D):V.stillStartMs=0;const $=D-V.enterMs>=fe,ye=!!(V.stillStartMs&&D-V.stillStartMs>=K);if(!$||!ye)return;je("rewarding");const te=Math.max(.7,Ct(V.impactStrength||.6));R.reward(V.binId,te);const ne=D;P.set(V.binId,{start:ne,end:ne+700}),qe(()=>{p||yn(V&&V.binId?V.binId:null)},ge)}function Di(){p||(je("dropping"),d&&Pn(d,"wos-letters-hud--pop",190),R.launch(.95),Oi(),ct(!0),S=tn(),V=null,qe(()=>{},ee))}function Ni(){p||(d&&Pn(d,"wos-letters-hud--wrong",160),R.buzz(.75))}function Vi(){p||R.tick()}function Wi(D,W){if(p||g!=="dropping")return;const k=performance.now?performance.now():Date.now();je("inBin");const H=(()=>{const Q=W&&W.collision&&Number.isFinite(W.collision.depth)?Math.abs(W.collision.depth):.4;return Ct(.55+Q*.2)})();V={binId:D,enterMs:k,stillStartMs:0,impactStrength:H},R.binBounce(.45)}function Hi(){if(!l||!t)return;const{w:D,h:W}=Bt(),k=l;k.clearRect(0,0,D,W),k.save(),k.globalAlpha=.1,k.fillStyle="#000",k.fillRect(0,0,D,W),k.restore();const H=ze.length,Q=D/H,re=W-180,$=performance.now?performance.now():Date.now();L||(L=dt());function ye(U,q,Y,pe,Ae,Se){const X=Se;let se=-Math.PI/2;const de=Math.PI/X;U.beginPath();for(let he=0;he<X*2;he++){const Me=he%2===0?pe:Ae,ie=q+Math.cos(se)*Me,ae=Y+Math.sin(se)*Me;he===0?U.moveTo(ie,ae):U.lineTo(ie,ae),se+=de}U.closePath()}for(let U=0;U<H;U++){const q=ze[U],Y=U*Q,pe=P.get(q.id)||null,Ae=!!(pe&&pe.end>$),Se=pe?Ct(1-(pe.end-$)/Math.max(1,pe.end-pe.start)):0,X=Ae?1+Math.sin(Se*Math.PI)*.04:1;k.save();const se=Y+Q/2,de=re+85;k.translate(se,de),k.scale(1,X),k.translate(-se,-de),k.globalAlpha=.78,k.fillStyle=q.hex,k.fillRect(Y+6,re,Q-12,170),k.globalAlpha=.22,k.fillStyle="#000",k.fillRect(Y+6,re+8,Q-12,162),k.globalAlpha=.55,k.lineWidth=Ae?6:4,k.strokeStyle="rgba(255,255,255,0.75)",k.strokeRect(Y+6+2,re+2,Q-12-4,166),Ae&&(k.globalAlpha=.35,k.shadowColor="rgba(255,255,255,0.85)",k.shadowBlur=18,k.strokeStyle="rgba(255,255,255,0.85)",k.lineWidth=3,k.strokeRect(Y+6+6,re+8,Q-12-12,154)),k.restore();const he=L&&L[q.id]?L[q.id]:{count:0,stars:0},Me=Math.max(0,Math.min(9,Math.floor(he.count||0))),ie=Math.max(0,Math.floor(he.stars||0)),ae=Y+Q-44,le=re+36,Ve=B.get(q.id),Ke=!!(Ve&&Ve.end>$),Gt=Ke?Ct(1-(Ve.end-$)/Math.max(1,Ve.end-Ve.start)):0,ut=Ke?1+Math.sin(Gt*Math.PI)*.28:1;k.save(),k.translate(ae,le),k.scale(ut,ut),k.translate(-ae,-le),k.globalAlpha=.78,k.fillStyle="rgba(255,255,255,0.22)",k.beginPath(),k.arc(ae,le,20,0,Math.PI*2),k.fill(),k.globalAlpha=.55,k.lineWidth=3,k.strokeStyle="rgba(0,0,0,0.55)",k.stroke(),k.globalAlpha=1,k.font="900 28px system-ui, -apple-system, Segoe UI, Arial, sans-serif",k.textAlign="center",k.textBaseline="middle";const tt=String(Me);if(k.lineJoin="round",k.miterLimit=2,k.lineWidth=6,k.strokeStyle="rgba(0,0,0,0.55)",k.fillStyle="rgba(255,255,255,0.95)",k.strokeText(tt,ae,le+1),k.fillText(tt,ae,le+1),k.restore(),ie>0){const nt=Y+44,G=re+38,_=I.get(q.id),be=!!(_&&_.end>$),Ce=be?Ct(1-(_.end-$)/Math.max(1,_.end-_.start)):0,Te=be?1+Math.sin(Ce*Math.PI)*.32:1,Re=be?12+10*Math.sin(Ce*Math.PI):0;k.save(),k.translate(nt,G),k.scale(Te,Te),k.translate(-nt,-G),k.globalAlpha=.92,k.shadowColor="rgba(255,255,255,0.75)",k.shadowBlur=Re,k.fillStyle="rgba(255,255,255,0.92)",k.strokeStyle="rgba(0,0,0,0.62)",k.lineWidth=4,ye(k,nt,G,18,8.5,5),k.fill(),k.shadowBlur=0,k.stroke();const xe=ie>=100?"99":String(ie),Le=xe.length>=2?14:16;k.font=`900 ${Le}px system-ui, -apple-system, Segoe UI, Arial, sans-serif`,k.textAlign="center",k.textBaseline="middle",k.lineJoin="round",k.miterLimit=2,k.lineWidth=5,k.strokeStyle="rgba(0,0,0,0.55)",k.fillStyle="rgba(0,0,0,0.88)",k.strokeText(xe,nt,G+1),k.fillText(xe,nt,G+1),k.restore()}}const te=e.Composite.allBodies(c),ne=performance.now?performance.now():Date.now();for(const U of te)if(U&&U.label!=="binSensor"&&U.isStatic&&U.circleRadius&&U.label==="peg"){const q=U.plugin&&U.plugin.style?U.plugin.style:null,Y=U.circleRadius||12,pe=q&&q.drawRadiusJitter||0,Ae=q&&q.wiggleUntilMs&&ne<q.wiggleUntilMs?1+.1*Math.sin((q.wiggleUntilMs-ne)/36):1,Se=Math.max(6,(Y+pe)*Ae),X=q&&q.shade||.84,se=q&&q.fillAlpha||.82,de=q&&q.outlineAlpha||.65,he=q&&q.ringAlpha||.18;k.save();const Me=Math.round(255*X);if(k.fillStyle=`rgba(${Me},${Me},${Me},${se})`,k.beginPath(),k.arc(U.position.x,U.position.y,Se,0,Math.PI*2),k.fill(),k.globalAlpha=he,k.strokeStyle="rgba(255,255,255,1)",k.lineWidth=2,k.beginPath(),k.arc(U.position.x,U.position.y,Math.max(2,Se-4),0,Math.PI*2),k.stroke(),q){const ie=q.highlightAngle||0,ae=U.position.x+Math.cos(ie)*(Se*.35),le=U.position.y+Math.sin(ie)*(Se*.35);k.globalAlpha=.26,k.fillStyle="rgba(255,255,255,1)",k.beginPath(),k.arc(ae,le,Math.max(1.5,Se*.16),0,Math.PI*2),k.fill()}k.globalAlpha=1,k.strokeStyle=`rgba(0,0,0,${de})`,k.lineWidth=3,k.beginPath(),k.arc(U.position.x,U.position.y,Se,0,Math.PI*2),k.stroke(),k.restore()}if(y&&y.body){const U=y.body,q=performance.now?performance.now():Date.now(),Y=N?.92+.1*(.5+.5*Math.sin(q/120)):1;k.save(),k.translate(U.position.x,U.position.y),k.rotate(U.angle),k.scale(Y,Y),k.fillStyle="rgba(255,255,255,0.85)",k.beginPath(),k.arc(0,0,U.circleRadius||32,0,Math.PI*2),k.fill(),k.fillStyle="rgba(17,17,17,0.92)",k.textAlign="center",k.textBaseline="middle",k.font="900 40px system-ui, -apple-system, Segoe UI, Arial, sans-serif";const pe=U.plugin&&U.plugin.letter?String(U.plugin.letter):"A";k.fillText(pe,0,2),N&&(k.strokeStyle="rgba(255,255,255,0.9)",k.lineWidth=3,k.globalAlpha=.6,k.beginPath(),k.arc(0,0,(U.circleRadius||32)+4,0,Math.PI*2),k.stroke()),k.restore()}}function $n(D){if(p||!t)return;C||(C=D);const W=Math.min(50,Math.max(0,D-C));C=D,b+=W;const k=1e3/60;for(;b>=k;)e.Engine.update(t,k),b-=k;Hi();const H=performance.now?performance.now():Date.now();Ri(H),Fi(H),u=requestAnimationFrame($n)}function Gn(D){if(p||D&&(D.ctrlKey||D.metaKey||D.altKey))return;R.unlock().catch(()=>{});const W=ht(D);if(W){if(g!=="idleAwaitingKey"){Vi();return}W===x?Di():Ni()}}function jn(D){if(p||!D)return;R.unlock().catch(()=>{});const W=vn(D.clientX,D.clientY);if(mt(W)||!c)return;const k=e.Composite.allBodies(c);let H=null,Q=1/0;for(const $ of k){if(!$||!$.isStatic||!$.circleRadius||$.label!=="peg")continue;const ye=$.position.x-W.x,te=$.position.y-W.y,ne=ye*ye+te*te;ne<Q&&(Q=ne,H=$)}const re=34;if(H&&Q<=re*re){const $=E,ye=H.plugin&&H.plugin.style?H.plugin.style:null,te=H.plugin&&H.plugin.home?H.plugin.home:{x:H.position.x,y:H.position.y},ne=$?$.minDist:38,U=ne*ne,q=$?$.maxDrift:46,Y=q*q,pe=(se,de)=>{const he=$?$.W:f.width||1280,Me=$?$.H:f.height||800,ie=$?$.xPad:140,ae=$?$.pegTop:110,le=$?$.pegBottom:Me-180-62;return!(se<ie||se>he-ie||de<ae||de>le||$&&typeof $.inNoGoZones=="function"&&$.inNoGoZones(se,de))},Ae=(se,de)=>{const he=se-te.x,Me=de-te.y;if(he*he+Me*Me>Y)return!1;for(const ie of k){if(!ie||ie===H||!ie.isStatic||!ie.circleRadius||ie.label!=="peg")continue;const ae=ie.position.x-se,le=ie.position.y-de;if(ae*ae+le*le<U)return!1}return!0};let Se=!1,X=0;for(let se=0;se<10;se++){const de=Math.random()<.16,he=(de?16:8)+Math.random()*(de?16:10),Me=Math.random()*Math.PI*2,ie=Math.cos(Me)*he,ae=Math.sin(Me)*he,le=H.position.x+ie,Ve=H.position.y+ae;if(pe(le,Ve)&&Ae(le,Ve)){try{h.setPosition(H,{x:le,y:Ve}),Se=!0,X=he}catch{}break}}if(ye&&(ye.wiggleUntilMs=(performance.now?performance.now():Date.now())+(Se?520:280)),Se){const se=Math.min(1,.25+X/32*.75);R.plink(.2+.55*se),X>22&&R.pop(.22)}else R.plink(.16)}else R.tick()}function Ui(){if(p)return;l=f.getContext("2d",{alpha:!0,desynchronized:!0}),Bt(),R.ensure(),gt(),ct(!0),d&&d.setAttribute("data-wos-letters-intro","none"),S=x,yn(null,{initial:!0}),document.addEventListener("keydown",Gn,!0),f.addEventListener("pointerdown",jn),m.push(()=>document.removeEventListener("keydown",Gn,!0)),m.push(()=>f.removeEventListener("pointerdown",jn));const D=()=>Bt();document.addEventListener("winnieos:displaychange",D),m.push(()=>document.removeEventListener("winnieos:displaychange",D)),u=requestAnimationFrame($n)}function zi(){if(!p){if(p=!0,A){try{A()}catch{}A=null}try{u&&cancelAnimationFrame(u)}catch{}u=null,$t();for(const D of m)try{D()}catch{}m=[];try{zn()}catch{}try{c&&e.World.clear(c,!1),t&&e.Engine.clear(t)}catch{}t=null,c=null,l=null}}return{start:Ui,dispose:zi}}const Xo={id:"letters",title:"Letters",iconEmoji:"ðŸ”¤",sortOrder:10,mount:function({root:o}){if(!o)return;o.className="wos-letters-app",o.innerHTML="";const f=document.createElement("canvas");f.className="wos-letters-canvas",f.setAttribute("aria-label","Letters game"),f.setAttribute("role","application");const d=document.createElement("div");d.className="wos-letters-hud";const v=document.createElement("canvas");v.className="wos-letters-glyph",v.setAttribute("aria-hidden","true"),d.appendChild(v),o.appendChild(f),o.appendChild(d);let s=!1,e=null;return(async()=>{let i=null;try{i=await et.load()}catch{}if(s)return;const n=i&&i.apps&&i.apps.config&&typeof i.apps.config=="object"&&i.apps.config.letters||null;e=Yo({canvas:f,hudEl:d,glyphEl:v,config:n}),e.start()})(),function(){if(s=!0,e&&typeof e.dispose=="function")try{e.dispose()}catch{}e=null}},unmount:function(){}},Jo=Object.freeze(Object.defineProperty({__proto__:null,default:Xo},Symbol.toStringTag,{value:"Module"})),Zo={id:"memory",title:"Memory",iconEmoji:"ðŸ§ ",sortOrder:45,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Memory</div>
            <div class="wos-app-placeholder-text">A simple matching game will live here.</div>
        `)},unmount:function(){}},er=Object.freeze(Object.defineProperty({__proto__:null,default:Zo},Symbol.toStringTag,{value:"Module"})),tr={id:"music",title:"Music",iconEmoji:"ðŸŽµ",sortOrder:30,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Music</div>
            <div class="wos-app-placeholder-text">This will become a simple music player with big buttons.</div>
        `)},unmount:function(){}},nr=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"})),Pi="apps.notepad.v1",Vn=[{id:"black",hex:"#111111"},{id:"red",hex:"#E11D48"},{id:"orange",hex:"#F97316"},{id:"yellow",hex:"#F59E0B"},{id:"green",hex:"#16A34A"},{id:"blue",hex:"#2563EB"},{id:"purple",hex:"#7C3AED"},{id:"pink",hex:"#EC4899"}],ir=["ðŸ˜€","ðŸ˜","ðŸ˜„","ðŸ˜†","ðŸ˜Š","ðŸ˜","ðŸ¥³","ðŸ˜œ","ðŸµ","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ¶","ðŸ±","ðŸ­","ðŸ°","ðŸ¦","ðŸ·","ðŸ½","ðŸ®","ðŸ¸","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¦Š","ðŸ¯","ðŸ™","ðŸ¦„","ðŸž","ðŸ¦‹","ðŸ","ðŸ¢","ðŸ“","ðŸŒ","ðŸŽ","ðŸ‡","ðŸ‰","ðŸ’","ðŸª","ðŸ¦","â­","ðŸŒˆ","â˜€ï¸","ðŸŒ™","â¤ï¸","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","âœ¨","ðŸŽˆ","ðŸŽ‰","ðŸŽµ"];function or(o,f){let d=null;return function(...v){d&&clearTimeout(d),d=setTimeout(()=>o(...v),f)}}function Ei(o){const f=String(o||"").trim();return f?/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(f)?f.toLowerCase():/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+(?:\s*,\s*(0|1|0?\.\d+))?\s*\)$/i.test(f)?f:null:null}function oi(o){const f=document.createElement("template");f.innerHTML=String(o||"");const d=v=>{const s=Array.from(v.childNodes||[]);for(const e of s)if(e.nodeType===Node.ELEMENT_NODE){const a=e.tagName.toLowerCase();if(a!=="br")if(a==="div"||a==="span"){const i=Array.from(e.attributes||[]);for(const n of i)e.removeAttribute(n.name);if(a==="span"){const n=e.style&&e.style.color?e.style.color:"",h=Ei(n);h&&e.setAttribute("style",`color:${h}`)}d(e)}else{const i=e.textContent||"";e.replaceWith(document.createTextNode(i))}}else e.nodeType===Node.COMMENT_NODE&&e.remove()};try{d(f.content)}catch{}return f.innerHTML}function ki(o,f){try{if(o==="foreColor")try{document.execCommand("styleWithCSS",!1,!0)}catch{}return document.execCommand(o,!1,f)}catch{return!1}}function on(o,f){const d=Ei(f)||f,v=ki("foreColor",d);return!v&&o&&o.style&&(o.style.color=d),v}function ri(o){if(ki("insertText",o))return!0;const f=window.getSelection&&window.getSelection();if(!f||f.rangeCount===0)return!1;const d=f.getRangeAt(0);d.deleteContents();const v=document.createTextNode(o);return d.insertNode(v),d.setStartAfter(v),d.setEndAfter(v),f.removeAllRanges(),f.addRange(d),!0}function rr(){const o=Ge.get(Pi,null);return!o||typeof o!="object"?null:{html:typeof o.html=="string"?o.html:"",color:typeof o.color=="string"?o.color:Vn[0].hex}}function si(o,f){if(!o||typeof o.querySelectorAll!="function")return;o.querySelectorAll("[data-wos-notepad-swatch]").forEach(v=>{(v.getAttribute("data-wos-notepad-swatch")||"").toLowerCase()===String(f||"").toLowerCase()?v.classList.add("wos-notepad-swatch--active"):v.classList.remove("wos-notepad-swatch--active")})}const sr={id:"notepad",title:"Notepad",iconEmoji:"ðŸ“",sortOrder:5,mount:function({root:o}){if(!o)return;try{R.ensure()}catch{}o.className="wos-notepad-app",o.innerHTML="";const f=rr();let d=f&&f.color||Vn[0].hex;const v=document.createElement("div");v.className="wos-notepad-wrap";let s=0;const e=()=>typeof performance<"u"&&performance.now?performance.now():Date.now(),a=x=>{const S=e();s=Math.max(s,S+Math.max(0,x||0))},i=document.createElement("div");i.className="wos-notepad-paper";const n=document.createElement("div");n.className="wos-notepad-editor",n.setAttribute("contenteditable","true"),n.setAttribute("role","textbox"),n.setAttribute("aria-multiline","true"),n.setAttribute("aria-label","Notepad"),n.spellcheck=!1,n.innerHTML=f&&f.html?oi(f.html):"",i.appendChild(n);const h=document.createElement("div");h.className="wos-notepad-emoji-strip",h.setAttribute("aria-label","Emojis");const r=document.createElement("div");r.className="wos-notepad-emoji-strip-inner",ir.forEach(x=>{const S=document.createElement("button");S.type="button",S.className="wos-notepad-emoji",S.setAttribute("aria-label","Emoji"),S.textContent=x,S.addEventListener("click",()=>{try{R.unlock().catch(()=>{})}catch{}try{R.pop(.22)}catch{}a(140),n.focus({preventScroll:!0}),ri(x),m()}),r.appendChild(S)}),h.appendChild(r);const p=document.createElement("div");p.className="wos-notepad-controls";const u=document.createElement("div");u.className="wos-notepad-swatches wos-notepad-card",Vn.forEach(x=>{const S=document.createElement("button");S.type="button",S.className="wos-notepad-swatch",S.setAttribute("aria-label",`Text color ${x.id}`),S.setAttribute("data-wos-notepad-swatch",x.hex),S.style.background=x.hex,S.addEventListener("click",()=>{try{R.unlock().catch(()=>{})}catch{}try{R.plink(.28)}catch{}d=x.hex,si(p,d),n.focus({preventScroll:!0}),on(n,d)}),u.appendChild(S)});const t=document.createElement("div");t.className="wos-notepad-trash wos-notepad-card";const c=document.createElement("button");c.type="button",c.className="wos-notepad-action",c.setAttribute("aria-label","Clear page"),c.textContent="ðŸ—‘ï¸",t.appendChild(c),p.appendChild(u),p.appendChild(t);const l=()=>{Ge.set(Pi,{html:oi(n.innerHTML),color:d})},m=or(l,450),w=x=>{try{x.preventDefault();const S=x.clipboardData&&x.clipboardData.getData("text/plain")||"";if(!S)return;try{R.unlock().catch(()=>{})}catch{}try{R.tick()}catch{}a(180),n.focus({preventScroll:!0}),ri(S),m()}catch{}},T=x=>{m();try{if(e()<s)return;const y=x&&typeof x.inputType=="string"?x.inputType:"";if(!y||!y.startsWith("insert"))return;const C=x&&typeof x.data=="string"?x.data:"";if(!C||C.length!==1)return;const b=()=>{try{if(R&&typeof R.isUnlocked=="function"&&R.isUnlocked())return Promise.resolve(!0);if(R&&typeof R.unlock=="function")return R.unlock().then(()=>!0).catch(()=>!1)}catch{}return Promise.resolve(!1)},P=C,M=P===" ",I=P===`
`||P==="\r"?"enter":M?"space":"alpha",F=Math.max(0,Math.min(1,(M?.14:.28)+(Math.random()*.14-.07)));R&&typeof R.type=="function"?b().then(O=>{if(O)try{R.type(F,I)}catch{}}):R.plink(M?.18:.26)}catch{}},A=()=>{try{R.unlock().catch(()=>{})}catch{}try{R.tick()}catch{}},E=()=>{try{R.unlock().catch(()=>{})}catch{}try{R.poof(.75)}catch{}a(240),n.innerHTML="",l(),n.focus({preventScroll:!0}),on(n,d)};v.appendChild(h),v.appendChild(i),v.appendChild(p),o.appendChild(v),si(p,d),requestAnimationFrame(()=>{n.focus({preventScroll:!0}),on(n,d);try{r.scrollLeft=0}catch{}});const g=x=>{const S=x.key,y=S&&S.length===1&&!x.ctrlKey&&!x.metaKey&&!x.altKey,C=document.activeElement,b=C&&(C.tagName==="BUTTON"||C.tagName==="INPUT"||C.tagName==="TEXTAREA"||C.hasAttribute("contenteditable"));y&&!b&&C!==n&&n&&n.isConnected&&(n.focus({preventScroll:!0}),on(n,d))};return n.addEventListener("input",T),n.addEventListener("paste",w),i.addEventListener("pointerdown",A),c.addEventListener("click",E),document.addEventListener("keydown",g,!0),function(){try{l()}catch{}n.removeEventListener("input",T),n.removeEventListener("paste",w),i.removeEventListener("pointerdown",A),c.removeEventListener("click",E),document.removeEventListener("keydown",g,!0)}},unmount:function(){}},ar=Object.freeze(Object.defineProperty({__proto__:null,default:sr},Symbol.toStringTag,{value:"Module"})),lr={id:"numbers",title:"Numbers",iconEmoji:"ðŸ”¢",sortOrder:35,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Numbers</div>
            <div class="wos-app-placeholder-text">Count and tap!</div>
        `)},unmount:function(){}},cr=Object.freeze(Object.defineProperty({__proto__:null,default:lr},Symbol.toStringTag,{value:"Module"})),ur={id:"paint",title:"Paint",iconEmoji:"ðŸŽ¨",sortOrder:10,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Paint</div>
            <div class="wos-app-placeholder-text">A simple drawing app will live here.</div>
        `)},unmount:function(){}},fr=Object.freeze(Object.defineProperty({__proto__:null,default:ur},Symbol.toStringTag,{value:"Module"})),pr={id:"piano",title:"Piano",iconEmoji:"ðŸŽ¹",sortOrder:50,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Piano</div>
            <div class="wos-app-placeholder-text">Tap keys to make music.</div>
        `)},unmount:function(){}},dr=Object.freeze(Object.defineProperty({__proto__:null,default:pr},Symbol.toStringTag,{value:"Module"})),hr={id:"shapes",title:"Shapes",iconEmoji:"ðŸ”º",sortOrder:40,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Shapes</div>
            <div class="wos-app-placeholder-text">Match the shapes.</div>
        `)},unmount:function(){}},mr=Object.freeze(Object.defineProperty({__proto__:null,default:hr},Symbol.toStringTag,{value:"Module"})),gr={id:"story",title:"Story Time",iconEmoji:"ðŸ“–",sortOrder:20,mount:function(o){const f=o&&o.root;f&&(f.className="wos-app-placeholder",f.innerHTML=`
            <div class="wos-app-placeholder-title">Story Time</div>
            <div class="wos-app-placeholder-text">Soon weâ€™ll read and play through stories here.</div>
        `)},unmount:function(){}},vr=Object.freeze(Object.defineProperty({__proto__:null,default:gr},Symbol.toStringTag,{value:"Module"}));function yr(o){if(!o||typeof o!="object")return null;const f=typeof o.id=="string"&&o.id.trim()?o.id.trim():null,d=typeof o.title=="string"&&o.title.trim()?o.title.trim():null,v=typeof o.mount=="function"?o.mount:null,s=typeof o.unmount=="function"?o.unmount:null;return!f||!d||!v?null:{id:f,title:d,iconSrc:typeof o.iconSrc=="string"?o.iconSrc:null,iconEmoji:typeof o.iconEmoji=="string"?o.iconEmoji:null,sortOrder:Number.isFinite(o.sortOrder)?o.sortOrder:0,mount:v,unmount:s}}const ai=Object.assign({"./animals/app.js":Io,"./blocks/app.js":Ro,"./bubbles/app.js":Do,"./colors/app.js":Vo,"./dance/app.js":Ho,"./garden/app.js":zo,"./letters/app.js":Jo,"./memory/app.js":er,"./music/app.js":nr,"./notepad/app.js":ar,"./numbers/app.js":cr,"./paint/app.js":fr,"./piano/app.js":dr,"./shapes/app.js":mr,"./story/app.js":vr}),Wt=new Map;Object.keys(ai).forEach(o=>{const f=ai[o],d=f&&(f.default||f.app)||null,v=yr(d);if(!v){console.warn(`WinnieOS.Apps: invalid app module at ${o}`);return}if(Wt.has(v.id)){console.warn(`WinnieOS.Apps: duplicate app id "${v.id}" (skipping ${o})`);return}Wt.set(v.id,v)});let Ue=null;async function li(){if(Ue!==null)return Ue;try{const o=await et.load();if(o&&o.apps&&Array.isArray(o.apps.enabled)){const f=o.apps.enabled.map(d=>String(d).trim()).filter(Boolean);Ue=new Set(f)}else o===null?Ue=new Set(["colors"]):Ue=new Set(Wt.keys())}catch(o){console.warn("WinnieOS.Apps: failed to load config, defaulting to colors only",o),Ue=new Set(["colors"])}return Ue}function Wn(){return Array.from(Wt.values()).sort((o,f)=>o.sortOrder!==f.sortOrder?o.sortOrder-f.sortOrder:o.title.localeCompare(f.title))}function xr(o){return o?Wn().filter(f=>o.has(f.id)):Wn()}const Bi={list:function(){return Ue!==null?xr(Ue):(li().catch(()=>{}),Wn())},get:function(o){const f=Wt.get(String(o||""))||null;return!f||Ue!==null&&!Ue.has(f.id)?null:f},refreshConfig:async function(){Ue=null,et.clearCache&&typeof et.clearCache=="function"&&et.clearCache(),await li()}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Apps=Bi);let En=!1,mn={screen:"startup"};const un=new Set;function wr(o,f){return!o||!f||o.screen!==f.screen?!1:o.screen==="app"?o.appId===f.appId:!0}function Li(){un.forEach(o=>{try{o(Qe.getState())}catch{}})}function rn(o){const f=o&&typeof o=="object"?o:{screen:"desktop"},d=f.screen==="app"?{screen:"app",appId:String(f.appId||"")}:{screen:f.screen==="startup"?"startup":"desktop"};wr(mn,d)||(mn=d,Li())}const Qe={init:function(o){En||(En=!0,o&&o.initialState&&rn(o.initialState),Li())},getState:function(){return{...mn}},subscribe:function(o){return typeof o!="function"?function(){}:(un.add(o),function(){un.delete(o)})},start:function(){rn({screen:"startup"})},goHome:function(){rn({screen:"desktop"})},openApp:function(o){rn({screen:"app",appId:o})},_resetForTests:function(){En=!1,mn={screen:"startup"},un.clear()}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Navigation=Qe);const Sr="/assets/images/winnieOS_logo_temp.png",Mr=(function(){let o=null,f=!1;const d=new Map;function v(){d.forEach((a,i)=>{try{clearTimeout(i)}catch{}try{a()}catch{}}),d.clear()}function s(a){return new Promise(i=>{const n=setTimeout(()=>{d.delete(n),i()},a);d.set(n,i)})}async function e(a){const i=o?o.querySelector("[data-wos-startup-status]"):null,n=r=>{i&&(i.textContent=r)},h=[{label:"Waking up WinnieOS",run:()=>s(450)},{label:"Checking apps",run:()=>s(450)},{label:"Almost ready",run:()=>s(450)}];for(const r of h){if(f)return;n(r.label);try{await r.run()}catch{}}if(!f)try{a.goHome()}catch{}}return{mount:function(a){const i=a&&a.root,n=a&&a.nav;i&&(f=!1,o=document.createElement("div"),o.className="wos-startup",o.innerHTML=`
                <div class="wos-startup-logo-layer">
                    <img class="wos-startup-logo" src="${Sr}" alt="WinnieOS" />
                </div>
                <div class="wos-startup-text-layer">
                    <div class="wos-startup-status">
                        <span data-wos-startup-status>Starting up</span>
                        <span class="wos-startup-dots" aria-hidden="true">
                            <span>.</span><span>.</span><span>.</span>
                        </span>
                    </div>
                </div>
            `,i.replaceChildren(o),n&&e(n))},unmount:function(){if(f=!0,v(),o&&o.parentNode)try{o.parentNode.removeChild(o)}catch{}o=null}}})(),br=(function(){let o=null,f=null;function d(e){try{if(R&&typeof R.isUnlocked=="function"&&R.isUnlocked()){try{e()}catch{}return}R&&typeof R.unlock=="function"&&R.unlock().then(()=>{try{e()}catch{}}).catch(()=>{})}catch{}}function v(e,a){const i=document.createElement("button");if(i.className="wos-app-tile",i.type="button",i.setAttribute("aria-label",e.title),i.addEventListener("click",()=>{d(()=>R.launch(.8)),a.openApp(e.id)}),e.iconSrc){const h=document.createElement("img");h.className="wos-app-icon",h.alt="",h.src=e.iconSrc,i.appendChild(h)}else{const h=document.createElement("div");h.className="wos-app-emoji",h.textContent=e.iconEmoji||"â­",i.appendChild(h)}const n=document.createElement("div");return n.className="wos-app-title",n.textContent=e.title,i.appendChild(n),i}function s(e,a,i){if(f)try{f()}catch{}const n=i.list();o=document.createElement("div"),o.className="wos-desktop";const h=document.createElement("div");h.className="wos-desktop-inner";const r=document.createElement("div");r.className="wos-app-grid",n.forEach(t=>{r.appendChild(v(t,a))}),h.appendChild(r),o.appendChild(h),e.replaceChildren(o);const p=()=>{if(!o)return;const t=getComputedStyle(o),c=parseFloat(t.paddingTop)||0,l=parseFloat(t.paddingBottom)||0,m=Math.max(0,o.clientHeight-c-l),w=r.getBoundingClientRect().height;w>0&&w<m?o.classList.add("wos-desktop--centered"):o.classList.remove("wos-desktop--centered")},u=requestAnimationFrame(p);window.addEventListener("resize",p),f=()=>{try{cancelAnimationFrame(u)}catch{}window.removeEventListener("resize",p)}}return{mount:async function(e){const a=e&&e.root,i=e&&e.nav,n=e&&e.apps;if(!(!a||!i||!n)){if(n.refreshConfig&&typeof n.refreshConfig=="function")try{await n.refreshConfig()}catch(h){console.warn("DesktopScreen: Failed to load config, using safe defaults",h)}s(a,i,n)}},unmount:function(){if(f)try{f()}catch{}if(f=null,o&&o.parentNode)try{o.parentNode.removeChild(o)}catch{}o=null}}})(),Tr=(function(){let o=null,f=null,d=null,v=null;function s(a){try{if(R&&typeof R.isUnlocked=="function"&&R.isUnlocked()){try{a()}catch{}return}R&&typeof R.unlock=="function"&&R.unlock().then(()=>{try{a()}catch{}}).catch(()=>{})}catch{}}function e(){if(typeof v=="function")try{v()}catch{}if(d&&typeof d.unmount=="function")try{d.unmount()}catch{}v=null,d=null}return{mount:function(a){const i=a&&a.root,n=a&&a.nav,h=a&&a.apps,r=a&&a.appId;if(!i||!h)return;o=document.createElement("div"),o.className="wos-app-host",f=document.createElement("div"),f.className="wos-app-root",o.appendChild(f),i.replaceChildren(o);const p=h.get(r);if(!p){f.className="wos-app-placeholder",f.innerHTML=`
                    <div class="wos-app-placeholder-title">Oops!</div>
                    <div class="wos-app-placeholder-text">That app isnâ€™t here yet.</div>
                `,s(()=>R.buzz(.35));return}d=p;try{const u=p.mount({root:f,nav:n});v=typeof u=="function"?u:null}catch{f.className="wos-app-placeholder",f.innerHTML=`
                    <div class="wos-app-placeholder-title">Uh oh!</div>
                    <div class="wos-app-placeholder-text">This app had a little problem starting.</div>
                `,s(()=>R.buzz(.55)),d=null,v=null}},unmount:function(){if(e(),o&&o.parentNode)try{o.parentNode.removeChild(o)}catch{}o=null,f=null}}})(),Hn={startup:Mr,desktop:br,app:Tr};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Screens=Hn);let kn=!1,sn=null,De=null,at=null,Je=null,fn=null,Bn=!1;function ci(o){try{if(R&&typeof R.isUnlocked=="function"&&R.isUnlocked()){try{o()}catch{}return}R&&typeof R.unlock=="function"&&R.unlock().then(()=>{try{o()}catch{}}).catch(()=>{})}catch{}}function Cr(){return document.getElementById("winnieos-canvas")}function Ar(){const o=Cr();if(!o)return!1;const f=o.querySelector(".wos-html-fallback");if(f&&f.parentNode)try{f.parentNode.removeChild(f)}catch{}De=o.querySelector("#wos-shell"),De||(De=document.createElement("div"),De.id="wos-shell",o.appendChild(De));let d=De.querySelector("#wos-topbar");d||(d=document.createElement("div"),d.id="wos-topbar",De.appendChild(d));let v=De.querySelector("#wos-home-btn");return v||(v=document.createElement("button"),v.id="wos-home-btn",v.type="button",v.setAttribute("aria-label","Home"),v.innerHTML=`
            <svg class="wos-home-icon" aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                <path fill="currentColor" d="M12 3.2 3 10.4v10.4h6.2v-6.2h5.6v6.2H21V10.4L12 3.2Zm7 15.6h-2.6v-6.2H7.6v6.2H5V11.4l7-5.6 7 5.6v7.4Z"/>
            </svg>
        `,v.addEventListener("click",()=>{try{const s=Qe&&typeof Qe.getState=="function"?Qe.getState():null;s&&s.screen==="app"?ci(()=>R.poof(.6)):ci(()=>R.tick())}catch{}Qe.goHome()}),d.appendChild(v)),at=De.querySelector("#wos-content"),at||(at=document.createElement("div"),at.id="wos-content",De.appendChild(at)),!0}function Ii(){if(Je&&typeof Je.unmount=="function")try{Je.unmount()}catch{}Je=null}async function ui(o){if(!at||!De)return;const f=o&&o.screen?o.screen:"desktop";De.dataset.screen=f;const d=Hn[f]||Hn.desktop,v=f==="app"?`app:${String(o&&o.appId||"")}`:f;if(Je===d&&fn===v)return;const s=fn;Ii();try{s==="startup"&&v==="desktop"&&R.isUnlocked&&R.isUnlocked()&&R.ready(.5)}catch{}if(Je=d,fn=v,Je&&typeof Je.mount=="function")try{const e=Je.mount({root:at,nav:Qe,apps:Bi,appId:o&&o.appId});e&&typeof e.then=="function"&&await e}catch(e){console.error("Shell: Error mounting screen",e)}}const pn={init:function(){if(!kn&&Ar()){kn=!0;try{R.ensure()}catch{}if(!Bn&&typeof document<"u"){Bn=!0;try{document.addEventListener("pointerdown",()=>{try{R.unlock().catch(()=>{})}catch{}},{capture:!0,passive:!0,once:!0}),document.addEventListener("keydown",()=>{try{R.unlock().catch(()=>{})}catch{}},{capture:!0,once:!0})}catch{}}Qe.init({initialState:{screen:"startup"}}),sn=Qe.subscribe(ui),ui(Qe.getState())}},_resetForTests:function(){if(sn)try{sn()}catch{}sn=null,Ii(),kn=!1,De=null,at=null,fn=null,Bn=!1}};typeof window<"u"&&(window.WinnieOS=window.WinnieOS||{},window.WinnieOS.Shell=pn);function fi(){!pn||typeof pn.init!="function"||pn.init()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",fi):fi();
